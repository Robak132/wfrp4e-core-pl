Hooks.on("init", async () => {
    await new Promise((() => {}), setTimeout(resolve, 250));
    foundry.utils.mergeObject(game.wfrp4e.config.effectScripts, {
    "03mJu59V4iByWlsO": "// The imbiber immediately\r\n// takes 3 Poisoned Conditions that cannot be resisted at first,\r\nawait this.actor.addCondition(\"poisoned\", 3)\r\n\r\n// recovers a number of Wounds equal to their Toughness Bonus, \r\nawait this.actor.modifyWounds(this.actor.system.characteristics.t.bonus)\r\n\r\n// and acquires the Regenerate Creature Trait.\r\nconst hasRegenerate = this.actor.has(\"Regeneracja\")\r\nif (hasRegenerate === undefined) {\r\n  let trait = await fromUuid(\"Compendium.wfrp4e-core.items.SfUUdOGjdYpr3KSR\");\r\n  await this.actor.createEmbeddedDocuments(\"Item\", [trait], {fromEffect: this.effect.id});\r\n}\r\n\r\nthis.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> otrzymuje: \r\n    <ul>\r\n      <li>3 Stany Zatrucia, których początkowo nie można usunąć</li>\r\n      <li>odzyskano liczbę ran: ${this.actor.system.characteristics.t.bonus}</li>\r\n      <li>otrzymano cechę stworzenia \"Regeneracja\".</li>\r\n    </ul>\r\n    od Łaski Ranalda zależy, czy regeneracja okaże się silniejsza niż zatrucie.</p>\r\n    <p>Kiedy wszystkie Stany Zatrucia zostaną usunięte, usuwana jest również cecha stworzenia Regeneracja.</p>`, \r\n    { whisper: ChatMessage.getWhisperRecipients(\"GM\"), blind: true })   \r\n",
    "0abwNjpzo3SbEOeO": "if (args.applyAP && args.modifiers.ap.metal) \r\n{\r\n    args.modifiers.ap.ignored += args.modifiers.ap.metal\r\n    args.modifiers.ap.details.push(\"<strong>\" + this.effect.name + \"</strong>: Zignorowano Metalowy Pancerz (\" + args.modifiers.ap.metal + \")\");\r\n    args.modifiers.ap.metal = 0\r\n}",
    "0FWto1oEr3jbWggw": "let spells = await game.wfrp4e.utility.findAll(\"spell\", \"Ładowanie Zaklęć\")\r\n\r\nlet text = (await game.wfrp4e.tables.rollTable(\"random-caster\", {hideDSN: true})).result\r\n\r\nlore = Array.from(text.matchAll(/{(.+?)}/gm))[0][1]\r\n\r\nif (text == \"Wybór GMa\")\r\n{\r\n    return this.script.scriptNotification(text)\r\n}\r\n\r\nif (spellsWithLore.length > 0)\r\n{\r\n    let spellsWithLore = spells.filter(i => game.wfrp4e.config.magicLores[i.system.lore.value] == lore)\r\n    let selectedSpell = spellsWithLore[Math.floor(CONFIG.Dice.randomUniform() * spellsWithLore.length)]\r\n    this.script.scriptNotification(selectedSpell.name);\r\n    this.actor.createEmbeddedDocuments(\"Item\", [selectedSpell])\r\n}\r\nelse\r\n{\r\n    ui.notifications.notify(`Nie udało się odnaleźć zaklęcia w Tradycji ${lore}. Spróbuj ponownie.`)\r\n}",
    "0R0QAr3D024kWPfo": "let table = game.wfrp4e.tables.findTable(\"mutatephys\");\r\nif (!table)\r\n{\r\n\treturn ui.notifications.error(\"Nieodnaleziono tabeli Mutacji, upewnij się, że tabla o kluczu `mutatephys` jest zaimportowana do świata.\")\r\n}\r\nlet result = (await table.roll()).results[0];\r\nlet uuid = `Compendium.${result.documentCollection}.${result.documentId}`\r\nlet item = await fromUuid(uuid);\r\n\r\nif (item)\r\n{\r\n    this.script.scriptNotification(`${item.name} added`)\r\n    this.actor.createEmbeddedDocuments(\"Item\", [item])\r\n}\r\nelse \r\n{\r\n    ui.notifications.error(\"Nie odnaleziono przedmiotu: \" + uuid)\r\n}",
    "0Uly7OmkH0zqYbxQ": "let location = this.item.system.location.key;\r\n\r\nif (location)\r\n{\r\n    let dropped = this.item.system.weaponsAtLocation;\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}\r\n\r\nlet roll = await new Roll(\"max(1, 1d10 - @system.characteristics.t.bonus)\", this.actor).roll()\r\n\r\nroll.toMessage(this.script.getChatData({flavor : `${this.effect.name} (Czas Trwania)`}));\r\n\r\nthis.effect.updateSource({\"duration.rounds\" : roll.total})",
    "190PHSHKGaJ74wsR": "if (!this.item.name.includes(\"(\") || this.item.system.tests.value.includes(\"Teren\") || this.item.system.tests.value.toLowerCase().includes(\"(dowolny)\"))\r\n{\r\n    let tests = this.item.system.tests.value\r\n    let name = this.item.name\r\n\r\n    // If name already specifies, make sure tests value reflects that\r\n    if (name.includes(\"(\") && !name.toLowerCase().includes(\"dowolny\"))\r\n    {\r\n        let terrain = name.split(\"(\")[1].split(\")\")[0]\r\n        tests = tests.replace(\"terenie\", \"terenie: \" + terrain)\r\n    }\r\n    else // If no sense specified, provide dialog choice\r\n    {\r\n        let choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n            coastal : \"Wybrzeża\",\r\n            deserts : \"Pustynie\",\r\n            marshes : \"Bagna\",\r\n            rocky : \"Skalisty\",\r\n            tundra : \"Tundra\",\r\n            woodlands : \"Lasy\"\r\n        }, this.item.img), 1, \"Wybór terenu\");\r\n        if (choice[0])\r\n        {\r\n            name = `${name.split(\"(\")[0].trim()} (${choice[0].name})`\r\n            tests = tests.replace(\"terenie\", \"terenie: \" + choice[0].name)\r\n        }\r\n    }\r\n\r\n    this.effect.updateSource({name})\r\n    this.item.updateSource({name, \"system.tests.value\" : tests})\r\n}\r\n",
    "1BT0MWM2cbhlEnrn": "        let characteristics = {\r\n            \"ws\" : 5,\r\n            \"bs\" : 5,\r\n            \"s\" : 5,\r\n            \"t\" : 0,\r\n            \"i\" : 5,\r\n            \"ag\" : 5,\r\n            \"dex\" : 5,\r\n            \"int\" : 0,\r\n            \"wp\" : 5,\r\n            \"fel\" : 5\r\n        }\r\n        let items = []\r\n\r\n        let updateObj = this.actor.toObject();\r\n\r\n        let talents = (await Promise.all([game.wfrp4e.tables.rollTable(\"talents\"), game.wfrp4e.tables.rollTable(\"talents\"), game.wfrp4e.tables.rollTable(\"talents\")])).map(i => i.text)\r\n        \r\n        for (let ch in characteristics)\r\n        {\r\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n        }\r\n        \r\n        for (let talent of talents)\r\n        {\r\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n            if (talentItem)\r\n            {\r\n                items.push(talentItem.toObject());\r\n            }\r\n            else \r\n            {\r\n                ui.notifications.warn(`Nie odnaleziono talentu: ${talent}`, {permanent : true})\r\n            }\r\n        }\r\n      \r\n        \r\n        await this.actor.update(updateObj)\r\n        this.actor.createEmbeddedDocuments(\"Item\", items);\r\n    \r\n",
    "1fQr1Dg7DX0vfz3r": "let healed = parseInt(this.effect.sourceTest.result.SL)\r\nthis.actor.modifyWounds(healed)\r\nthis.script.scriptMessage(`Uleczono Rany: ${healed}`)",
    "1jQq9v8fXK8zuEBU": "let damage = this.effect.sourceActor.hasCondition(\"fatigued\") ? 6 : 10;\r\n\r\nlet loc = \"body\"\r\n\r\nlet APatLoc = this.actor.system.status.armour[loc];\r\n\r\nlet metalAP = APatLoc.layers.reduce((metal, layer) => metal += ((layer.metal && !layer.magical) ? layer.value : 0), 0)\r\n\r\nlet APused = Math.max(0, APatLoc.value - metalAP); // remove metal AP at location;\r\n\r\ndamage -= (APused + this.actor.system.characteristics.t.bonus)\r\n\r\nlet msg = await this.actor.applyBasicDamage(damage, {suppressMsg : true, damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL});\r\nmsg += ` (Zignorowano metalowy pancerz: ${metalAP} PP na lokalizacji: ${game.wfrp4e.config.locations[loc]})`\r\nthis.script.scriptMessage(msg)\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"difficult\"}, appendTitle : ` - ${this.effect.name}`});\r\nawait test.roll();\r\nif (test.failed)\r\n\tthis.actor.addCondition(\"stunned\");",
    "1kB2su7hLRYDhZ2H": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  \" - \" + this.effect.name})\r\nawait test.roll();\r\nif (!test.succeeded)\r\n{\r\n    let item = await fromUuid(\"Compendium.wfrp4e-core.items.ZhMADOqoo0y8Q9bx\")\r\n    let data = item.toObject();\r\n    if (this.item.system.location.key == \"rLeg\")\r\n    {\r\n        data.system.location.value = \"Prawy Palec U nogi\"\r\n\t    data.system.location.key = \"rToe\";\r\n    }\r\n    else if (this.item.system.location.key == \"lLeg\")\r\n    {\r\n        data.system.location.value = \"Lewu Palec U nogi\"\r\n\tdata.system.location.key = \"lToe\";\r\n    }\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data])\r\n}\r\nthis.effect.delete();",
    "1LDSzXeO5CzXgTOc": "return args.skill?.name.includes(game.i18n.localize(\"NAME.Channelling\")) || args.skill?.name == `${game.i18n.localize(\"NAME.Language\")} (${game.i18n.localize(\"SPEC.Magick\")})`",
    "1wrPvP6lJwIAfmsl": "let choice = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.locations), 1, \"Wybierz Lokację\");\r\n\r\nlet location = choice[0].id;\r\n\r\nlet itemTargeted = this.actor.items.get(this.effect.getFlag(\"wfrp4e\", \"itemTargets\")[0])\r\n\r\nif (itemTargeted)\r\n{\r\n    itemTargeted.update({[`system.APdamage.${location}`] : itemTargeted.system.APdamage[location] + 1})\r\n}",
    "1ZArMNUI8qqH6zkX": "let test = await args.actor.setupCharacteristic(\"wp\", {skipTargets: true, appendTitle :  \" - \" + this.effect.name, context : {failure: \"Otrzymano Stan Oszołoemienia\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    args.actor.addCondition(\"stunned\")\r\n}\r\n\r\n",
    "23vWiHUjxtRQ3Efz": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.eWPN3CV2Eddwz8aM\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Plecy\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})",
    "2cKarG9ToyW2ptCd": "if (this.item.system.quantity.value)\r\n{\r\n\tthis.item.update({\"system.quantity.value\" : this.item.system.quantity.value - 0.25})\r\n\tlet actor = Array.from(game.user.targets)[0]?.actor || this.actor;\r\n\tactor.applyEffect({effectData : [this.item.effects.contents[1].convertToApplied()]})\r\n}\r\nelse\r\n{\r\n\tthis.script.scriptNotification(\"Nic nie zostało!\", \"error\")\r\n}",
    "2QB0LjueuJcIaHaC": "if (isNaN(parseInt(this.item.system.specification.value)))\r\n{\r\n    let value = await ValueDialog.create(\"Podaj wartość pancerza\", this.effect.name);\r\n    if (value)\r\n    {\r\n     this.item.updateSource({\"system.specification.value\" : value});\r\n    }\r\n}",
    "2Qi1hwLYhdE6v6Hs": "if (![\"rLeg\", \"lLeg\"].includes(this.effect.getFlag(\"wfrp4e\", \"location\")))\r\n\treturn true;\r\n\r\nif (args.options.dodge)\r\n{\r\n\targs.abort = true;\r\n\tthis.script.scriptNotification(\"Nie można unikać!\")\r\n}\r\nreturn [\"t\", \"int\", \"wp\", \"fel\"].includes(args.characteristic)",
    "2rzxQlL7A9ujZ9uK": "if (args.opposedTest.result.winner == \"attacker\") {\r\n  if (args.opposedTest.defenderTest.weapon && args.opposedTest.defenderTest.item.properties.qualities.shield) {\r\n    ui.notifications.notify(`<b>${this.effect.name}</b>: Otrzymano Punkty Przewag: ${this.item.Advances}`)\r\n    this.actor.setAdvantage(this.item.Advances)\r\n  }\r\n}",
    "2sDH6RvoOAR40oqH": "if (![\"Goblin\", \"Ork\"].includes(this.actor.system.details.species.value)) {\r\n    let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), { appendTitle: ` - ${this.effect.name}` })\r\n    await test.roll();\r\n    if (test.failed) {\r\n        let infection = await fromUuid(\"Compendium.wfrp4e-core.items.Item.1hQuVFZt9QnnbWzg\")\r\n        this.actor.createEmbeddedDocuments(\"Item\", [infection])\r\n    }\r\n}\r\n\r\n// Since wounds change when the effect is deleted, need to wait until after \r\n// the max wounds have been recalculated to apply damage\r\ngame.wfrp4e.utility.sleep(1000).then(async () => {\r\n    let roll = await new Roll(\"1d10\").roll();\r\n\r\n    roll.toMessage(this.script.getChatData());\r\n    this.script.scriptMessage(await this.actor.applyBasicDamage(roll.total, { damageType: game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL, suppressMsg: true }))\r\n\r\n})",
    "2vTVR0quRZQtjNfQ": "let currentCareer = this.actor.system.currentCareer;\r\nif (!currentCareer)\r\n{\r\n    return;\r\n}\r\n\r\nlet talents = [game.i18n.localize(\"NAME.AA\"),\r\n`${game.i18n.localize(\"NAME.ArcaneMagic\")} (${game.i18n.localize(\"SPEC.Any\")})`,\r\ngame.i18n.localize(\"NAME.ChaosMagic\") + \" \" +  \"(Tzeentch)\",\r\ngame.i18n.localize(\"NAME.FastHands\"),\r\ngame.i18n.localize(\"NAME.ID\"),\r\ngame.i18n.localize(\"NAME.MagicalSense\"),\r\ngame.i18n.localize(\"NAME.PettyMagic\"),\r\ngame.i18n.localize(\"NAME.SecondSight\"),\r\ngame.i18n.localize(\"NAME.WarWizard\"),\r\ngame.i18n.localize(\"NAME.Witch\")].filter(t => !currentCareer.system.talents.includes(t))\r\n\r\ncurrentCareer.system.talents = currentCareer.system.talents.concat(talents)",
    "2W9uMTT6iJhfQ044": "let skill = `${game.i18n.localize(\"NAME.Trade\")} (${this.item.parenthesesText})`\r\nlet currentCareer = this.actor.system.currentCareer;\r\nlet existingSkill = this.actor.itemTypes.skill.find(i => i.name == skill);\r\n\r\nif (!currentCareer) return\r\n\r\n\r\nlet inCurrentCareer = currentCareer.system.skills.includes(skill);\r\nlet craftsmanAdded = this.actor.getFlag(\"wfrp4e\", \"craftsmanAdded\") || {};\r\nif (existingSkill && inCurrentCareer && !craftsmanAdded[existingSkill.name])\r\n{\r\n\texistingSkill.system.advances.costModifier = -5;\r\n}\r\nelse \r\n{\r\n\tcraftsmanAdded[skill] = true;\r\n\tcurrentCareer.system.skills.push(skill);\r\n\tfoundry.utils.setProperty(this.actor, \"flags.wfrp4e.craftsmanAdded\", craftsmanAdded)\r\n}",
    "2WSN306tL4apjRtD": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.9h82z72XGo9tfgQS\")\r\nlet data = item.toObject();\r\ndata.name = data.name += ` (${game.i18n.localize(\"SPEC.Hearing\")})`\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "2zeP2nMSURjxrqYz": "let wounds = this.actor.system.status.wounds\r\nif (wounds.value == 0)\r\n  return this.script.scriptNotification(\"Efekt nie wywołuje skutku przy żywotności równej 0\", \"error\")\r\n\r\nthis.script.scriptNotification(`Uleczono Rany: ${this.actor.characteristics.t.bonus}`)\r\nawait this.actor.modifyWounds(this.actor.characteristics.t.bonus)",
    "3D5ImpMgpOTPucvv": "if (args.test.options.cardsharp && args.test.succeeded)\r\n{\r\n\r\nlet SL = Math.floor(args.test.target / 10) - Math.floor(args.test.result.roll / 10)\r\nlet ones = Number(args.test.result.roll.toString().split(\"\").pop())\r\n\r\nif (ones > SL)\r\n   args.test.result.other.push(`<span class=\"hide-option\"><b>${this.effect.name}</b>: ${ones + args.test.successBonus + args.test.slBonus} PS</span>`)\r\n}",
    "3IGO7xEjRjat937X": "let fatigue = this.actor.hasCondition(\"fatigued\")\r\nif (fatigue)\r\n{\r\n   this.script.scriptNotification(\"Usunięto Stan Zmęczenia, Efekt zdeaktywowany.\")\r\n    this.effect.update({disabled : true})\r\n   await this.actor.removeCondition(\"fatigued\")\r\n}",
    "3JEzEzF1SeYA9lsV": "let choice = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.locations, this.effect.img), 1, \"Wybierz Lokację\");\r\nif (choice[0])\r\n{\r\n    this.effect.updateSource({name : `${this.effect.name} (${choice[0].name})`})\r\nthis.effect.updateSource({\"flags.wfrp4e.location\" : choice[0].id})\r\n}\r\n\r\nlet location = choice[0].id;\r\n\r\nif ([\"lArm\", \"rArm\"].includes(location))\r\n{\r\n    let dropped = this.actor.itemTypes.weapon.filter(i => i.isEquipped & i.system.usesHands.includes(location));\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}\r\n\r\nif (location == \"body\")\r\n{\r\n    await this.actor.addCondition(\"fatigued\");\r\n    test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"hard\"}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\n    await test.roll();\r\n    if (test.failed)\r\n    {\r\n        this.actor.addCondition(\"prone\");\r\n    }\r\n}\r\n\r\nif (location == \"head\")\r\n{\r\n    await this.actor.addCondition(\"stunned\");\r\n    test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"average\"}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\n    await test.roll();\r\n    if (test.failed)\r\n    {\r\n        this.actor.addCondition(\"unconscious\");\r\n    }\r\n}",
    "4fnTKgl0HW9ZrWyJ": "this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields: {difficulty : \"average\"}}).then(async test =>\r\n{\r\n     await test.roll()\r\n     if (test.failed)\r\n     {\r\n         let char = Math.ceil(CONFIG.Dice.randomUniform() * 2) == 2 ? \"s\" : \"t\";\r\n         this.script.scriptMessage(`<strong>${this.actor.name}</strong> Utracono 1 punkt cechy: ${game.wfrp4e.config.characteristics[char]}`)\r\n         this.actor.update({[`system.characteristics.${char}.initial`] : this.actor.system.characteristics[char].initial - 1})\r\n     }\r\n})",
    "4MQ7u4INxp51oyyR": "let characteristics = {\r\n    \"ws\" : 25,\r\n    \"bs\" : 10,\r\n    \"s\" : 15,\r\n    \"t\" : 15,\r\n    \"i\" : 25,\r\n    \"ag\" : 20,\r\n    \"dex\" : 0,\r\n    \"int\" : 10,\r\n    \"wp\" : 25,\r\n    \"fel\" : 10\r\n}\r\nlet skills = [\"Opanowanie\", \"Unik\", \"Zastraszanie\", \"Intuicja\", \"Dowodzenie\", \"Wiedza (Wojenna)\", \"Percepcja\"]\r\nlet skillAdvancements = [15, 15, 15, 15, 15, 10, 10]\r\nlet talents = [\"Zmysł Bitewny\", \"Bitewny Refleks\", \"Finta\", \"Inspirujący\", \"Nieugięty\", \"Wódz\"]\r\nlet trappings = [\"Broń ręczna\", \"Tarcza\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć talentu: ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć przedmiotu: ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}\r\n",
    "4pQW4WLyhjbZR85k": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields : {difficulty : \"average\"}, context : {failure: \"1 Corruption Point Gained\"}})\r\nawait test.roll();\r\nif (test.failed && this.actor.type == \"character\")\r\n{\r\n    this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + 1})\r\n    this.script.scriptMessage(\"Otrzymano Punkt Zepsucia\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "58rFc9HiBoX66J6p": "let sourceActor = this.effect.sourceActor;\r\nlet damage = args.totalWoundLoss;\r\nlet tb = sourceActor.system.characteristics.t.bonus\r\nargs.abort = `<strong>${this.effect.name}</strong>: Zadano obrażenia: ${sourceActor.name}`;\r\n\r\nlet message = await sourceActor.applyBasicDamage(damage - tb, {damageType: game.wfrp4e.config.DAMAGE_TYPE.IGNORE_AP, suppressMsg : true})\r\n\r\nthis.script.scriptMessage(message.replace(`${tb} Bomnus Wt`, `${tb} × 2 Bonus Wt`))\r\nargs.abort = true;",
    "5DI6cHAg1LHo54Yv": "if (args.opposedTest.result.differenceSL >= 0 && args.opposedTest.result.differenceSL <= 2 && args.opposedTest.result.winner == \"attacker\")\r\n{ \r\n   this.actor.update({\"system.status.fortune.value\" : Math.max(0, (this.actor.system.status.fortune?.value - 1) || 0)})\r\n    this.script.scriptMessage(`Skradziono 1 Punkt Szczęścia od <strong>${this.actor.name}</strong>`, {blind : true, whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n\r\n}",
    "5dR7Erj3nwsxLAV7": "let characteristics = {\r\n    \"ws\" : 35,\r\n    \"bs\" : 10,\r\n    \"s\" : 25,\r\n    \"t\" : 30,\r\n    \"i\" : 30,\r\n    \"ag\" : 25,\r\n    \"dex\" : 0,\r\n    \"int\" : 15,\r\n    \"wp\" : 35,\r\n    \"fel\" : 15\r\n}\r\nlet skills = [\"Opanowanie\", \"Unik\", \"Zastraszanie\", \"Intuicja\", \"Dowodzenie\", \"Wiedza (Wojenna)\", \"Percepcja\"]\r\nlet skillAdvancements = [25, 15, 25, 25, 30, 20, 20]\r\nlet talents = [\"Zmysł Bitewny\", \"Bitewny Refleks\", \"Finta\", \"Inspirujący\", \"Szczęście\", \"Nieugięty\", \"Niewzruszony\", \"Wódz\"]\r\nlet trappings = [\"Broń ręczna\", \"Tarcza\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć talentu: ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć przedmiotu: ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "5Fe1ELaS6Gnvy0Cj": "return args.skill?.name.includes(game.i18n.localize(\"NAME.Channelling\")) || args.type == \"channelling\" || args.skill?.name == game.i18n.localize(\"NAME.Charm\") || args.skill?.name.includes(`${game.i18n.localize(\"NAME.Language\")} (${game.i18n.localize(\"SPEC.Magick\")})`) || args.type == \"cast\"",
    "5JvKJZPcd6Hz5zvn": "let characteristics = {\r\n    \"ws\" : 10,\r\n    \"bs\" : 0,\r\n    \"s\" : 10,\r\n    \"t\" : 10,\r\n    \"i\" : 20,\r\n    \"ag\" : 10,\r\n    \"dex\" : 0,\r\n    \"int\" : 0,\r\n    \"wp\" : 15,\r\n    \"fel\" : 0\r\n}\r\nlet skills = [\"Opanowanie\", \"Unik\", \"Zastraszanie\", \"Dowodzenie\"]\r\nlet skillAdvancements = [15, 15, 10, 5]\r\nlet talents = [\"Zmysł Bitewny\", \"Bitewny Refleks\", \"Finta\", \"Nieugięty\"]\r\nlet trappings = [\"Kolczuga\", \"Nogawice kolcze\", \"Czepiec kolczy\", \"Broń ręczna\", \"Tarcza\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć talentu: ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć przedmiotu: ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = this.effect.name + \" \" + updateObj.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "5JWC0l3JEpOsqbR9": "let characteristics = {\r\n    \"ws\" : 0,\r\n    \"bs\" : 5,\r\n    \"s\" : 0,\r\n    \"t\" : 0,\r\n    \"i\" : 10,\r\n    \"ag\" : 10,\r\n    \"dex\" : 0,\r\n    \"int\" : 0,\r\n    \"wp\" : 5,\r\n    \"fel\" : 0\r\n}\r\nlet skills = [\"Unik\", \"Percepcja\"]\r\nlet skillAdvancements = [10, 10]\r\nlet talents = [\"Chodu\", \"Strzelec Wyborowy\"]\r\nlet trappings = [\"Broń ręczna\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć talentu: ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Nie udało się znaleźć przedmiotu: ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "5M6IgCUncCwyxHok": "let etiquette = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.sYbgpSnRqSZWgwFP\")).toObject();\r\netiquette.name += ` (Słudzy Tzeentch)`;\r\n\r\nlet animosity = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.0VpT5yubw4UL7j6f\")).toObject();\r\nanimosity.system.specification.value = \"Słudzy Nurgle'a\";\r\n\r\nlet roll = await new Roll(\"ceil(1d10 / 3)\").roll();\r\n\r\nroll.toMessage(this.script.getChatData());\r\n\r\nlet mutations = [];\r\nlet msg = `<p><strong>Otrzymaono Mutację</strong></p>`\r\nfor(let i = 0; i < roll.total; i++)\r\n{\r\n    let item;\r\n    let uuid;\r\n    let result;\r\n    if (i % 2 == 0)\r\n    {\r\n        result = await game.wfrp4e.tables.rollTable(\"mutatemental\", {hideDSN: true}, \"Tzeentch\")\r\n    }\r\n    else \r\n    {\r\n        result = await game.wfrp4e.tables.rollTable(\"mutatephys\", {hideDSN: true}, \"Tzeentch\")\r\n    }\r\n    uuid = `Compendium.${result.object.documentCollection}.${result.object.documentId}`;\r\n    item = await fromUuid(uuid);\r\n    if (item)\r\n    {\r\n        msg += `<p>@UUID[${uuid}]{${item.name}}</p>`\r\n        mutations.push(item.toObject());\r\n    }\r\n}\r\nthis.actor.createEmbeddedDocuments(\"Item\", mutations.concat([etiquette, animosity]), {fromEffect : this.effect.id})\r\nthis.script.scriptMessage(msg);",
    "5ScjIdRUOxblHdWS": "const repaired_message = `<p>Zakończono naprawę: <em>${this.item.name}</em>.</p>`;\r\nconst test = 'Rzemiosło (Stolarstwo)';\r\nconst difficulty = 'challenging';\r\nconst target = 40;\r\n\r\nconst extendedTestData = {\r\n  name: this.item.name,\r\n  type: \"extendedTest\",\r\n  img: this.item.img,\r\n  system: {\r\n    SL: {\r\n      current: 0,\r\n      target: target\r\n    },\r\n    test: {\r\n      value: test\r\n    },\r\n    completion: {\r\n      value: \"remove\"\r\n    },\r\n    difficulty: {\r\n      value: difficulty\r\n    }\r\n  },\r\n  effects: [\r\n    {\r\n      name: `Napraw: ${this.item.name}`,\r\n      icon: this.item.img,\r\n      flags: {\r\n        wfrp4e: {\r\n          applicationData: {\r\n            type: \"document\",\r\n            documentType: \"Item\"\r\n          },\r\n          scriptData: [\r\n            {\r\n              label: this.item.name,\r\n              script: `\r\n              let id = this.item.flags.wfrp4e.fromEffect;\r\n              let effect = this.actor.appliedEffects.find(e => e.id === id);\r\n              this.script.scriptMessage(\"${repaired_message}\");\r\n              await effect.item.delete();\r\n            `,\r\n              trigger: \"deleteEffect\"\r\n            }\r\n          ]\r\n        }\r\n      }\r\n      }\r\n  ]\r\n};\r\n\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [extendedTestData], {fromEffect: this.effect.id});\r\n",
    "5sI9iYh5j2nx2XyT": "return !([game.i18n.localize(\"NAME.AnimalCare\"), game.i18n.localize(\"NAME.CharmAnimal\")].includes(args.item?.name) || args.item?.name.includes(game.i18n.localize(\"NAME.Ride\")) || args.item?.name.includes(game.i18n.localize(\"NAME.AnimalTraining\")));",
    "65xE9OV5sA1ZWT7j": "if (args.test.options.diceman && args.test.succeeded)\r\n{\r\n\r\nlet SL = Math.floor(args.test.target / 10) - Math.floor(args.test.result.roll / 10)\r\nlet ones = Number(args.test.result.roll.toString().split(\"\").pop())\r\n\r\nif (ones > SL)\r\n   args.test.result.other.push(`<span class=\"hide-option\"><b>${this.effect.name}</b>: ${ones + args.test.successBonus + args.test.slBonus} PS</span>`)\r\n}",
    "6Aqq4F4Xui923sc6": "// Imbibing this substance grants the user the Painless Creature Trait.\r\nconst hasColdBlooded = this.actor.has(\"Zimnokrwisty\")\r\nif (hasColdBlooded === undefined) \r\n{\r\n  let item = await fromUuid(\"Compendium.wfrp4e-core.items.mCh1KK9jomwFZcLB\");\r\n  this.actor.createEmbeddedDocuments(\"Item\", [item], {fromEffect: this.effect.id});\r\n  \r\n  this.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> otrzymuje Cechę Stworzeń \"Zimnokrwisty\" i może odwrócić dowolny nieudany test oparty na Sile Woli.</p>\r\n  <p>Jeśli postać otrzyma Stan Zaskoczenie, ten stan nie znika za pierwszym razem, gdy pownien być usunięty (zwykle na koniec Rundy, gdy ofiara jest zaatakowana).</p>`, \r\n  {whisper: ChatMessage.getWhisperRecipients(\"GM\"), blind: true })   \r\n}",
    "6BmvV9c03FkfisnE": "// Apply changes when the mask is worn\r\n\r\nif (args.equipped) {  \r\n  this.actor.createEmbeddedDocuments(\"ActiveEffect\", [this.item.effects.contents[1]?.convertToApplied()])  \r\n  this.script.scriptMessage(`<strong>${this.item.name}</strong> została założona przez ${this.actor.name}. <br>\r\n      Otzymano +1 poziom Zepsucia, jeśli test na ekspozycję zakończy się niepowodzeniem, co będzie musiało zostać ręcznie zaaplikowane.<br>\r\n      Jeśli maska jest noszona przez ponad godzinę lub wykorzystane są jej efekty, postać jest wystawiona na @Corruption[moderate]{Przeciętne Zepsucie}`,\r\n      {whisper: ChatMessage.getWhisperRecipients(\"GM\")}) \r\n}\r\n\r\n// Notify of lingering effects when mask is removed\r\nelse if (!args.equipped)\r\n{\r\n    await this.item.effects.contents[0].delete();\r\n    await this.item.update({name : this.item.name += \" (Wykorzystana)\"})\r\n    this.script.scriptMessage(`<strong>${this.item.name}</strong> noszona przez ${this.actor.name} została zdjęta i utraciła swoje właściwości. Jednak jej efekty trwają przez [[1d10+4]] dni, po czym powinny zostać ręcznie usunięte.`, \r\n    {whisper: ChatMessage.getWhisperRecipients(\"GM\")}\r\n    )\r\n    \r\n}",
    "6elUNF58TaiYjxcx": "let test = await this.actor.setupCharacteristic(\"wp\", {skipTargets: true, appendTitle :  \" - \" + this.effect.name, context : {failure: \"Otrzymano Stan Oszołoemienia\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"stunned\");\r\n}",
    "6H6vNjzvMGl2ZqCR": "if (args.totalWoundLoss > 0)\r\n     this.script.scriptMessage(`<b>Ostrze Nurglitch: ${args.actor.name}</b> musi zdać <b>Prosty (+40) Test Odporności</b> lub otrzyma @UUID[Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb]{Ropiejącą Ranę}`, {whisper: ChatMessage.getWhisperRecipients(\"GM\") })",
    "6hAgggYpNR3r4QWC": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.Q2MCUrG2HppMcvN0\")\r\nitem = item.toObject()\r\nlet species = args.actor.Species || \" twojego gatunku\"\r\nitem.name = `Wrogość (wszyscy oprócz ${species})`\r\nthis.actor.createEmbeddedDocuments(\"Item\", [item], {fromEffect : this.effect.id})",
    "6jcTzK1XEuWqAacN": "args.abort = true;\r\nthis.script.scriptNotification(`Nie można używać: ${game.wfrp4e.config.locations[this.effect.getFlag(\"wfrp4e\", \"location\")]}!`, \"error\")",
    "6JrUjs3g5x6bFnj3": "let bite = await fromUuid(\"Compendium.wfrp4e-core.items.pLW9SVX0TVTYPiPv\")\r\nlet sense = await fromUuid(\"Compendium.wfrp4e-core.items.9h82z72XGo9tfgQS\")\r\nlet biteData = bite.toObject();\r\nlet senseData = sense.toObject();\r\n\r\nbiteData.system.specification.value = 6 - this.actor.characteristics.s.bonus;\r\nsenseData.name = senseData.name += game.i18n.localize(\"SPEC.Smell\")\r\nthis.actor.createEmbeddedDocuments(\"Item\", [biteData, senseData], {fromEffect : this.effect.id})",
    "6kifXp2jXEaQVJsg": "let useWard = await Dialog.wait({\r\n\ttitle : this.effect.name,\r\n\tcontent : `<p>Czy wziąć pod uwagę Ochronę otrzymaną z: <strong>${this.effect.name}</strong>?`,\r\n\tbuttons : {\r\n\t\tyes : {\r\n\t\t\tlabel : \"Tak\",\r\n\t\t\tcallback: () => {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tno : {\r\n\t\t\tlabel: \"Nie\",\r\n\t\t\tcallback: () => {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n\r\nif (useWard)\r\n\targs.ward = 9;",
    "6mpw9cGseG4W4eyd": "if (this.actor.system.status.advantage.value >= 2)\r\n{\r\n    await this.actor.modifyAdvantage(-2);\r\n    this.script.scriptNotification(\"Zmniejszono Punkty Przewag\")\r\n}\r\nelse \r\n{\r\n    return this.script.scriptNotification(\"Brak Wymaganych Punktów Przewag!\", \"error\")\r\n}\r\n\r\nlet test = await this.actor.setupTrait(this.item)\r\nawait test.roll();",
    "6QZUX7ZrFxOzqI0b": "let regenerate = this.actor.items.getName('Regeneracja')\r\n\r\nif (regenerate)\r\n{\r\n    let effect = regenerate.effects.contents[0]\r\n    let scriptData = effect.getFlag(\"wfrp4e\", \"scriptData\");\r\n    \r\n    scriptData[0].script = scriptData[0].script.replace(\"1d10\", \"1d10 * 2\")\r\n}",
    "6uldpFvKOCoW92cC": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.uqGxFOEqeurwkAO3\")\r\nitem = item.toObject()\r\n\r\nitem.system.specification.value = 10;\r\nitem.name += \" (Ogień)\"\r\nsetProperty(item, \"flags.wfrp4e.breath\",  \"fire\")\r\n\r\nItem.create(item, {parent : this.actor, fromEffect: this.effect.id})",
    "6Ws3ieQ7pG5poUyT": "if (isNaN(parseInt(this.item.system.specification.value)))\r\n{\r\n    let value = await ValueDialog.create(\"Podaj Tradycję Magiczną\", this.effect.name, \"\", Object.values(game.wfrp4e.config.magicLores));\r\n    if (value)\r\n    {\r\n     this.item.updateSource({\"system.specification.value\" : value});\r\n    }\r\n}",
    "6xTtJEhRc4OjcDTf": "if (getProperty(args.data, \"system.status.fortune.value\"))\r\n{\r\n\tthis.script.scriptNotification(\"Nie można zmienić liczby Punktów Szczęścia!\");\r\n\tdelete args.data.system.status.wounds.value;\r\n}",
    "6ZS1rQLkNvMDO0Fp": "let roll = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\nif (args.test.isFumble && roll == 1 && !args.test.result.misfire)\r\n{\r\n  args.test.result.misfire = game.i18n.localize(\"Misfire\") + \" (Wyrzucono 1)\"\r\n  args.test.result.misfireDamage = eval(parseInt(args.test.result.roll.toString().split('').pop()) + args.test.item.Damage)\r\n}\r\nelse if (args.test.isFumble && roll != 1)\r\n{\r\n    args.test.result.other.push(\"Rzut na Niewybuch: \" + roll)\r\n}\r\n\r\n",
    "7Ck0fkzE4WQ62qVe": "if (args.item.type  == \"skill\" && args.item.name == game.i18n.localize(`NAME.Melee (${game.i18n.localize(\"SPEC.Basic\")})`))\r\n{\r\n     args.item.system.modifier.value += 20;\r\n}",
    "7e8FgQUF2oANANmx": "return args.skill?.name == game.i18n.localize(\"NAME.MeleeBrawling\") || args.item?.weaponGroup?.value == \"brawling\"",
    "7F6aGxZJjwxm5e5P": "if (args.test.result.castOutcome == \"failure\")\r\n{\r\n    ValueDialog.create(\"Wprowadź utracone punkty żywotności, aby zyskać liczbę PS\", this.effect.name, \"0\").then(async value => {\r\n        value = Math.clamped(value, 0, 3)\r\n        if (value == 0)\r\n        {\r\n            return;          \r\n        }\r\n        else if (Number.isNumeric(value))\r\n        {\r\n            this.script.scriptNotification(`Utrcone Punkty Żywotności: ${value}`)\r\n            this.actor.modifyWounds(-1 * value)\r\n            await this.item.system.toggleEquip();\r\n            args.test.addSL(value);\r\n            args.test.preData.other.push(`<strong>${this.effect.name}</strong>: +${value} PS`)\r\n        }\r\n    })\r\n}",
    "7JW9t8AYSDkkzG2V": "// Apply changes when the mask is worn\r\n\r\nif (args.equipped) \r\n{  \r\n  this.actor.createEmbeddedDocuments(\"ActiveEffect\", [this.item.effects.contents[1]?.convertToApplied()])  \r\n  this.script.scriptMessage(`<strong>${this.item.name}</strong> została założona przez ${this.actor.name}. <br>\r\n      Jeśli maska jest noszona przez ponad godzinę lub wykorzystane są jej efekty, postać jest wystawiona na @Corruption[moderate]{Przeciętne Zepsucie}`,\r\n      {whisper: ChatMessage.getWhisperRecipients(\"GM\")}) \r\n}\r\n\r\n// Notify of lingering effects when mask is removed\r\nelse if (!args.equipped)\r\n{\r\n    await this.item.effects.contents[0].delete();\r\n    await this.item.update({name : this.item.name += \" (Wykorzystana)\"})\r\n    this.script.scriptMessage(`<strong>${this.item.name}</strong> noszona przez ${this.actor.name} została zdjęta i utraciła swoje właściwości. Jednak jej efekty trwają przez [[1d10+4]] dni, po czym powinny zostać ręcznie usunięte.`, \r\n    {whisper: ChatMessage.getWhisperRecipients(\"GM\")}\r\n    )\r\n    \r\n}",
    "7wBWUw05q0igh508": "// Imbibing this substance grants the user the Painless Creature Trait.\r\nconst hasPainless = this.actor.has(\"Nie Czuje Bólu\");\r\nif (hasPainless === undefined) \r\n{\r\n  let item = await fromUuid(\"Compendium.wfrp4e-core.items.wMwSRDmgiF2IdCJr\");\r\n  let data = item.toObject()\r\n  this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n  \r\n  this.script.scriptMessage(\r\n  `<p><strong>${this.actor.prototypeToken.name}</strong>: Otrzymano cechę stworzenia \"Nie Czuje Bólu\". Ten efekt trwa przez godzinę, po czym znika, a wszystkie powstrzymywane dotychczas efekty ran uderzają jednocześnie.</p>\r\n    <p>Uwaga: ten efekt nie chroni przed otrzymaniem trafienia krytycznego lub śmierci. Po prostu pozwala zignorować część efektów wynikających z Ran Krytycznych.</p>`, \r\n    { whisper: ChatMessage.getWhisperRecipients(\"GM\"), blind: true})\r\n}",
    "7WR2hJjHPhHhHxAq": "let poisoned = args.actor.hasCondition(\"poisoned\")\r\nif (poisoned)\r\n{\r\n   this.script.scriptNotification(`Usunięto liczbę stanów Zatrucia: ${poisoned.conditionValue}`)\r\n   poisoned.delete();  \r\n}\r\nelse\r\n  this.script.scriptNotification(`Brak stanów Zatrucia`)",
    "7ZoFUMDG2WJd8RMg": "this.script.scriptMessage(`Otrzymano <strong>${this.effect.name}</strong> Bonus`);",
    "84IB8CWa55XzoAkv": "return ([game.i18n.localize(\"NAME.AnimalCare\"), game.i18n.localize(\"NAME.CharmAnimal\")].includes(args.item?.name) || args.item?.name.includes(game.i18n.localize(\"NAME.Ride\")) || args.item?.name.includes(game.i18n.localize(\"NAME.AnimalTraining\")));",
    "8araLuwmBq8GKEw3": "let APIgnored = args.AP.layers.reduce((prev, current) => prev + ((current.weakpoints && !current.ignored) ? current.value : 0), 0)\r\n\r\nif (APIgnored)\r\n{\r\n    args.modifiers.ap.ignored += APIgnored\r\n    args.modifiers.ap.details.push(`<strong>${this.effect.name}</strong>: zignorowano PP z wadą \"Wrażliwe Punkty\" (${APIgnored})`)\r\n}",
    "8ByuHnUZ4RNTdGVv": "let strLoss = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\nlet tghLoss = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n\r\nif (!this.actor.has(game.i18n.localize(\"NAME.Undead\")) && !this.actor.has(game.i18n.localize(\"NAME.Daemonic\"))) \r\n{\r\n    this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), { appendTitle: \" - \" + this.effect.name, fields: { difficulty: \"average\" }, context: { failure: `Utracono ${strLoss} punktów Siły oraz ${tghLoss} punktów Wytrzymałości` } }).then(async test => {\r\n        await test.roll();\r\n        if (test.failed) {\r\n            this.actor.update({ \"system.characteristics.s.initial\": this.actor.system.characteristics.s.initial - strLoss, \"system.characteristics.t.initial\": this.actor.system.characteristics.t.initial - tghLoss })\r\n        }\r\n    })\r\n\r\n}\r\nelse {\r\n    this.script.scriptNotification(`<strong>${this.actor.name}</strong> jest odprony na: ${this.effect.name}`)\r\n}\r\n",
    "8GyJgdHVBaLrHCY8": "let type = this.item.getFlag(\"wfrp4e\", \"breath\")\r\nlet types = {\r\n    none : \"Brak\",\r\n    cold : \"Zimno\",\r\n    corrosion : \"Kwas\",\r\n    fire : \"Ogień\",\r\n    electricity : \"Elektryczność\",\r\n    poison : \"Trucizna\",\r\n    smoke : \"Dym\",\r\n    various : \"Różne\"\r\n}\r\nif (!type)\r\n{\r\n    type = (await ItemDialog.create(ItemDialog.objectToArray(types, this.item.img), 1, \"Wybierz rodzaj Zionięcia\"))[0]?.id;\r\n    this.item.updateSource({\"flags.wfrp4e.breath\" : type})\r\n}\r\n\r\nif (!this.item.name.includes(\"(\") && types[type] && type != \"none\")\r\n{\r\n    this.item.updateSource({name : this.item.name += ` (${types[type]})`, \"system.specification.value\" : this.item.system.specification.value.replace(\"(Typ)\", \"\").trim()})\r\n}",
    "8rq4GL5d5nCn4kO7": "let caster = this.effect.sourceActor\r\nif (caster)\r\n{\r\n    let healed = caster.characteristics.wp.bonus\r\n    this.actor.modifyWounds(healed);\r\n    this.script.scriptMessage(`<strong>${this.actor.prototypeToken.name}</strong> Odzyskuje Punkty Żywotności: ${healed}`)\r\n}",
    "8tyMXDfHR8AJBdDu": "let weakpointsAP = args.AP.layers.filter(i => !i.ignored && i.weakpoints).reduce((ap, layer) => ap + layer.value, 0);\r\n\r\nif (weakpointsAP > 0)\r\n{\r\n    args.modifiers.ap.ignored += weakpointsAP;\r\n    args.modifiers.ap.details.push(`${this.effect.name} - Ignoruje Wrażliwe Punkty (${weakpointsAP})`);\r\n}",
    "8xqYrBIf1Zhlwizg": "const repaired_message = `<p>Zakończono podnoszenie <em>kotwicy</em>.</p>`;\r\nconst test = 'Siła';\r\nconst difficulty = 'vhard';\r\nconst target = 20;\r\n\r\nconst extendedTestData = {\r\n  name: this.item.name,\r\n  type: \"extendedTest\",\r\n  img: this.item.img,\r\n  system: {\r\n    SL: {\r\n      current: 0,\r\n      target: target\r\n    },\r\n    test: {\r\n      value: test\r\n    },\r\n    completion: {\r\n      value: \"remove\"\r\n    },\r\n    difficulty: {\r\n      value: difficulty\r\n    }\r\n  },\r\n  effects: [\r\n    {\r\n      name: `Podnieś kotwicę ${this.item.name}`,\r\n      icon: this.item.img,\r\n      flags: {\r\n        wfrp4e: {\r\n          applicationData: {\r\n            type: \"document\",\r\n            documentType: \"Item\"\r\n          },\r\n          scriptData: [\r\n            {\r\n              label: this.item.name,\r\n              script: `\r\n              let id = this.item.flags.wfrp4e.fromEffect;\r\n              let effect = this.actor.appliedEffects.find(e => e.id === id);\r\n              this.script.scriptMessage(\"${repaired_message}\");\r\n              await effect.item.delete();\r\n            `,\r\n              trigger: \"deleteEffect\"\r\n            }\r\n          ]\r\n        }\r\n      }\r\n      }\r\n  ]\r\n};\r\n\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [extendedTestData], {fromEffect: this.effect.id});\r\n",
    "8zTkDVziBPaNbMQX": "let filters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"spell\"\r\n    },\r\n    {\r\n        property : \"system.lore.value\",\r\n        value : \"petty\"\r\n    }\r\n]\r\n\r\nlet petty = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 6, \"Wybierz 6 Zaklęć Magii Prostej\")\r\n\r\n\r\nfilters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"spell\"\r\n    },\r\n    {\r\n        property : \"system.lore.value\",\r\n        value : \"\"\r\n    }\r\n]\r\n\r\nlet arcane = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 9, \"Wybierz 9 Zaklęć Magii Tajemnej\")\r\n\r\nlet items = petty.concat(arcane).map(i => i.toObject())\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);",
    "9A7rYY3FKi5XLihG": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.5QcrpLQWWrsbKR79\")\r\nlet data = item.toObject();\r\ndata.system.tests.value = data.system.tests.value.replace(\"monet\", \"metalowych przedmiotów\");\r\ndata.system.description.value += \"<p>Ten talent jest rozszerzony również na dowolny metalowy obiekt ze względu na <strong>Metallic Affinity</strong></p>\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "9fK07tqqZyPg7dpx": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields : {difficulty: \"veasy\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n      this.script.scriptNotification(\"Otrzymano <strong>Ropiejącą Ranę</strong>\")\r\n      let item = await fromUuid(\"Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb\")\r\n      this.actor.createEmbeddedDocuments(\"Item\", [item.toObject()])\r\n}\r\nelse \r\n{\r\n    this.script.scriptNotification(\"Uniknięto <strong>Ropiejącej Rany</strong>\")\r\n}\r\n",
    "9JnPK1jNUEso7Pv8": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.9h82z72XGo9tfgQS\")\r\nlet data = item.toObject();\r\ndata.name += ` (${game.i18n.localize(\"SPEC.Smell\")})`\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "9VfeubiCV83LN9iY": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.AtpAudHA4ybXVlWM\")\r\nlet data = item.toObject();\r\ndata.name += ` (Podczas Szarży)`\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "9Yn9uViEjcuaESJ2": "if (this.item.getFlag(\"wfrp4e\", \"failedCool\"))\r\n{\r\n    this.item.name += \" (Brak PP)\"\r\n    this.item.system.AP = {\r\n        \"head\": 0,\r\n        \"lArm\": 0,\r\n        \"rArm\": 0,\r\n        \"lLeg\": 0,\r\n        \"rLeg\": 0,\r\n        \"body\": 0\r\n      }\r\n}",
    "a02tlRCXpaoaDjSN": "let careers = await game.wfrp4e.utility.findAll(\"career\", \"\", true);\r\ncareers.forEach(c => {\r\n    if (!c.id)\r\n    {\r\n        c.id = c._id;\r\n    }\r\n});\r\nlet choice = await ItemDialog.create(careers, 1, \"Wybierz karierę dla 'Sekretnej Tożsamości'\");\r\nif (choice[0])\r\n{\r\n    let career = await fromUuid(choice[0].uuid);\r\n    let data = career.toObject();\r\n    setProperty(data, \"flags.wfrp4e.doubleLife\", true);\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n    this.effect.updateSource({name : this.effect.name + ` (${data.name})`})\r\n}\r\n",
    "A0OK0qAMmnf8iNJf": "if (args.test.result.SL < 0)\r\n{\r\n    this.script.scriptMessage(`Otrzymano punkty zepsucia: ${Math.abs(args.test.result.SL)}`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    if (args.test.failed && this.actor.type == \"character\")\r\n    {\r\n        this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + Math.abs(args.test.result.SL)})\r\n    }\r\n}",
    "A1odAcuRbq9797ZB": "let choice1 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Biała (Podstawowa)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 10\r\n                }\r\n            }\r\n        }\r\n    }\r\n]\r\nlet choice2 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Biała (Drzewcowa)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 10\r\n                }\r\n            }\r\n        }\r\n    }\r\n]\r\n\r\nlet choice = await Dialog.wait({\r\n    title : \"Choice\",\r\n    content : \r\n    `<p>\r\n    Wybierz Umiejętność, której chcesz używać\r\n    </p>\r\n    <ol>\r\n    <li>Broń Biała (Podstawowa)</li>\r\n    <li>Broń Biała (Drzewcowa)</li>\r\n    </ol> \r\n    `,\r\n    buttons : {\r\n        1 : {\r\n            label : \"Podstawowa\",\r\n            callback : () => {\r\n                return choice1;\r\n            }\r\n        },\r\n        2 : {\r\n            label : \"Drzewcowa\",\r\n            callback : () => {\r\n                return choice2;\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Nie odnaleziono umiejętności ${c.name}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "A3fvV69RS1lYgma0": "if (this.actor.type == \"character\")  \r\n  this.actor.corruptionDialog(\"minor\")\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {skipTargets: true, appendTitle :  \" - \" + this.effect.name})\r\nawait test.roll();\r\nif(test.failed)\r\n{\r\n    await this.actor.addCondition(\"unconscious\");\r\n    let secondTest = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {fields : {difficulty : \"easy\"}, skipTargets: true, appendTitle :  \" - Rozpacz\"})\r\n    await secondTest.roll();\r\n    if(secondTest.failed)\r\n    {\r\n         await this.actor.addCondition(\"fatigued\");\r\n    }\r\n}",
    "a4Aza4a9v8JMU8dC": "const talents = await Promise.all([\"Szał Bojowy\", \"Odporność na Magię\"].map(game.wfrp4e.utility.findTalent))\r\nthis.actor.createEmbeddedDocuments(\"Item\", talents, {fromEffect : this.effect.id})",
    "A6DcKPzAGntzSCil": "let roll = await new Roll(\"1d10\").roll()\r\n\r\nroll.toMessage(this.script.getChatData({flavor : `${this.effect.name} (Czas trwania)`}));\r\n\r\nthis.effect.updateSource({\"duration.rounds\" : roll.total})",
    "a7pEvCycVnFBXGAQ": "let test = await this.actor.setupCharacteristic(\"i\", {skipTargets: true, appendTitle :  \" - Oszołomienie\", fields : {difficulty : \"easy\"}})\r\nawait test.roll();\r\n\r\nif (!test.succeeded)\r\n{\r\n\tthis.actor.addCondition(\"stunned\");\r\n}",
    "a8i0sA1RBnD8nHZt": "let caster = this.effect.sourceActor\r\nlet targetedItem = this.actor.items.get(this.effect.flags.wfrp4e.itemTargets[0])\r\n\r\nlet qualities = foundry.utils.deepClone(game.wfrp4e.config.itemQualities);\r\nlet flaws = foundry.utils.deepClone(game.wfrp4e.config.itemFlaws);\r\n\r\nif (targetedItem.type == \"weapon\")\r\n{\r\n    mergeObject(qualities, game.wfrp4e.config.weaponQualities)\r\n    mergeObject(flaws, game.wfrp4e.config.weaponFlaws)\r\n}\r\nelse if (targetedItem.type == \"armour\")\r\n{\r\n    mergeObject(qualities, game.wfrp4e.config.armorQualities)\r\n    mergeObject(flaws, game.wfrp4e.config.armorFlaws)\r\n}\r\n\r\nfor(let q in qualities)\r\n{\r\n    // If the weapon already has a flaw, don't put it in the dialog\r\n    if (targetedItem.system.properties.qualities[q])\r\n    {\r\n        delete qualities[q]\r\n    }\r\n}\r\nfor(let f in flaws)\r\n{\r\n    // If a weapon doesn't have a flaw, don't put it in the dialog\r\n    if (!targetedItem.system.properties.flaws[f])\r\n    {\r\n        delete flaws[f]\r\n    }\r\n}\r\n            \r\nlet added = await ItemDialog.create(ItemDialog.objectToArray(qualities), \"unlimited\", \"Wybierz Zalety do dodania\");\r\nlet removed = []\r\nif (!foundry.utils.isEmpty(flaws))\r\n{\r\n    removed = await ItemDialog.create(ItemDialog.objectToArray(flaws), \"unlimited\", \"Wybierz Wady do usunięcia\");\r\n}\r\n\r\nthis.effect.updateSource({\"flags.wfrp4e.propertiesChanged\" : {added : added.map(i => i.id), removed : removed.map(i => i.id)}})\r\n",
    "abLWYtNTu1UVDQAs": "if (args.opposedTest.result.hitloc.value == this.effect.flags.wfrp4e.location) // e.g. 'head', rLeg, 'lArm'\r\n{\r\n     this.scriptMessage(`Otrzymano Stan @Condition[Oślepienie] ponieważ trafiono w: <strong>${this.item.name}</strong>`);\r\n     this.actor.addCondition(\"blinded\");\r\n}",
    "ACgKpKrEEHoNGG0h": "return !args.skill?.name.includes(\"Splatanie Magii\") && args.type != \"channelling\"",
    "ACtDCTLZXmd5uXjX": "let halve;\r\nif (args.opposedTest.attackerTest.item?.type != \"spell\")\r\n{\r\n    halve = await Dialog.confirm({title : this.effect.name, content : \"Obrażenia obniżone o połowę? (Zmniejsza obrażenia, które nie pochodzą od ognia, zimna i magii)\"})\r\n}\r\nelse\r\n{\r\n    halve = false;\r\n}\r\n\r\nif (halve)\r\n{\r\n    args.totalWoundLoss /= 2;\r\n    args.modifiers.other.push({label : this.effect.name, details : \"Zmniejszono o Połowę\", value : \"× 0.5\"})\r\n}",
    "aCVtaW8ag1WibcAr": "args.attacker.modifyWounds(1)\r\nthis.script.scriptMessage(`<strong>${args.attacker.prototypeToken.name}</strong> Odzyskuje 1 Punkt Żywotności.`)",
    "Adgs6Zs0FdefO6qx": "if (args.test.options.pilot && args.test.result.reversed)\r\n{\r\n\targs.test.data.result.SL = \"+\" + Math.min(1, Number(args.test.data.result.SL))\r\n\targs.test.result.other.push(`<b>${this.effect.name}</b>: PS ograniczone do 1`)\r\n}",
    "AMI2wDJqsIZsoq1e": "if (args.opposedTest.result.differenceSL >= 0 && args.opposedTest.result.differenceSL <= 2 && args.opposedTest.result.winner == \"attacker\")\r\n{ \r\n    this.script.scriptMessage(`Emituje chmurę śmierdzącego proszku. Aktywuj Efekt <strong>Kary do Ogłady</strong> na @UUID[${this.actor.uuid}].`, {blind : true, whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "AMxezwtYnWCF6Oza": "return args.skill?.name == \"Broń Zasięgowa (Prochowa)\"",
    "ApaLcUhuty3EzJoP": "let fortunePoints = this.effect.sourceTest.result.overcast.usage.other.current\r\nlet current = this.actor.status.fortune.value\r\n\r\nthis.actor.update({\"system.status.fortune.value\" : fortunePoints + current})\r\n\r\nthis.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b> Punkty Szczęścia wzrosły z ${current} do ${fortunePoints + current}`)",
    "B950b0XnIUYCdVwu": "let test = await args.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {skipTargets: true, appendTitle :  \" - \" + this.effect.name})\r\nawait test.roll();\r\n\r\nif (test.succeeded)\r\n{\r\n    if (args.totalWoundLoss <= parseInt(test.result.SL))\r\n    {\r\n        args.abort = `<strong>${this.effect.name}</strong>: Atak odbity i odwzajemniony`\r\n    }\r\n    args.modifiers.other.push({label : this.effect.name, value : -1 * parseInt(test.result.SL)})\r\n}",
    "bBdXzBmxgFFBwMMS": "if(args.opposedTest.attackerTest.item?.isRanged && args.applyAP && !args.sureShot)\r\n{\r\n   if (args.modifiers.ap.value)\r\n   {\r\n    args.sureShot = true;\r\n    args.modifiers.ap.details.push(`${this.effect.name} (Ignoruje ${this.item.Advances})`)\r\n    args.modifiers.ap.ignored += this.item.Advances;\r\n   }\r\n}",
    "BD7bVTU2pVoRSRBe": "let symptoms = {\r\n    convulsions : \"Konwulsje\",\r\n    coughsandsneezes : \"Kaszel i Katar\",\r\n    fever : \"Gorączka\",\r\n    flux : \"Biegunka\",\r\n    nausea : \"Mdłości\"\r\n}\r\n\r\nlet roll = await (new Roll(`max(0, 1d10 - ${this.actor.characteristics.wp.bonus})`).roll())\r\nroll.toMessage(this.script.getChatData());\r\n\r\nlet choices = await ItemDialog.create(ItemDialog.objectToArray(symptoms), roll.total, \"Wybierz Symptom\");\r\n\r\nif (choices.length)\r\n{\r\n    let symptomEffects = duplicate(game.wfrp4e.config.symptomEffects)\r\n    let added = []\r\n    for(let choice of choices)\r\n    {\r\n        let symptom = symptomEffects[choice.id];\r\n        symptom.origin = this.effect.uuid;\r\n        added.push(symptom);\r\n    }\r\n    this.actor.createEmbeddedDocuments(\"ActiveEffect\", added)\r\n}\r\nelse \r\n{\r\n    this.effect.delete();\r\n}\r\n\r\n",
    "bEVlJOOA1kLlzpWx": "let characteristics = {\r\n    \"ws\" : 10,\r\n    \"bs\" : 0,\r\n    \"s\" : 5,\r\n    \"t\" : 15,\r\n    \"i\" : 20,\r\n    \"ag\" : 15,\r\n    \"dex\" : 20,\r\n    \"int\" : 35,\r\n    \"wp\" : 30,\r\n    \"fel\" : 10\r\n}\r\nlet skills = [\"Splatanie Magii\", \"Opanowanie\", \"Unik\", \"Występy (Gawędziarstwo)\", \"Intuicja\", \"Język (Magiczny)\", \"Dowodzenie\", \"Wiedza (Magia)\", \"Wiedza (Teologia)\", \"Percepcja\"]\r\nlet skillAdvancements = [20, 25, 20, 25, 30, 25, 15, 20, 10, 30]\r\nlet talents = [\"Zmysł Magii\", \"Magia Tajemna (Dowolna Tradycja)\", \"Precyzyjne Inkantowanie\", \"Precyzyjne Inkantowanie\", \"Szczęście\", \"Wykrywanie Magii\", \"Groźny\", \"Magia Prosta\", \"Percepcja Magiczna\", \"Szósty Zmysł\"]\r\nlet trappings = [\"Broń ręczna\", \"Kostur\", \"Rytualna szata zawierająca wiele ornamentów i zdobień\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        items.push({name : trapping, type : \"trapping\", \"system.trappingType.value\" : \"clothingAccessories\"})\r\n        //ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "bLkt8VpTTPoTxW0W": "if (args.opposedTest.result.hitloc.value == \"body\" && args.totalWoundLoss > 0)\r\n{\r\n    args.actor.addCondition(\"bleeding\", 1);\r\n    this.script.scriptNotification(\"Dodano krwawienie\")\r\n}\r\n",
    "bMEFHPCei2evnZZw": "// Victims that take at least 1 Wound from a Fell Dagger\r\n// immediately take a Poisoned Condition \r\n// resisted with a Difficult (-10) Endurance Test. \r\n\r\n// TODO: Add Venom strength to message\r\n\r\nif (args.totalWoundLoss > 0) \r\n{\r\n  args.actor.addCondition(\"poisoned\")\r\n  this.script.scriptMessage(`\r\n      <strong>${this.effect.name}</strong>:<br>\r\n      <strong>${args.actor.name}</strong>: otrzymano Stan @Condition[Zatrucie], który może zostać odparty <strong>Wymagającym (-10) Testem Odporności </strong>.`, \r\n      {whisper: ChatMessage.getWhisperRecipients(\"GM\")})\r\n}\r\n",
    "bRtZH0xRh8dgqMeW": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.BqPZn6q3VHn9HUrW\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = 7 - this.actor.characteristics.s.bonus\r\ndata.name = item.name.replace(\"()\", \"\");\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "btPrQkGRKUkhNe3N": "return args.skill?.name == \"Rzemiosło (Aptekarstwo)\"",
    "BtyFhdGMKiMamGhM": "let test = await args.actor.setupSkill(\"Unik\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nlet damage = parseInt(this.effect.sourceTest.result.SL)\r\n\r\nif (test.succeded)\r\n{\r\n   damage =  damage + 8 - parseInt(test.result.SL)\r\n}\r\n\r\nelse \r\n{\r\n   damage = damage + 10\r\n   this.actor.addCondition(\"entangled\", 3)\r\n}\r\nthis.script.scriptMessage(await this.actor.applyBasicDamage(damage, {loc : \"roll\", suppressMsg: true}))\r\n",
    "CCK1iIfPmB398ziT": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Athletics\"), {fields : {difficulty : \"difficult\"}, skipTargets: true, appendTitle :  \" - Poruszanie się\"})\r\ntest.roll();",
    "ch5SD2XOQfcYo0X5": "if (args.sizeDiff <= -2 && args.opposedTest.attackerTest.result.critical)\r\n        args.damageMultiplier = Math.abs(args.sizeDiff)\r\n\r\n      let sBonusDiff = args.opposedTest.defenderTest.actor.characteristics.t.bonus - args.opposedTest.attackerTest.actor.characteristics.s.bonus\r\n     let weapon = args.opposedTest.attackerTest.item\r\n      if (sBonusDiff > 0 && weapon && weapon.damage.value.includes(\"BS\"))\r\n      {\r\n        args.damage += sBonusDiff\r\n        args.breakdown.other.push({label : this.effect.name, value : sBonusDiff});\r\n      }",
    "CHnaBPHk6HdFS512": "let arm = await fromUuid(\"Compendium.wfrp4e-core.items.MnMZv7ZXoRqoH9dS\");\r\nlet leg = await fromUuid(\"Compendium.wfrp4e-core.items.k00PimCWkff11IA0\");\r\n\r\nlet choice = await ItemDialog.create([arm, leg], 1, \"Wybierz Kończynę\")\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", choice, {fromEffect: this.effect.id})",
    "chUpiI3el8IO8MSs": "if (args.opposedTest.attackerTest.item?.name.includes(\"Ugryzienie\"))\r\n{\r\n    let woundsGained = args.totalWoundLoss;\r\n    this.script.scriptMessage(`Otrzymano Rany: ${woundsGained}`, { whisper: ChatMessage.getWhisperRecipients(\"GM\") })\r\n    this.actor.modifyWounds(woundsGained)\r\n}",
    "CiFeduksZJ6PRulx": "return args.skill?.name == \"Jeździectwo (Konie)\" || (args.options.dodge && this.actor.isMounted);",
    "CIxZYkHggBQ6EsHP": "this.script.scriptNotification(\"Efekt wykorzystany!\");\r\nthis.effect.delete();",
    "cJFDnq1HI4gXWcJo": "if (isNaN(parseInt(this.item.system.specification.value)))\r\n{\r\n    let value = await ValueDialog.create(\"Wartość Ochrony\", \"Podaj Wartość Cechy Stworzenia Ochrona\");\r\n    if (value)\r\n    {\r\n     this.item.updateSource({\"system.specification.value\" : value});\r\n    }\r\n}",
    "Cjj4iLkdY1NaZRCi": "if ((args.opposedTest.attackerTest.item && args.opposedTest.attackerTest.item.isMelee) || (args.opposedTest.attackerTest.item && !args.opposedTest.attackerTest.item.name.includes(\"Broń Zasięgowa\")))\r\n{\r\n    let choice = await Dialog.wait({\r\n        title: this.effect.name,\r\n        content: `<p><strong>${this.effect.name}</strong>: Zadać obrażenia atakującemu?`,\r\n        buttons: {\r\n            yes: {\r\n                label: \"Tak\",\r\n                callback: () => {\r\n                    return true;\r\n                }\r\n            },\r\n            no: {\r\n                label: \"Nie\",\r\n                callback: () => {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n    })\r\n\r\n    if (choice)\r\n    {\r\n        this.script.scriptMessage(await args.attacker.applyBasicDamage(this.actor.system.characteristics.wp.bonus, {damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_AP, suppressMsg : true}));\r\n    }\r\n}",
    "cK1Jysfu5IMUUH0C": "if (!args.ward)\r\n{\r\n\targs.ward = (this.effect.getFlag(\"wfrp4e\", \"ward\") || 0);\r\n\tif (args.wardRoll >= args.ward && args.ward > 3)\r\n    {\r\n        let newWard = Math.max(3, args.ward - 1)\r\n        this.script.scriptMessage(\"<strong>Ochrona</strong> zwiększona do: \" + newWard)\r\n        this.effect.setFlag(\"wfrp4e\", \"ward\", newWard)\r\n    }\r\n\r\n}",
    "CoImIH9OCMx9DfQZ": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.nbhn2wX35b7Jrcbg\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Szczęka\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})",
    "csLKDJKZaUK9vwLT": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.7rBhIRo96Mydo0Cv\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Plecy\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n",
    "cUnbADgOQ4fMKgrH": "let group\r\nlet item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.5hH73j2NgPdsLCZN\");\r\nlet data = item.toObject();\r\n\r\nif (this.item.name.includes(\"(\"))\r\n{\r\n\tgroup = this.item.parenthesesText\r\n}\r\n\r\nelse \r\n{\r\n\tgroup = await ValueDialog.create(\"Wybierz grupę dażoną nienawiścią\", \"Obiekt Nienawiści\")\r\n\r\n\tthis.item.updateSource({name : this.item.name + ` (${group})`});\r\n\tthis.effect.updateSource({name : this.effect.name + ` (${group})`});\r\n}\r\n\r\n\r\ndata.name = data.name.replace(\"x\", group);\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id});",
    "CW5Vlr57OaMkKJ8Q": "if (this.actor.system.status.advantage.value >= 3)\r\n{\r\n    this.actor.modifyAdvantage(-3);\r\n    this.script.scriptNotification(\"Odjęto Punkty Przewag\")\r\n}\r\nelse \r\n{\r\n    return this.script.scriptNotification(\"Niewystarczająca liczba Punktów Przewag!\", \"error\")\r\n}\r\n\r\nlet test = await this.actor.setupTrait(this.item)\r\nawait test.roll();",
    "CWNGrg7se91RC95g": "if (args.totalWoundLoss > 0) {\r\n  args.opposedTest.result.other.push(\r\n  `@Corruption[minor]{Wystawienie na Umiarkowane Zepsucie}`\r\n  )\r\n  this.script.scriptMessage(`<strong>${this.effect.name}</strong>: \r\n      @Corruption[moderate]{Wystawienie na Umiarkowane Zepsucie} <br/>\r\n      <strong>${args.actor.prototypeToken.name}</strong> musi wykonać test na \r\n      <strong>Zepsucie (Umiarkowane)</strong>`, \r\n      {whisper: ChatMessage.getWhisperRecipients(\"GM\")}\r\n  )\r\n}",
    "dbOSvpgcPjsc2uvq": "let menacing = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.0hn6UaKq8CoZP2zD\")).toObject();\r\nlet sense = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.9h82z72XGo9tfgQS\")).toObject();\r\n\r\nsense.name += \" (Wzrok)\";\r\nsense.system.tests.value = sense.system.tests.value.replace(\"Zmysł\", \"Wzrok\")\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", [menacing, sense], {fromEffect : this.effect.id})",
    "dcwY8dCd3PNCEzk6": "let current = this.actor.status.fate.value\r\n\r\nthis.actor.update({\"system.status.fate.value\" : current + 1})\r\n\r\nthis.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b> Punkty Szczęścia zwiększone z ${current} do ${current + 1}`)",
    "dfEgat3jz4EtWszH": "return args.skill?.name == \"Skradanie (Miasto)\"",
    "dfnCK8jCPXNLM7Gh": "let aoeDamage = this.effect.sourceTest.result.damage - 5 // Easily handle magic missile damage by just subtracting 5 from the item's (which has +10 base)\r\n\r\nthis.script.scriptMessage(await this.actor.applyBasicDamage(aoeDamage, {damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_AP, suppressMsg : true}))\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Dodge\"), {skipTargets: true, appendTitle :  ` - Podpalenie`})\r\n\r\nawait test.roll();\r\n\r\nif (!test.succeeded)\r\n{\r\n    this.actor.addCondition(\"ablaze\");\r\n}",
    "DHxUKY9LMyifFgCi": "return args.skill?.name == \"Rzemiosło (Aptekarstwo)\" || args.skill?.name == \"Rzemiosło (Alchemia)\"",
    "dIxYt421K010eogY": "let modifier = 0\r\nif (this.effect.name.includes(\"Umiarkowan\"))\r\n    modifier = -20\r\nelse\r\n    modifier = -10\r\nargs.fields.modifier += modifier",
    "DL9vYNft9aXdV2aW": "let tooth = await fromUuid(\"Compendium.wfrp4e-core.items.pLW9SVX0TVTYPiPv\")\r\ntooth = tooth.toObject()\r\ntooth.system.specification.value = 3\r\ntooth.system.qualities.value = [{name : \"magical\"}]\r\n \r\nlet claw = await fromUuid(\"Compendium.wfrp4e-core.items.AtpAudHA4ybXVlWM\")\r\nclaw = claw.toObject()\r\nclaw.system.specification.value = 4\r\nclaw.system.qualities.value = [{name : \"magical\"}]\r\nclaw.name = \"Szpony\"\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", [tooth, claw], {fromEffect : this.effect.id})",
    "dM449AU0FQRnOc3l": "if (args.opposedTest.result.hitloc.value == \"head\")\r\n{\r\n  args.abort = \"Pudło - Brak Głowy\"\r\n}",
    "dM8FbRH2V8CpOkXw": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.QluSTTTq3viHJJUh\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Żebra\";\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})",
    "DmbWR9s5I8LHBwxB": "let column = await ValueDialog.create(\"Wybierz kolumnę, aby rzucić i określić głowę Bestii\", \"Wybierz Kolumnę\", \"\", [\"Niepodzielny\", \"Khorne\", \"Nurgle\", \"Slaanesh\", \"Tzeentch\"]);\r\n\r\nif (column)\r\n{\r\n    let result = await game.wfrp4e.tables.rollTable(\"beasthead\", {}, column);\r\n    this.script.scriptMessage(`<strong>${result.title}</strong><br>${result.result}`);\r\n    let uuid = `Compendium.${result.object.documentCollection}.${result.object.documentId}`;\r\n    let item = await fromUuid(uuid);\r\n    if (item)\r\n    {\r\n        this.actor.createEmbeddedDocuments(\"Item\", [item])\r\n        this.item.delete();\r\n    }\r\n}",
    "dtFvpY96RPzNnphq": "return !(args.skill?.name.includes(\"Broń Biała (Podstawowa)\") || (args.type == \"weapon\" && args.item?.system.weaponGroup.value == \"basic\"))",
    "DuM5l2Yb4bdvDeaG": "return args.skill?.name != \"Atletyka\"",
    "DWBxvzfWGcG7PVNP": "let letter = this.item.system.location.key[0]; // \"l\" or \"r\";\r\n\r\nthis.item.updateSource({\"system.location.key\" : letter + \"Palec\"})\r\n\r\n// We want the location to be Right or Left Hand, but the key to be rFinger or lFinger",
    "dwSgcFxKN3S0hLJL": "return args.skill?.name != \"Broń Biała (Bijatyka)\" && args.item?.weaponGroup?.value != \"brawling\"",
    "DyZ1jH88EAp1ueOK": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.GlShFJF2TpsNh1FX\")\r\nlet data = item.toObject();\r\ndata.system.location.key = this.item.system.location.key\r\ndata.system.location.value = data.system.location.value.replace(\"Ręka\", \"Nadgarstek\")\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n",
    "E1vUepgop09FF5wy": "if (this.actor.system.status.advantage.value == 0)\r\n{\r\n    return this.script.scriptNotification(\"Niewystarczająca liczba Punktów Przewag!\", \"error\")\r\n}\r\n\r\nlet hatred = await fromUuid(\"Compendium.wfrp4e-core.items.Item.aE3pyW20Orvdjzj0\")\r\nlet frenzy = await fromUuid(\"Compendium.wfrp4e-core.items.Item.yRhhOlt18COq4e1q\");\r\n\r\nif (this.actor.system.status.advantage.value >= 3)\r\n{\r\n    this.script.scriptNotification(`Dodano: ${frenzy.name}`)\r\n    this.actor.setAdvantage(0)\r\n    this.actor.createEmbeddedDocuments(\"Item\", [frenzy])\r\n}\r\nelse if (this.actor.system.status.advantage.value >= 1)\r\n{\r\n    let data = hatred.toObject();\r\n    data.system.specification.value = \"Przeciwnicy w bliskim zasięgu\"\r\n    this.script.scriptNotification(`Dodano: ${hatred.name}`)\r\n    this.actor.setAdvantage(0)\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data])\r\n}",
    "e34s1XxHckAWfwHt": "if (args.test.options.beatBlade && (args.test.result.roll <= game.settings.get(\"wfrp4e\", \"automaticSuccess\") || args.test.result.roll <= args.test.target))\r\n{\r\n   args.test.result.other.push(`<b>${this.effect.name}</b>: Utracone Punkty Przewagi Przeciwnika: ${Number(args.test.result.SL) + 1}`)\r\n}",
    "E7D4bxz8gy4e1wL7": "return [\"Skradanie (Wieś)\", \"Tropienie\", \"Sztuka Przetrwania\", \"Pływanie\", \"Percepcja\", \"Intuicja\"].includes(args.item?.name);",
    "e7IxnxePdXSy6L4E": "if (args.opposedTest.result.hitloc.value == \"head\")\r\n{\r\n     this.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b>: otrzymano @Table[crithead]{Ranę Krytyczną Głowy}, jeśli jeszcze nie została zadana.`)\r\n}",
    "ebDQH0MdGAG02CHl": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.SYjWiKDzMS6CtROJ\")\r\nlet data = item.toObject();\r\ndata.system.location.key = this.item.system.location.key\r\nif (this.item.system.location.key == \"rArm\")\r\n{\r\n\tdata.system.location.value = \"Prawa Ręka\"\r\n\tdata.system.location.key = \"rHand\"\r\n}\r\nelse if (this.item.system.location.key == \"lArm\")\r\n{\r\n\tdata.system.location.value = \"Lewa Ręka\"\r\n\tdata.system.location.key = \"lHand\"\r\n}\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data])",
    "ed7Sud9HM3uB2j6b": "ChatMessage.create({content : \"<em>Krzycz lub Umieraj!</em>\", speaker : ChatMessage.getSpeaker({token: this.actor.getActiveTokens()[0]?.document, actor: this.actor})}, {chatBubble : true})\r\nlet item = await fromUuid(\"Compendium.wfrp4e-core.items.pTorrE0l3VybAbtn\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = 2;\r\nthis.script.scriptNotification(\"Dodano: \" + data.name);\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id});\r\ngame.wfrp4e.utility.postFear(2, this.actor.prototypeToken.name)",
    "EdTChmSouS0MSmk5": "let test = await this.actor.setupCharacteristic(\"wp\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nif (test.succeeded)\r\n{\r\n    this.script.scriptMessage(\"Można wykonać Akcję lub Ruch w tej rundzie (wybierz jedno)\")\r\n}\r\nelse \r\n{\r\n    this.script.scriptMessage(\"Nie można wykonać Akcji ani Ruchu w tej rundzie\")    \r\n}",
    "egDtqMxe3iekc6hv": "let trait = args.opposedTest.attackerTest.item\r\nlet woundLossEffect = this.item.effects.get(\"7Amhi75wLv0PvGjd\")\r\nif (trait && trait.name.includes(\"Ugryzenie\") && woundLossEffect)\r\n{\r\n    args.actor.applyEffect({effectUuids : woundLossEffect.uuid})\r\n}",
    "eh1J3s0s4A2AxoFp": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.8pVzgPkgWpTJvfhG\");\r\nlet data = item.toObject();\r\ndata.name += \" (Wróg)\";\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})",
    "EJaBfqADqlo92Fx6": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.oGbDwnLOn3isPJpO\")\r\nlet data = item.toObject();\r\ndata.name += \" (Do ustalenia)\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "EJObiSth3WdcJOXN": "if (args.test.characteristicKey == \"wp\" && args.test.failed && args.test.result.SL <= -3)\r\n{\r\n    this.script.scriptNotification(\"Dodano: Powalenie\");\r\n    this.actor.addCondition(\"prone\")\r\n}",
    "ekjJQHyMbZT2vqdc": "let uses = this.item.getFlag(\"wfrp4e\", \"uses\") || 0;\r\nuses++;\r\nthis.script.scriptNotification(`Wykorzystano: ${uses}`)\r\nthis.item.setFlag(\"wfrp4e\", \"uses\", uses);\r\nif (uses >= 3)\r\n{\r\n\tthis.effect.update({\"flags.wfrp4e.applicationData.type\" : \"other\"})\r\n\tthis.script.scriptNotification(`Zurzyty`);\r\n}\r\n",
    "EmmG49pMOPHRwDzR": "   let roll = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n   if (args.test.isFumble && roll == 1 && !args.test.result.misfire)\r\n  {\r\n          args.test.result.misfire = game.i18n.localize(\"Misfire\") + \" (Wyrzucono 1)\"\r\n          args.test.result.misfireDamage = eval(parseInt(args.test.result.roll.toString().split('').pop()) + args.test.item.Damage)\r\n  }\r\n  else if (args.test.isFumble && roll != 1)\r\n      args.test.result.other.push(\"Rzut na niewypał: \" + roll)\r\n",
    "ENGmwaItRXO5s0XY": "await this.actor.modifyWounds(this.actor.system.characteristics.t.bonus * 3)\r\nthis.script.scriptMessage(`Uleczone Rany: ${this.actor.system.characteristics.t.bonus * 3}`)\r\n\r\nthis.actor.hasCondition(\"bleeding\")?.delete()\r\nthis.actor.hasCondition(\"fatigued\")?.delete()\r\n",
    "ePPgxQOqL1Uhz2k9": "let choice1 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Zasięgowa (Łuk)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 10\r\n                }\r\n            }\r\n        }\r\n    },\r\n    {\r\n        type : \"weapon\",\r\n        name : \"Łuk długi\",\r\n    },\r\n    {\r\n        type : \"ammunition\",\r\n        name : \"Strzała\",\r\n    }\r\n]\r\nlet choice2 = [\r\n]\r\n\r\nlet choice = await Dialog.wait({\r\n    title : \"Opcjonalne\",\r\n    content : \r\n    `<p>\r\n    Dodać opcjonalne przedmioty?\r\n    </p>\r\n    <ol>\r\n    <li>Broń Zasięgowa (Łuk) +10 oraz długi łuk z 12 strzałami</li>\r\n    </ol> \r\n    `,\r\n    buttons : {\r\n        1 : {\r\n            label : \"Tak\",\r\n            callback : () => {\r\n                return choice1;\r\n            }\r\n        },\r\n        2 : {\r\n            label : \"Nie\",\r\n            callback : () => {\r\n                return choice2;\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "eqxE7nBO13yJS7hc": "let roll = (await new Roll(\"1d10\").roll())\r\nroll.toMessage({flavor: \"Uleczono Rany\", speaker : {alias : this.actor.name}})\r\n\r\nthis.actor.modifyWounds(roll.total)\r\n\r\nthis.actor.hasCondition(\"bleeding\")?.delete();",
    "ERxrWzSpw8qwxFVi": "this.script.scriptNotification(`Nie można wejść: ${this.effect.name}!`); this.actor.addCondition(\"broken\");",
    "ezGqDoC9hNRBnFTB": "        let choices = await Promise.all([game.wfrp4e.utility.findItemId(\"1zaqojk0Oq1m8vYv\"), game.wfrp4e.utility.findItemId(\"zIuarD5mB0EF0ji0\")])\r\n        let items = await game.wfrp4e.apps.ItemDialog.create(choices, 1, \"Wybierz broń\")\r\n        items = items.map(i => i.toObject())\r\n        \r\n        items.forEach(i => equip(i))\r\n        \r\n        this.actor.createEmbeddedDocuments(\"Item\", items);\r\n        \r\n        function equip(item)\r\n        {\r\n            if (item.type == \"armour\")\r\n                item.data.worn.value = true\r\n            else if (item.type == \"weapon\")\r\n                item.data.equipped = true\r\n            else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\r\n                item.data.worn = true\r\n        }",
    "f062aa2BNClx08D6": "let test = await args.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\n    await test.roll();\r\n    if (test.failed) \r\n    {\r\n      let toughnessLost = parseInt(this.effect.sourceTest.result.SL)\r\n\r\n      let currentModifier = this.actor.characteristics.t.modifier\r\n\r\n      await this.actor.update({ \"system.characteristics.t.modifier\": currentModifier - toughnessLost })\r\n      this.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b> utracone punkty Wytrzymałości: ${toughnessLost}`)\r\n      if (this.actor.system.characteristics.t.value <= 0)\r\n      {\r\n          this.actor.addCondition(\"dead\");\r\n      }\r\n\r\n    }",
    "f4vvAGQ8OGoEbrgy": "let SL = args.opposedTest.attackerTest.result.SL - args.opposedTest.attackerTest.item.cn.value\r\nlet difficulty = \"challenging\"\r\nif (SL >= 1)\r\n   difficulty = \"difficult\"\r\nif (SL >= 2)\r\n   difficulty = \"hard\"\r\nif (SL >= 3)\r\n   difficulty = \"vhard\"\r\n   \r\n\r\nlet test = await args.actor.setupCharacteristic(\"wp\", {fields: {difficulty}, skipTargets: true, appendTitle :  \" - \" + this.effect.name, context : {failure: \"Otrzymano Stan Oszołomienie\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    args.actor.addCondition(\"stunned\");\r\n}",
    "f5Mp3kXwCFdPkW6N": "return args.skill?.name != \"Występy (Śpiew)\" && args.skill?.name != \"Występy (Śpiewanie)\" && !args.skill?.name.includes(\"Język\");",
    "fEFfHFeJxkR0aIJK": "if (args.opposedTest.result.differenceSL >= 0 && args.opposedTest.result.differenceSL <= 3 && args.opposedTest.result.winner == \"attacker\")\r\n{ \r\n    this.script.scriptMessage(`Wszyscy w zasięgu 20 metrów otrzymują 1 Ranę oraz muszą wykonać <strong>Wymagający (-10) Test Odporności</strong> lub otrzymają Stan @Condition[Ogłuszenie]`, {blind : true,  whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}\r\n    ",
    "FiD3mvWIBHNNIuO9": "if (args.opposedTest.result.hitloc.value == \"body\")\r\n{\r\n   if ((await new Roll(\"1d2\").roll()).total == 1)\r\n   {\r\n       args.opposedTest.result.hitloc.value = \"head\"\r\n       this.script.scriptMessage(`Miejsce Trafienia zmienione na głowę`)\r\n   }\r\n}",
    "fiF9sM5UpcHMYa33": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.vMYEkrWj0ip6ZOdv\");\r\nlet data = item.toObject();\r\ndata.name += \" (Trucizny, Choroby, Chaos)\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", Array(this.effect.sourceTest.result.overcast.usage.other.current).fill(data), {fromEffect: this.effect.id})",
    "fP2edYbj6QjPPAjL": "return [\"Oswajanie\", \"Odporność\", \"Sztuka Przetrwania\"].includes(args.skill?.name)",
    "FqevMs0ukQ9WuUHl": "// Each time the blade is used, the GM should secretly roll a d10.\r\n// On a 1, its poison has run dry, \r\n// and the next time it is employed it will shatter.\r\n\r\nif (this.item.getFlag(\"wfrp4e\", \"brittle\"))\r\n{\r\n    ChatMessage.create({content: `<strong>${this.item.name}</strong> ulega rozbiciu!`})\r\n    this.item.update({name : `${this.item.name} (Rozbity)`})\r\n}",
    "FSqUqSByMiztYOQM": "if (args.totalWoundLoss > 0)\r\n     this.script.scriptMessage(`<b>Infekcja: ${args.actor.name}</b> musi zdać <b>Prosty (+40) Test Odporności</b> lub otrzyma @UUID[Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb]{Ropiejącą Ranę}`, {whisper: ChatMessage.getWhisperRecipients(\"GM\") })",
    "ft0LaRWZT5WtnptP": "let advantage = this.actor.system.status.advantage.value;\r\nif (advantage > 0)\r\n{\r\n    await this.actor.setAdvantage(0);\r\n    this.script.scriptNotification(\"Zmniejszono Punkty Przewag\")\r\n}\r\nelse \r\n{\r\n    return this.script.scriptNotification(\"Niewystarczająca liczba Punktów Przewag!\", \"error\")\r\n}\r\n\r\nlet test = await this.actor.setupTrait(this.item, {fields : {slBonus : advantage}})\r\nawait test.roll();",
    "Fvlc4RkeF4dHjW3m": "let caster = this.effect.sourceActor\r\nif (caster && (this.actor.has(game.i18n.localize(\"NAME.Undead\")) || this.actor.has(game.i18n.localize(\"NAME.Daemonic\")))) {\r\n    let wp = caster.system.characteristics.wp.value\r\n    if (wp > this.actor.system.characteristics.t.value) {\r\n        if (this.actor.has(game.i18n.localize(\"NAME.Unstable\"))) {\r\n            this.actor.update({ \"system.status.wounds.value\": 0 })\r\n            this.actor.addCondition(\"dead\")\r\n        }\r\n        else {\r\n            fromUuid(\"Compendium.wfrp4e-core.items.D0ImWEIMSDgElsnl\").then(item => {\r\n                this.actor.createEmbeddedDocuments(\"Item\", [item.toObject()], { fromEffect: this.effect.id })\r\n                ChatMessage.create({ content: `${this.actor.prototypeToken.name}: otrzymano ${game.i18n.localize(\"NAME.Unstable\")}`, speaker: { alias: caster.name } })\r\n            })\r\n        }\r\n    }\r\n}",
    "FXuyiJoXdAh6WhRK": "return args.skill?.name == \"Jeździectwo (Konie)\" && game.combat?.active",
    "fYLSe6CrYciap5y8": "        let characteristics = {\r\n            \"ws\" : 0,\r\n            \"bs\" : 0,\r\n            \"s\" : 10,\r\n            \"t\" : 10,\r\n            \"i\" : 0,\r\n            \"ag\" : 10,\r\n            \"dex\" : 0,\r\n            \"int\" : 0,\r\n            \"wp\" : 0,\r\n            \"fel\" : 0\r\n        }\r\n        let skills = [\"Mocna Głowa\", \"Wioślarstwo\", \"Żeglarstwo\", \"Pływanie\"]\r\n        let skillAdvancements = [10, 10, 10, 10]\r\n        let talents = []\r\n        let trappings = []\r\n        let items = []\r\n\r\n        let updateObj = this.actor.toObject();\r\n        \r\n        for (let ch in characteristics)\r\n        {\r\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n        }\r\n        \r\n        for (let index = 0; index < skills.length; index++)\r\n        {\r\n            let skill = skills[index]\r\n            let skillItem;\r\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n            if (skillItem)\r\n                skillItem.system.advances.value += skillAdvancements[index]\r\n            else \r\n            {\r\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n                skillItem = skillItem.toObject();\r\n                skillItem.system.advances.value = skillAdvancements[index];\r\n                items.push(skillItem);\r\n            }\r\n        }\r\n        \r\n        for (let talent of talents)\r\n        {\r\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n            if (talentItem)\r\n            {\r\n                items.push(talentItem.toObject());\r\n            }\r\n            else \r\n            {\r\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n            }\r\n        }\r\n        \r\n        for (let trapping of trappings) \r\n        {\r\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n            if (trappingItem)\r\n            {\r\n                trappingItem = trappingItem.toObject()\r\n        \r\n                equip(trappingItem)\r\n        \r\n                items.push(trappingItem);\r\n            }\r\n            else \r\n            {\r\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n            }\r\n        }\r\n       \r\n        \r\n        await this.actor.update(updateObj)\r\n        this.actor.createEmbeddedDocuments(\"Item\", items);\r\n        \r\n        function equip(item)\r\n        {\r\n            if (item.type == \"armour\")\r\n                item.system.worn.value = true\r\n            else if (item.type == \"weapon\")\r\n                item.system.equipped = true\r\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n                item.system.worn = true\r\n        }",
    "FZFOC7bip0oiWEzk": "if (args.opposedTest.result.hitloc.value == this.item.system.location.key && args.totalWoundLoss > 0)\r\n{\r\n    args.actor.addCondition(\"bleeding\", 2);\r\n    this.script.scriptNotification(\"Otrzymano Krwawienie\")\r\n}",
    "fzTB7t3x4bLmAXji": "let roll = await new Roll(\"1d10 + 1\").roll()\r\nawait roll.toMessage(this.script.getChatData());\r\nthis.script.scriptNotification(`Uleczone Rany: ${roll.total}`)\r\nthis.actor.corruptionDialog(\"moderate\")\r\nawait this.actor.modifyWounds(roll.total)",
    "g07HI7vyqiFXPB0o": "// A Drinker must take a Difficult (-10) Endurance Test.\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields: {difficulty: \"difficult\"}})\r\nawait test.roll()\r\n// If they fail, they acquire 2 Poisoned Conditions. \r\nif (test.failed) \r\n{\r\n    this.actor.addCondition(\"poisoned\", 2)\r\n    this.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> otrzymuje 2 Poziomy Stanu @Condition[Zatrucie].</p>\r\n        <p>Każde stworzenie cechą Zwierzęcy, która ugryzie ofiarę i otrzyma obrażenia, nie ugryzie ponownie podczas trwającego starcia, chociaż stworzenie może nadal atakować na inne sposoby.</p>`, \r\n    {\r\n      whisper: ChatMessage.getWhisperRecipients(\"GM\"), \r\n      blind: true \r\n    })\r\n}\r\n  // If they succeed, for a number of rounds equal to 3+ their SL, they have the Corrosive Blood Creature Trait.\r\nelse if (test.succeeded) \r\n{\r\n    // Don't attempt to add Corrosive Blood if actor already has it\r\n    const hasCorrosiveBlood = this.actor.has(\"Kwasowa Krew\")\r\n    if (hasCorrosiveBlood !== undefined) return   \r\n\r\n    let item = await fromUuid(\"Compendium.wfrp4e-core.items.M5QSWOYt2Rbv2yxW\")\r\n    let data = item.toObject()\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n    \r\n    const duration = 3 + parseInt(test.result.SL)\r\n    this.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> otrzymuje Kwasową Krew na liczbę rund: ${duration}.</p>`, \r\n      { whisper: ChatMessage.getWhisperRecipients(\"GM\"), blind: true })    \r\n}",
    "g0SzfsLyW7aD2F19": "if (this.item.name.includes(\"(\") && this.item.system.tests.value.includes(\"(Grupa Społeczna)\"))\r\n{\r\n    let tests = this.item.system.tests.value\r\n    let name = this.item.name\r\n\r\n    // If name already specifies, make sure tests value reflects that\r\n    if (name.includes(\"(\") && !name.toLowerCase().includes(\"dowolna\"))\r\n    {\r\n        let group = `${name.split(\"(\")[0].trim()} (${value})`\r\n        tests = `${tests.split(\"(\")[0].trim()} (${group})`\r\n    }\r\n    this.item.updateSource({name, \"system.tests.value\" : tests})\r\n}",
    "g4t56A09yrpZaJQ2": "    let amberTalons = foundry.utils.deepClone(game.wfrp4e.config.systemItems.unarmed);\r\n    amberTalons.name = \"Szpony Furii\";\r\n    amberTalons.img = this.effect.img;\r\n    amberTalons.system.damage.value = \"SB + WPB\"\r\n    amberTalons.system.equipped = true;\r\n    amberTalons.system.qualities.value.push({name : \"magical\"})\r\n    amberTalons.effects.push({\r\n        label : \"Szpony Furii\",\r\n        transfer: false,\r\n        icon : \"modules/wfrp4e-core/icons/spells/amber-talons.png\" ,\r\n        flags : {\r\n          wfrp4e : {\r\n              applicationData : {\r\n                  documentType : \"Item\"\r\n              },\r\n              scriptData : [{\r\n                  trigger : \"applyDamage\",\r\n                  script : \"if (args.totalWoundLoss >= 1)\\n{ \\n    args.actor.addCondition(\\\"bleeding\\\")\\n}\"\r\n              }]\r\n          }\r\n        }\r\n      })\r\n    this.actor.createEmbeddedDocuments(\"Item\", [amberTalons], {fromEffect: this.effect.id})",
    "GFaTz8f6PBNWrlad": "let test = await this.actor.setupCharacteristic(\"wp\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context : {failure : `<strong>Zdezorientowany</strong>: Determine behaviour by @Table[bewilder] Table.`}})\r\nawait test.roll();\r\nreturn test.failed",
    "GjkxWj9wCAclM9WA": "let effects = foundry.utils.deepClone(this.item.effects.contents.filter(e => e.active));\r\n\r\neffects.splice(effects.length - 1);\r\n\r\nif (effects.length == 0)\r\n{\r\n    return this.script.scriptNotification(\"Wszystkie efekty zostały zastosowane. Zresetuj, aby je ponownie wybrać\")\r\n}\r\nlet choice = await ItemDialog.create(effects, 1, \"Wybierz moc, którą chcesz zastosować\");\r\n\r\nif (choice[0])\r\n{\r\n    choice[0].update({disabled : true})\r\n    let effect = choice[0].convertToApplied();\r\n    effect.name += ` (${this.effect.name})`\r\n    this.actor.createEmbeddedDocuments(\"ActiveEffect\", [effect]);\r\n}",
    "gKIPujyuFSn0No9v": "for(let e of this.item.effects.contents)\r\n{\r\n    e.update({disabled: false})\r\n}\r\nthis.script.scriptNotification(\"Resetuj moce\")",
    "gKPL3t4vlZAsvtGr": "return args.skill?.name == \"Skradanie (Podziemia)\"",
    "GOq4TcnWbfyfCo2V": "this.script.scriptNotification(`Uleczone Rany: ${this.actor.characteristics.t.bonus * 2}`)\r\nawait this.actor.modifyWounds(this.actor.characteristics.t.bonus * 2)\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - Skutki Uboczne`,fields : {difficulty : \"difficult\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    let roll = await new Roll(\"1d10\").roll();\r\n    await roll.toMessage(this.script.getChatData())\r\n    if (roll.total <= 3)\r\n    {\r\n        this.actor.addCondition(\"blinded\", 3)\r\n    }\r\n    else if (roll.total <= 6)\r\n    {\r\n        this.actor.addCondition(\"broken\");\r\n    }\r\n    else if (roll.total <= 9)\r\n    {\r\n        this.actor.addCondition(\"stunned\");\r\n    }\r\n    else if (roll.total == 10)\r\n    {\r\n        this.actor.addConditon(\"unconscious\")\r\n    }\r\n}",
    "GRfCxtYzmEx2LYU7": "if (args.totalWoundLoss >= 1)\r\n{\r\n    let roll = await new Roll(\"1d10\").roll();\r\n    await roll.toMessage(this.script.getChatData());\r\n    if (roll.total == 9)\r\n    {\r\n        this.script.scriptMessage(`Dwa @UUID[Compendium.wfrp4e-eis.actors.iDy8SDTwJSlCzZMl]{Niebieskie Horrory Tzeentch} rozrywają na strzępy ${this.actor.name}' wydostając się na świat.`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    }\r\n}",
    "GzSFlqL1YrIK1dxh": "let items = await Promise.all([\"Compendium.wfrp4e-wom.items.Item.EjGYZ4CgX2jZW7Ot\",\r\n\"Compendium.wfrp4e-wom.items.Item.O2v9RQiFf0obskP5\",\r\n\"Compendium.wfrp4e-wom.items.Item.2cv6hhZ57iV6z5Il\",\r\n\"Compendium.wfrp4e-wom.items.Item.YgDEUO0G0XcqQJqg\",\r\n\"Compendium.wfrp4e-wom.items.Item.J6K5TPxI8qIGQKKH\",\r\n\"Compendium.wfrp4e-wom.items.Item.K9FPtiDLwTkC7FuO\",\r\n\"Compendium.wfrp4e-wom.items.Item.CkMYRYCLrkMnyVm5\",\r\n\"Compendium.wfrp4e-wom.items.Item.0Xdm4r7l2EwC4fcg\"].map(fromUuid));\r\n\r\nlet choice = await game.wfrp4e.apps.ItemDialog.create(items, 1, \"Wybierz Wiatr Magii\")\r\n//this.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nthis.item.update(choice[0]?.toObject(), {diff: false, recursive : false});\r\n\r\n//this.actor.items.getName(this.effect.item.name).delete() // For some reason this.effect.item.delete() throws an error\r\n\r\n",
    "GzsuEg7gZy1f0ljy": "let bleeding = this.actor.hasCondition(\"bleeding\")\r\nif (bleeding)\r\n{\r\n   this.script.scriptNotification(`Usunięte Stany Krwawienia: ${bleeding.conditionValue}`)\r\n   bleeding.delete();  \r\n}\r\nelse \r\n{\r\n   this.script.scriptNotification(`Brak stanów krwawienia`)\r\n}",
    "H06Ysj7oPiemW7S6": "if (args.test.options.income && !args.test.options.criminal)\r\n{\r\n    args.test.options.criminal = true;\r\n    let currentCareer = args.test.actor.system.currentCareer;\r\n    let coin = {1 : \"b\", 2 : \"s\", 3 : \"s\", 4 : \"g\"}[currentCareer.system.level.value] // b, s, or g maps to 2d10, 1d10, or 1 respectively (takes the first letter)\r\n    let term = {1 : \"bp\", 2 : \"ss\", 3 : \"ss\", 4 : \"gc\"}[currentCareer.system.level.value] // b, s, or g maps to 2d10, 1d10, or 1 respectively (takes the first letter)\r\n    let dieAmount = {1 : \"2d10\", 2 : \"1d10\", 3 : \"2d10\", 4 : \"1\"}[currentCareer.system.level.value] // b, s, or g maps to 2d10, 1d10, or 1 respectively (takes the first letter)\r\n    dieAmount = parseInt(dieAmount[0]) * this.item.system.Advances;     // Multilpy that first letter by your standing (Brass 4 = 8d10 pennies)\r\n    if (coin != \"g\") // Don't roll for gold, just use standing value\r\n    {\r\n        dieAmount = dieAmount + \"d10\";\r\n    }\r\n    let moneyEarned = (await new Roll(dieAmount.toString()).roll()).total;\r\n    let moneyString = `${moneyEarned}${coin}`\r\n    let transactionString = `${moneyEarned}${term}`\r\n\r\n    this.script.scriptMessage(`<a class=\"money-drag\" data-amt=\"${moneyString}\"><strong>Zarobiono dodatkowe pieniądze: ${game.wfrp4e.market.amountToString(game.wfrp4e.market.parseMoneyTransactionString(transactionString))}</strong></a>`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "H2CJvApKMnfGNNoo": " if (args.test.item?.type == \"skill\" && args.test.item.name.includes(game.i18n.localize(\"NAME.Stealth\")))\r\n{ \r\n     args.test.result.description = \"Zdumiewająca porażka\";\r\n     args.test.result.outcome = \"failure\";\r\n       ChatMessage.create({content : \"<em>PISK</em>\", speaker : ChatMessage.getSpeaker({token: this.actor.getActiveTokens()[0]?.document, actor: this.actor})}, {chatBubble : true})\r\n        AudioHelper.play({ src: `${game.settings.get(\"wfrp4e\", \"soundPath\")}squeek.wav` }, true);\r\n}",
    "H3pZ9UeIzIz3luKh": "args.actor.addCondition(\"bleeding\")\r\n\r\nthis.actor.setFlag(\"wfrp4e\", \"isAttached\", args.actor.name)\r\n\r\nthis.script.scriptMessage(`Doczepia się do <strong>${args.actor.name}</strong>`)",
    "h766UvswLCsxcMow": "let characteristics = {\r\n  \"ws\" : 5,\r\n  \"bs\" : 0,\r\n  \"s\" : -15,\r\n  \"t\" : 0,\r\n  \"i\" : 20,\r\n  \"ag\" : 0,\r\n  \"dex\" : 0,\r\n  \"int\" : 5,\r\n  \"wp\" : 10,\r\n  \"fel\" : 10\r\n}\r\nlet skills = [\"Charyzma\", \"Zastraszanie\", \"Broń Biała (Podstawowa)\"]\r\nlet skillAdvancements = [7, 60, 7]\r\nlet talents = [\"Groźny\", \"Cień\"]\r\nlet traits = [\"Dekoncentrujący\"]\r\nlet trappings = []\r\nlet items = [];\r\nlet spells = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n  updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n  let skill = skills[index]\r\n  let skillItem;\r\n  skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n  if (skillItem)\r\n      skillItem.system.advances.value += skillAdvancements[index]\r\n  else \r\n  {\r\n      skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n      skillItem = skillItem.toObject();\r\n      skillItem.system.advances.value = skillAdvancements[index];\r\n      items.push(skillItem);\r\n  }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n  let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n  if (talentItem)\r\n  {\r\n      items.push(talentItem.toObject());\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n  }\r\n}\r\n\r\nconst traitRegex = /(?:,?(.+?)(\\+?\\d{1,2}\\+?)?\\s*?(?:\\((.+?)\\)\\s*(\\+?\\d{1,2})?|,|$))/gm\r\nfor (let trait of traits)\r\n{\r\n  let traitMatches = trait.matchAll(traitRegex).next().value\r\n  let traitName = traitMatches[1]\r\n  let traitItem;\r\n  try {\r\n      traitItem = await WFRP_Utility.findItem(traitName, \"trait\")\r\n  }\r\n  catch { }\r\n  if (!traitItem) {\r\n      ui.notifications.warn(`Could not find ${trait}`, {permanent : true})\r\n  }\r\n  traitItem = traitItem.toObject()\r\n  items.push(traitItem)\r\n\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n  let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n  if (trappingItem)\r\n  {\r\n      trappingItem = trappingItem.toObject()\r\n\r\n      equip(trappingItem)\r\n\r\n      items.push(trappingItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n  }\r\n}\r\n\r\nfor (let spell of spells) \r\n{\r\n  let spellItem = await game.wfrp4e.utility.findItem(spell)\r\n  if (spellItem)\r\n  {\r\n      spellItem = spellItem.toObject()\r\n\r\n      items.push(spellItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${spell}`, {permanent : true})\r\n  }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\n\r\nfunction equip(item)\r\n{\r\n  if (item.type == \"armour\")\r\n      item.worn = true\r\n  else if (item.type == \"weapon\")\r\n      item.equipped = true\r\n  else if (item.type == \"trapping\" && item.trappingType?.value == \"clothingAccessories\")\r\n      item.worn = true\r\n}",
    "hA8PzeiCsHqqlUZm": "this.actor.createEmbeddedDocuments(\"ActiveEffect\", [game.wfrp4e.config.symptomEffects[\"nausea\"]])\r\nthis.script.scriptMessage(`Otrzymano symptom: @Symptom[Mdłości] na [[1d10]] godzin`, {whisper: ChatMessage.getWhisperRecipients(\"GM\")})",
    "HASsi6wYHVALExWq": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context: { failure: \"1 Corruption Point Gained\" } })\r\nawait test.roll();\r\n\r\nif (test.failed && args.actor.type == \"character\") \r\n{\r\n    let msg = \"\"\r\n    msg += `<p><b>${this.actor.prototypeToken.name}</b>: Otrzymano punkt Zepsucia</p>`\r\n    if (test.result.roll % 11 == 0 || test.result.roll == 100)\r\n    {\r\n        msg +=  `<b>${args.actor.prototypeToken.name}</b>: Otrzymano mutację (@Table[expandedmutatephys]{Fizyczna} or @Table[expandedmutatemental]{Psychiczna}) oraz Talent: @UUID[Compendium.wfrp4e-core.items.hiU7vhBOVpVI8c7C]{Magia Chaosu (Tzeentch)}`\r\n    }\r\n    this.script.scriptMessage(msg, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    await this.actor.update({ \"system.status.corruption.value\": parseInt(args.actor.status.corruption.value) + 1 })\r\n}",
    "Hcpn1gU58DIKIhty": "if (args.item.type  == \"skill\" && args.item.name == \"Broń Biała (Korbacz)\")\r\n{\r\n     args.item.system.modifier.value += 10;\r\n}",
    "hCzxUyO6mjLNIpaM": "let woundsGained = Math.min(args.totalWoundLoss, args.actor.status.wounds.value)\r\n\r\nwoundsGained = Math.floor(woundsGained / 2)\r\n\r\nargs.attacker.update({ \"system.status.wounds.value\": args.attacker.status.wounds.value + woundsGained })\r\n\r\nthis.script.scriptMessage(`Uleczono Rany: ${woundsGained}`)",
    "hDC6lroDEPVBituR": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\n\r\nif (test.failed)\r\n{\r\n    this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + 1})\r\n    this.script.scriptMessage(\"Otrzymano Punkt Zepsucia\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    if (test.result.roll % 11 == 0 || test.result.roll == 100)\r\n    {\r\n        this.script.scriptMessage(`<strong>Pech</strong>: Natychmiast otrzymujesz 1 @Table[mutatemental]{Mutację Psychiczną}, oraz nie możesz podjąć się krótko-terminowej ambicji przez następne [[1d10]] tygodni.`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    }\r\n}",
    "hhv7PrRdlf9sfC82": "let characteristics = {\r\n            \"ws\" : 5,\r\n            \"bs\" : 0,\r\n            \"s\" : 5,\r\n            \"t\" : 5,\r\n            \"i\" : 10,\r\n            \"ag\" : 0,\r\n            \"dex\" : 0,\r\n            \"int\" : 0,\r\n            \"wp\" : 0,\r\n            \"fel\" : 0\r\n        }\r\n        let skills = [\"Opanowanie\", \"Unik\"]\r\n        let skillAdvancements = [10, 10]\r\n        let talents = [\"Bitewny Refleks\"]\r\n        let trappings = [\"Skórzana kurta\", \"Skórzany hełm\", \"Skórzane nogawice\", \"Tarcza\"]\r\n        let items = []\r\n\r\n        let updateObj = this.actor.toObject();\r\n        \r\n        for (let ch in characteristics)\r\n        {\r\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n        }\r\n        \r\n        for (let index = 0; index < skills.length; index++)\r\n        {\r\n            let skill = skills[index]\r\n            let skillItem;\r\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n            if (skillItem)\r\n                skillItem.system.advances.value += skillAdvancements[index]\r\n            else \r\n            {\r\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n                skillItem = skillItem.toObject();\r\n                skillItem.system.advances.value = skillAdvancements[index];\r\n                items.push(skillItem);\r\n            }\r\n        }\r\n        \r\n        for (let talent of talents)\r\n        {\r\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n            if (talentItem)\r\n            {\r\n                items.push(talentItem.toObject());\r\n            }\r\n            else \r\n            {\r\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n            }\r\n        }\r\n        \r\n        for (let trapping of trappings) \r\n        {\r\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n            if (trappingItem)\r\n            {\r\n                trappingItem = trappingItem.toObject()\r\n        \r\n                equip(trappingItem)\r\n        \r\n                items.push(trappingItem);\r\n            }\r\n            else \r\n            {\r\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n            }\r\n        }\r\n      \r\n        \r\n        await this.actor.update(updateObj)\r\n        this.actor.createEmbeddedDocuments(\"Item\", items);\r\n        \r\n        function equip(item)\r\n        {\r\n            if (item.type == \"armour\")\r\n                item.system.worn.value = true\r\n            else if (item.type == \"weapon\")\r\n                item.system.equipped = true\r\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n                item.system.worn = true\r\n        }",
    "HJ2X4ZtXei0BXbxf": "        let choices = await Promise.all([game.wfrp4e.utility.findItemId(\"PzimjNx9Ojq4g6mV\"), game.wfrp4e.utility.findItemId(\"rOPmyLWa37e7s9v6\")])\r\n        let items = await game.wfrp4e.apps.ItemDialog.create(choices, 1, \"Wybierz umiejętność\")\r\n\r\n        items = items.map(i => i.toObject())\r\n        items.forEach(i => i.system.advances.value = 20)\r\n\r\nitems.forEach(i => equip(i))\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.data.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.data.equipped = true\r\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\r\n        item.data.worn = true\r\n}",
    "HMC6hPND9DWLFfZE": "if (this.item.name.includes(\"(\"))\r\n{\r\n\treturn;\r\n}\r\n\r\nlet index = game.packs\r\n.filter(i => i.metadata.type == \"Item\")\r\n.reduce((acc, pack) => acc.concat(pack.index.contents), [])\r\n.filter(i => i.type == \"skill\" && i.name.includes(game.i18n.localize(\"NAME.Lore\")))\r\n.map(i => {\r\n\ti.id = i._id\r\n\treturn i\r\n})\r\n\r\nlet choice = await ItemDialog.create(index, 1, \"Wybierz rodzaj wiedzy\")\r\nlet text;\r\nif (!choice[0])\r\n{\r\n    let custom = await Dialog.wait({\r\n        title : \"Wpisz rodzaj wiedzy\",\r\n        content : \"<input type='text'>\",\r\n        buttons : {\r\n            confirm : {\r\n                label : game.i18n.localize(\"Confirm\"),\r\n                callback : (dlg) => {\r\n                    return dlg.find(\"input\")[0].value\r\n                }\r\n            }\r\n        },\r\n        default : \"confirm\",\r\n        close : () => {\r\n            return \"\"\r\n        }\r\n    })   \r\n    text = custom || \"\"\r\n}\r\nelse \r\n{\r\n    text = game.wfrp4e.utility.extractParenthesesText(choice[0].name)\r\n}\r\n\r\nawait this.item.updateSource({name : this.item.name + ` (${text})`, \"system.tests.value\" : this.item.system.tests.value.replace(\"chosen Lore\", text)})\r\nawait this.effect.updateSource({name : this.effect.name + ` (${text})`})",
    "HmImVzvw6ecBy99l": "if (args.opposedTest.result.hitloc.value == \"body\" && args.totalWoundLoss > 0) \r\n{\r\n    args.actor.addCondition(\"bleeding\", 2)\r\n    this.script.scriptNotification(\"Otrzymano Stan Krwawienia\")\r\n}",
    "hmk8zV1LTElHUI8A": "let msg = `<b>${this.actor.prototypeToken.name}</b>: Otrzymano 1 Ranę.<br>`\r\n  if (this.actor.status.wounds.value <= 1)\r\n  {\r\n    msg += `<b>${this.actor.prototypeToken.name}</b>: Otrzymano Stan @Condition[Utrata Przytomności].<br>`\r\n    await this.actor.addCondition(\"unconscious\")\r\n  }\r\n  this.script.scriptMessage(msg)\r\n  this.actor.modifyWounds(-1)",
    "hnsmzvcuiUYB065I": "this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {appendTitle: ` - ${this.effect.name}`, context: { failure : \"Nie może uciec z walki\"}}).then(test => test.roll())",
    "HoNTnPphrJISSQr1": "ChatMessage.create({content : \"<em>Przemów i objaw się mnie</em>\", speaker : ChatMessage.getSpeaker({token: this.actor.getActiveTokens()[0]?.document, actor: this.actor})}, {chatBubble : true})",
    "hpwJRAhCsXTp9bd9": "let choice1 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Biała (Podstawowa)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 20\r\n                }\r\n            }\r\n        }\r\n    }\r\n]\r\nlet choice2 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Biała (Drzewcowa)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 20\r\n                }\r\n            }\r\n        }\r\n    }\r\n]\r\n\r\nlet choice3 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Biała (Dwuręczna)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 20\r\n                }\r\n            }\r\n        }\r\n    }\r\n]\r\n\r\nlet choice = await Dialog.wait({\r\n        title : \"Wybór\",\r\n        content : \r\n        `<p>\r\n        Wybierz opcję\r\n        </p>\r\n        <ol>\r\n        <li>Broń Biała (Podstawowa)</li>\r\n        <li>Broń Biała (Drzewcowa)</li>\r\n        <li>Broń Biała (Dwuręczna)</li>\r\n        </ol> \r\n        `,\r\n        buttons : {\r\n            1 : {\r\n                label : \"Podstawowa\",\r\n                callback : () => {\r\n                    return choice1\r\n                }\r\n            },\r\n            2 : {\r\n                label : \"Drzewcowa\",\r\n                callback : () => {\r\n                    return choice2\r\n                }\r\n            },\r\n            3 : {\r\n                label : \"Dwuręczna\",\r\n                callback : () => {\r\n                    return choice3\r\n                }\r\n            }\r\n    }\r\n})\r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}\r\n",
    "hR1qD2kpFHF8JT8h": "return args.skill?.name == \"Język (Magiczny)\"",
    "HrOBAXsEX073ReKl": "let skill = `Występy (Śpiewanie)`\r\nlet currentCareer = this.actor.system.currentCareer;\r\nlet existingSkill = this.actor.itemTypes.skill.find(i => i.name == skill);\r\n\r\nif (!currentCareer) return\r\n\r\n\r\nlet inCurrentCareer = currentCareer.system.skills.includes(skill);\r\nif (existingSkill && inCurrentCareer)\r\n{\r\n\texistingSkill.system.advances.costModifier = -5;\r\n}\r\nelse \r\n{\r\n\tcurrentCareer.system.skills.push(skill);\r\n}\r\n\r\n\r\n",
    "hZAax4emLahEEqcZ": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.BqPZn6q3VHn9HUrW\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = 7 - this.actor.characteristics.s.bonus\r\ndata.name = item.name.replace(\"()\", \"(Kły)\")\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "I1J2m5uud84N50Lk": "if ([\"cast\", \"channelling\", \"pray\"].includes(args.type))\r\n{\r\n\targs.abort = true;\r\n\tthis.script.scriptNotification(\"Nie można rzucić zaklęć ani modlitw\");\r\n}\r\nelse return true;",
    "i5AN97A7IOeygEFA": "if (args.applyAP && args.modifiers.ap.metal) \r\n{\r\n    args.modifiers.ap.ignored += args.modifiers.ap.metal\r\n    args.modifiers.other.push({value : args.modifiers.ap.metal, label : this.effect.name, details : \"Dodano PP Metalowego Pancerza do Obrażeń\" })\r\n    args.modifiers.ap.details.push(\"<strong>\" + this.effect.name + \"</strong>: Zignorowano Metalowy Pancerz (\" + args.modifiers.ap.metal + \")\");\r\n    args.modifiers.ap.metal = 0\r\n}",
    "I9QAPKbaXwMMMBT4": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {fields : {difficulty: \"average\"}, skipTargets: true, appendTitle :  \" - \" + this.effect.name})\r\nawait test.roll();\r\nif(test.failed)\r\n{\r\n    await this.actor.addCondition(\"stunned\");\r\n    let secondTest = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {fields : {difficulty: \"easy\"}, skipTargets: true, appendTitle :  \" - Rozpacz\"})\r\n    await secondTest.roll();\r\n    if(secondTest.failed)\r\n    {\r\n        this.effect.updateSource({name : \"Smak Śmierci\"})\r\n         await this.actor.addCondition(\"fatigued\");\r\n    }\r\n    else \r\n    {\r\n        return false;\r\n    }\r\n}",
    "IAGla7HJlYN0wa4H": "if (args.test.characteristicKey == \"wp\") \r\n{\r\n    if (args.test.failed)\r\n    {\r\n        this.actor.addSystemEffect(\"convulsions\")\r\n        this.script.scriptMessage(`Test siły woli nie powiódł się, <b>${this.actor.prototypeToken.name}</b>: Otrzymano @Symptom[Konwulsje] na [[1d10]] godzin`)\r\n    }\r\n}",
    "id9ZdkERMZnZTWXt": "if (args.extendedTest?.getFlag(\"wfrp4e\", \"fear\"))\r\n{\r\n\tthis.script.scriptNotification(\"Niewrażliwy na Strach\");\r\n\targs.extendedTest.delete();\r\n\targs.abort = true;\r\n}\r\nreturn args.options.terror || args.extendedTest?.getFlag(\"wfrp4e\", \"fear\")",
    "iM6JLF8jDXMViReZ": "return ![\"Otwieranie Zamków\", \"Zwinne Palce\", \"Splatanie Magii (Ulgu)\"].includes(args.skill?.name)\r\n",
    "imKVsCy8rya2gkwO": "// Any Characteristic penalties due to failed Consume Alcohol Tests\r\n// or the state of being Stinking Drunk are eliminated. \r\nawait this.actor.removeSystemEffect(\"consumealcohol1\")\r\nawait this.actor.removeSystemEffect(\"consumealcohol2\")\r\nawait this.actor.removeSystemEffect(\"consumealcohol3\")\r\nawait this.actor.removeSystemEffect(\"stinkingdrunk1\")\r\n\r\n// The drinker is thereafter Fatigued \r\n// for a number of hours equal to 10 minus their Toughness Bonus — \r\n// nothing but time and rest can eliminate this penalty.\r\nawait this.actor.addCondition(\"fatigued\")\r\nconst duration = 10 - parseInt(this.actor.system.characteristics.t.bonus)\r\nthis.effect.updateSource({\"duration.hours\" : duration});\r\nthis.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> stracił wszystkie kary związane z alkoholem i zyskuje Stan Zmęczenie na liczbę godzin: ${duration}.</p>`, \r\n{\r\n  whisper: ChatMessage.getWhisperRecipients(\"GM\"), \r\n  blind: true \r\n})    ",
    "iMu8BZ7eHMAbPEO1": "let healed = args.totalWoundLoss\r\n\r\nthis.script.scriptMessage(`<b>this.actor.prototypeToken.name</b>Uleczone Rany: ${healed}`);\r\n\r\nthis.actor.modifyWounds(healed)",
    "iNAQJa5HyaEckknX": "let test = await this.actor.setupCharacteristic(\"wp\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\n\r\n\r\nlet opposedResult = test.opposedMessages[0]?.getOppose()?.resultMessage?.getOpposedTest()?.result\r\n\r\nif (opposedResult?.winner == \"attacker\")\r\n{\r\n    let spells = this.actor.itemTypes.spell;\r\n    if (spells.length)\r\n    {\r\n        let chosen = spells[Math.floor(CONFIG.Dice.randomUniform() * spells.length)]\r\n        this.script.scriptMessage(`Utracono dostęp do: <strong>${chosen.name}</strong>`)\r\n        chosen.update({name : chosen.name += \" (UTRACONO)\"})\r\n    }\r\n}\r\n\r\n\r\n",
    "inPxRSx0CDj1nwAm": "if (args.test.result.fumble && !this.actor.itemTypes.talent.find(i => i.name == \"Magia Tajemna (Ogień)\"))\r\n{\r\n    this.actor.addCondition(\"ablaze\");\r\n}",
    "IPPDvZdE8kn3H9z7": "let test = await this.actor.setupSkill(\"Unik\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`});\r\nawait test.roll();\r\n\r\nif (test.failed)\r\n{\r\n   await this.actor.addCondition(\"grappling\")\r\n}",
    "IR5URcjnCuWBFMoN": "// If a full dose is imbibed, \r\n// the victim must pass a Hard (-20) Endurance Test.\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields: {difficulty: \"hard\"}})\r\nawait test.roll()\r\nif (test.failed)\r\n{\r\n    this.script.scriptMessage(`<p><strong>${this.actor.prototypeToken.name}</strong> nie zauważa nic poza tym, że staje się zmęczony trochę wcześniej niż zwykle. W tym momencie nadal można uratować ofiarę potężnym antidotum lub magicznym środkiem.</p>\r\n    <p>Kiedy zapadnie w sen, jest to prawie niemożliwe. W tym momencie postać musi wykonać <strong>Trudny (-20) Test Odporności</strong>. Jeśli się nie powiedzie, nigdy się nie obudzi.</p>`, \r\n    {\r\n      whisper: ChatMessage.getWhisperRecipients(\"GM\"), \r\n      blind: true \r\n    })\r\n}\r\nreturn test.failed;",
    "IslMfFgpgQq2brpu": "if (this.actor.hasCondition(\"broken\"))\r\n{\r\n    this.actor.removeCondition(\"broken\")\r\n    this.script.scriptNotification(`Nie można otrzymać stanu Panika`);\r\n}",
    "IupskvzvoGyD2H5o": "if (this.actor.type != \"character\")\r\n{\r\n    return;\r\n}\r\n\r\nlet god = await ValueDialog.create(\"Wybierz Bóstwo\", \"Błogosławieństwo (Boska Tradycja)\")\r\n\r\nif (god)\r\n{\r\n    let prayers = await game.wfrp4e.utility.findAll(\"prayer\", \"Ładuję błogosławienia...\")\r\n    let blessings = prayers.filter(p => p.system.god.value.split(\",\").map(i => i.trim().toLowerCase()).includes(god.toLowerCase()) && p.system.type.value == \"blessing\")\r\n    if (blessings.length)\r\n    {\r\n        this.script.scriptNotification(\"Dodaję: \" + blessings.map(i => i.name).join(\", \"))\r\n        await this.actor.createEmbeddedDocuments(\"Item\", blessings, {fromEffect : this.effect.id})\r\n    }\r\n    else \r\n    {\r\n        this.script.scriptNotification(`Nie mogłem znaleźć żadnych błogosławieństw związanych z ${god}.`)\r\n    }\r\n    this.item.updateSource({name : this.item.name.replace(\"Boska Tradycja\", god)})\r\n    await this.actor.update({\"system.details.god.value\": god})\r\n}",
    "iuSoKntfJ4eAPafQ": "let spells = await game.wfrp4e.utility.findAll(\"spell\", \"Wyszukuję zaklęcia...\");\r\nspells = spells.filter(s => [\"fire\", \"heavens\", \"beasts\", \"shadow\", \"light\", \"life\", \"death\", \"metal\"].includes(s.system.lore.value)).sort((a, b) => a.system.lore.value > b.system.lore.value ?  1 : -1)\r\n\r\nlet choice = await ItemDialog.create(spells, 1, \"Wybierz Zaklęcie\");\r\nif (choice[0])\r\n{\r\n    this.actor.createEmbeddedDocuments(\"Item\", choice, {fromEffect: this.effect.id})\r\n}\r\n",
    "J0IWUhxada2ONowP": "        return args.skill?.name == \"Występy (Śpiew)\" || args.skill?.name == \"Występy (Śpiewanie)\" || (args.skill?.name.includes(\"Język\") && (args.skill?.name.includes(\"Magiczny\") || args.skill?.name.includes(\"Elthárin\") || args.skill?.name.includes(\"Cathayan\")))",
    "j98hvy6r9G2Vjmid": "if (args.totalWoundLoss > 0) \r\n{\r\n  args.opposedTest.result.other.push(\r\n  `@Corruption[minor]{Wystawienie na pomniejsze zepsucie}`\r\n  )\r\n  this.script.scriptMessage(\r\n  `<strong>${this.effect.name}</strong>: \r\n    @Corruption[minor]{Pomniejsze Zepsucie} <br/>\r\n    <strong>${args.actor.prototypeToken.name}</strong> musi wykonać  \r\n    <strong>Przeciętny (+20) Test na Pomniejsze Zepsucie</strong>`, \r\n    {whisper: ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "jdS2u1tQPYeO55WI": "let type = this.item.getFlag(\"wfrp4e\", \"breath\");\r\n\r\nif (type == \"cold\")\r\n{\r\n\tlet stunned = Math.max(1, Math.trunc(args.totalWoundLoss / 5))\r\n\tawait args.actor.addCondition(\"stunned\", stunned);\r\n}\r\n\r\nif (type == \"corrosion\")\r\n{\r\n    let damageItems = await Dialog.confirm({title : this.item.name, content : `<p>Uszkodzić wszystkie noszone przedmioty?</p>`})\r\n\tif (damageItems)\r\n\t{\r\n\t\tlet msg = ``\r\n\t\tlet weapons = args.actor.itemTypes.weapon.filter(i => i.isEquipped);\r\n\t\tlet armour = args.actor.itemTypes.armour.filter(i => i.isEquipped);\r\n\t\tlet trappings = args.actor.itemTypes.trapping.filter(i => i.isEquipped);\r\n\t\tfor(let item of weapons)\r\n\t\t{\r\n\t\t\tif (item.system.properties.qualities.shield)\r\n\t\t\t{\r\n\t\t\t\tawait item.system.damageItem(1, \"shield\");\r\n\t\t\t}\r\n\t\t\telse \r\n\t\t\t{\r\n\t\t\t\tawait item.system.damageItem(1);\r\n\t\t\t}\r\n\t\t\tmsg += `<p><strong>${item.name}</strong>: uszkodzono o 1</p>`\r\n\t\t}\r\n\t\tfor(let item of armour)\r\n\t\t{\r\n\t\t\tawait item.system.damageItem(1);\r\n\t\t\tmsg += `<p><strong>${item.name}</strong>: uszkodzono o 1</p>`\r\n\t\t}\r\n\t\tfor(let item of trappings)\r\n\t\t{\r\n\t\t\tawait item.system.damageItem(1);\r\n\t\t\tmsg += `<p><strong>${item.name}</strong>: uszkodzono o 1</p>`\r\n\t\t}\r\n\t\tif (msg)\r\n\t\t{\r\n\t\t\tthis.script.scriptMessage(msg, {speaker : {alias : args.actor.name}});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (type == \"fire\")\r\n{\r\n\tawait args.actor.addCondition(\"ablaze\");\r\n}\r\n\r\nif (type == \"electricity\")\r\n{\r\n\tawait args.actor.addCondition(\"stunned\");\r\n}\r\n\r\nif (type == \"poison\")\r\n{\r\n\tawait args.actor.addCondition(\"poisoned\");\r\n}\r\n\r\n",
    "JeThJbOf6Xmbtgo1": "this.script.scriptMessage(await this.actor.applyBasicDamage(8 + parseInt(this.effect.sourceTest.result.SL), {suppressMsg : true}))\r\n\r\nlet test = await this.actor.setupSkill(\"Atletyka\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"prone\")\r\n}",
    "jFwema0iwzBphxie": "let woundsGained = Math.min(args.actor.status.wounds.value, args.totalWoundLoss)\r\nwoundsGained = Math.ceil(woundsGained / 2)\r\n\r\nargs.attacker.update({\"system.status.wounds.value\" : args.attacker.system.status.wounds.value + woundsGained})\r\n\r\nargs.actor.addCondition(\"fatigued\")\r\nargs.attacker.hasCondition(\"fatigued\")?.delete();\r\n\r\nthis.script.scriptMessage(`<b>${args.attacker.prototypeToken.name}</b> Uleczono Rany: ${woundsGained}`);",
    "jGDk7avWFSnyFoql": "let broken = this.actor.hasCondition(\"broken\");\r\nlet item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.IAWyzDfC286a9MPz\");\r\n\r\nif (broken && !broken.getFlag(\"wfrp4e\", \"blasted-mind\") && !this.actor.has(item.name))\r\n{\r\n    await broken.delete();\r\n    this.actor.createEmbeddedDocuments(\"Item\", [item], {fromEffect: this.effect.id})\r\n    this.script.scriptNotification(`Usunięto ${broken.name}, dodano ${item.name} (${Math.ceil(CONFIG.Dice.randomUniform() * 10)} Rund(y))`)\r\n}",
    "jHgxpe6TJDlP3oTn": "let spells = await game.wfrp4e.utility.findAll(\"spell\", \"Wyszkukuję zaklęcia...\");\r\nspells = spells.filter(s => [\"slaanesh\"].includes(s.system.lore.value))\r\n\r\nlet choice = await ItemDialog.create(spells, 1, \"Wybierz Zaklęcie\");\r\nif (choice[0])\r\n{\r\n    this.item.updateSource({name : this.item.name + ` (${choice[0].name})`})\r\n    this.actor.createEmbeddedDocuments(\"Item\", choice, {fromEffect: this.effect.id})\r\n}\r\n",
    "Jjq3oPYbI26zjxME": "let location = this.item.system.location.key;\r\n\r\nif (location)\r\n{\r\n    let dropped = this.item.system.weaponsAtLocation;\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono: ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}\r\n\r\nlet roll = await new Roll(\"1d10\").roll()\r\n\r\nroll.toMessage(this.script.getChatData({flavor : `${this.effect.name} (Czas Trwania)`}));\r\n\r\nthis.effect.updateSource({\"duration.rounds\" : roll.total})",
    "Jk7OHqx06oCUVAzb": "return ![\"Język (Magiczny)\", \"Splatanie Magii (Hysh)\"].includes(args.skill?.name) ",
    "JmZQRvdWjm9ykYfn": "if (this.actor.hasCondition(\"surprised\"))\r\n{\r\n    this.actor.removeCondition(\"surprised\")\r\n    this.script.scriptMessage(`Nie może być zaskoczony!`);\r\n}",
    "Jnp5c09sPzDD61EK": "this.script.scriptNotification(`${args.actor.prototypeToken.name}: musi zdać <b>Przeciętny (+20) Test Siły Woli</b> aby zaatakować ten cel!`)\r\n\r\nreturn true; // No need to show this in the dialog",
    "jObJanFoev4N6ZRv": "if (!args.opposedTest.attackerTest.item?.system?.isMagical)\r\n\targs.abort = `<strong>${this.effect.name}</strong>: Zignorowano`",
    "JQruHprM5R5vZ9DA": "let caster = this.effect.sourceActor;\r\nif (caster)\r\n{\r\n    let healed= caster.system.characteristics.wp.bonus + caster.system.characteristics.int.bonus\r\n    await this.actor.modifyWounds(healed);\r\n    this.script.scriptMessage(`<strong>${this.actor.prototypeToken.name}</strong>: Uleczone Rany: ${healed}`)\r\n}\r\n \r\n let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"vhard\"}, context : {success : \"1 Punkt Zepsucia otrzymany w ciągu ostatniej godziny może zostać usunięty.\", failure: \"Nic się nie dzieje\"}})\r\n await test.roll();",
    "jRSgPhpfN7MH7TTp": "if (args.totalWoundLoss > 0)\r\n{\r\n    let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context: { failure: \"Otrzymano 1 Stan Zatrucia\", success: \"Uchroniono przed otrzymaniem Stanu Zatrucia\" } })\r\n    await test.roll();\r\n    if (test.failed)\r\n    {   \r\n        args.actor.addCondition(\"poisoned\");\r\n        if (args.actor.system.status.wounds.value - args.totalWoundLoss <= 0)\r\n        {\r\n            args.actor.addCondition(\"unconscious\")\r\n        }\r\n    }\r\n}\r\n\r\n    // else\r\n    //     this.actor.setupCharacteristic(\"t\", { context: { failure: \"1 @Condition[Poisoned] Condition Gained\", success: \"Resisted @Condition[Poisoned] Condition\" } }).then(testCallback)\r\n",
    "jW87rmQLtROdVEhW": "  if ([\"orc\", \"ork\", \"goblin\", \"hobgoblin\", \"snotling\", \"greenskin\", \"zielonoskóry\"].includes(args.opposedTest.defender.details.species.value.toLowerCase()))\r\n    {\r\n      args.addImpact = true\r\n      args.opposedTest.result.other.push(\"<b>Runa Zabójcy Goblinów</b>: Dodano Zaletę Druzgocąca\")\r\n    }",
    "KGK9vL1Yl0qmCeCN": "let specification = this.item.system.specification.value;\r\nlet choice = [];\r\n\r\nif (!specification || specification == \"Wyszkolona Umiejętność\")\r\n{\r\n    choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n        broken: \"Ujarzmiony\",\r\n        drive: \"Pociągowy\",\r\n        entertain: \"Maskotka\",\r\n        fetch: \"Aportujący\",\r\n        guard: \"Stóżujący\",\r\n        home: \"Powracający\",\r\n        magic: \"Magiczny\",\r\n        mount: \"Wierzchowiec\",\r\n        war: \"Bojowy\"\r\n    }, this.effect.img), \"unlimited\", \"Wybierz wyszkoloną umiejętność\");\r\n}\r\nelse \r\n{\r\n    choice = specification.split(\", \").map(i => {\r\n        return {\r\n            id : i.toLowerCase(),\r\n            name : i\r\n        }\r\n    });\r\n}\r\n\r\nif (choice.length)\r\n{\r\n    let changes = foundry.utils.deepClone(this.effect.changes);\r\n\r\n    for(let training of choice)\r\n    {\r\n        switch(training.id)\r\n        {\r\n            case \"ujarzmiony\" : \r\n                let roll = await new Roll(\"2d10\").roll();   \r\n                roll.toMessage(this.script.getChatData());\r\n                changes.push({value : roll.total, mode : 2, key : \"system.characteristics.fel.modifier\"})\r\n\r\n                if (this.actor.type == \"creature\")\r\n                {\r\n                    let bestial = this.actor.itemTypes.trait.find(i => i.name == \"Zwierzęcy\");\r\n                    if (bestial)\r\n                    {\r\n                        bestial.update({\"system.disabled\" : true})\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case \"pociągowy\" : \r\n\r\n                break;\r\n\r\n            case \"maskotka\" : \r\n\r\n                break;\r\n\r\n            case \"aportujący\" : \r\n\r\n                break;\r\n\r\n            case \"stóżujący\" : \r\n                let territorial = await fromUuid(\"Compendium.wfrp4e-core.items.Item.JIAe7i7dqTQBu4do\");\r\n                await this.actor.createEmbeddedDocuments(\"Item\", [territorial], {fromEffect: this.effect.id})\r\n                setProperty(args, \"options.keepId\", true);\r\n                break;\r\n\r\n            case \"powracający\" : \r\n\r\n                break;\r\n\r\n            case \"magiczny\" : \r\n\r\n                break;\r\n\r\n            case \"wierzchowiec\" : \r\n\r\n                break;\r\n\r\n            case \"bojowy\" : \r\n                changes.push({value : 10, mode : 2, key : \"system.characteristics.ws.modifier\"})\r\n                break;\r\n        }\r\n    }\r\n    this.effect.updateSource({name : `${this.effect.name} (${choice.map(i => i.name).join(\", \")})`, changes, \"flags.wfrp4e.trained\" : choice.map(i => i.id)})\r\n    this.item.updateSource({\"system.specification.value\" : `${choice.map(i => i.name).join(\", \")}`})\r\n}",
    "kiJ6AiaYVUjt6aV6": "teeth = await fromUuid(\"Compendium.wfrp4e-core.items.fBcZhOBn8IpoVqQ1\")\r\nteeth = teeth.toObject();\r\n\r\nlet roll = await new Roll(\"1d10\").roll();\r\nroll.toMessage(this.script.getChatData({flavor : \"Utracono Zęby\"}))\r\nteeth.system.location.value = `${roll.total} ${teeth.system.location.value}`\r\nthis.actor.createEmbeddedDocuments(\"Item\", [teeth])",
    "KIoVBinAZK8sMOqD": "\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields: {difficulty : \"average\"}, skipTargets: true, appendTitle :  \" - Uporczywa Rana\"})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    fromUuid(\"Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb\").then(disease => {\r\n        this.actor.createEmbeddedDocuments(\"Item\", [disease.toObject()])\r\n        this.script.scriptNotification(\"Otrzymano: \" + disease.name)\r\n    })\r\n}\r\n",
    "KkjkYAGI9Em1NgiQ": "if (this.item.system.quantity.value) \r\n{\r\n    this.item.system.reduceQuantity();\r\n    let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Heal\"), { appendTitle: ` - ${this.effect.name}`, skipTargets: true })\r\n    await test.roll();\r\n    if (test.succeeded) \r\n    {\r\n        let actor = Array.from(game.user.targets)[0]?.actor || this.actor;\r\n        actor.applyEffect({ effectData: [this.item.effects.contents[0].convertToApplied()] })\r\n    }\r\n    else \r\n    {\r\n        this.script.scriptNotification(\"Test Leczenia nie powiódł się!\", \"error\")\r\n    }\r\n}\r\nelse \r\n{\r\n    this.script.scriptNotification(\"None left!\", \"error\")\r\n}",
    "KmngDrPD72xn22kZ": "if (this.actor.Species.toLowerCase() != \"skaven\") {\r\n    this.actor.setupCharacteristic(\"t\", {skipTargets: true, appendTitle :  ` - Użyto ${this.effect.name}`, fields: { difficulty: \"difficult\" } }).then(async test => {\r\n      await test.roll()\r\n      if (test.failed) \r\n      {\r\n        let toughnessLost = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n        this.actor.update({ \"system.characteristics.t.initial\": this.actor.characteristics.t.initial - toughnessLost })\r\n        this.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b> Utracone punkty Wytrzymałości: ${toughnessLost}`)\r\n      }\r\n    })\r\n  }",
    "KPQfupKuaf4LCv4R": "const talents = await Promise.all([\"Intrygant\", \"Percepcja Magiczna\"].map(game.wfrp4e.utility.findTalent))\r\nthis.actor.createEmbeddedDocuments(\"Item\", talents, {fromEffect : this.effect.id})",
    "KQzbrpb0T5a7it4k": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.vMYEkrWj0ip6ZOdv\");\r\nlet data = item.toObject();\r\ndata.name += ` (Choroby)`;\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})",
    "kvaN100w0nBUlLbj": "let poisoned = this.actor.hasCondition(\"poisoned\")\r\nif (poisoned)\r\n{\r\n    this.script.scriptMessage(\"Niewrażliwość na trucizny!\")\r\n    poisoned.delete()\r\n}",
    "kYiDBPRKIokFkr4Z": "if (args.item.type  == \"skill\" && args.item.name == \"Broń Zasięgowa (Łuk)\")\r\n{\r\n     args.item.system.modifier.value += 20;\r\n}",
    "laptAldsT0Fm1rDt": "let blunt = await Dialog.confirm({label : \"test\", content :`<p>Zastosuj zmniejszenie obrażeń obuchowych? (-3)</p>`})\r\n\r\nif (blunt)\r\n{\r\n    args.modifiers.other.push({label : this.effect.name, details : \"Zmniejszenie Obrażeń Obuchowych\", value : -3})\r\n}",
    "lhemR8EP5tGNKout": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {fields: {difficulty : \"average\"}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context : {failure : \"Cierpisz na Irraconalne Lęki\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    msg = `<p>@UUID[${this.effect.sourceItem.uuid}]{Irraconalne Lęki} Roll: <a class=\"inline-roll\"><i class=\"fas fa-dice-d20\"></i>${Math.ceil(CONFIG.Dice.randomUniform() * 10)}</a></p>`\r\n    if (test.result.roll % 11 == 0 || test.result.roll == 100)\r\n    {\r\n        msg += `<p><b>${this.actor.prototypeToken.name}</b>: Dodatkowo, otrzymuje 1 punkt zepsucia. W przypadku mutacji, wylosuj @Table[mutatemental]{Psychiczną Mutację}</p>`\r\n        let newCorruption = Number(this.actor.status.corruption.value) + 1\r\n        this.actor.update({\"system.status.corruption.value\" : newCorruption})\r\n    }\r\n\r\n    this.script.scriptMessage(msg);\r\n}\r\n",
    "lII4KMRblqwFBlsV": "let characteristics = {\r\n  \"ws\" : 10,\r\n  \"bs\" : 0,\r\n  \"s\" : 0,\r\n  \"t\" : 0,\r\n  \"i\" : 10,\r\n  \"ag\" : 0,\r\n  \"dex\" : 0,\r\n  \"int\" : 20,\r\n  \"wp\" : 10,\r\n  \"fel\" : 15\r\n}\r\nlet skills = [\"Splatanie Magii\", \"Charyzma\", \"Kuglarstwo (Taniec)\"]\r\nlet skillAdvancements = [0, 6, 3]\r\nlet talents = [\"Atrakcyjny\", \"Rozproszenie Uwagi\", \"Naśladowca\"]\r\nlet traits = [\"Dekoncentrujący\", \"Latanie (6)\", \"Rzucanie Czarów (Magia Prosta)\"]\r\nlet trappings = [];\r\nlet items = [];\r\nlet spells = [\"Błędne ogniki\", \"Uśpienie\"];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n  updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n  let skill = skills[index]\r\n  let skillItem;\r\n  skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n  if (skillItem)\r\n      skillItem.system.advances.value += skillAdvancements[index]\r\n  else \r\n  {\r\n      skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n      skillItem = skillItem.toObject();\r\n      skillItem.system.advances.value = skillAdvancements[index];\r\n      items.push(skillItem);\r\n  }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n  let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n  if (talentItem)\r\n  {\r\n      items.push(talentItem.toObject());\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n  }\r\n}\r\n\r\nconst traitRegex = /(?:,?(.+?)(\\+?\\d{1,2}\\+?)?\\s*?(?:\\((.+?)\\)\\s*(\\+?\\d{1,2})?|,|$))/gm\r\nfor (let trait of traits)\r\n{\r\n  let traitMatches = trait.matchAll(traitRegex).next().value\r\n  let traitName = traitMatches[1]\r\n  let traitVal = traitMatches[2] || traitMatches[4] // could be match 2 or 4 depending on if there's a specialization\r\n  let traitSpec = traitMatches[3]\r\n\r\n  let traitItem;\r\n  try {\r\n      traitItem = await WFRP_Utility.findItem(traitName, \"trait\")\r\n  }\r\n  catch { }\r\n  if (!traitItem) {\r\n      ui.notifications.warn(`Could not find ${trait}`, {permanent : true})\r\n  }\r\n  traitItem = traitItem.toObject()\r\n\r\n  if (Number.isNumeric(traitVal))\r\n  {\r\n      traitItem.system.specification.value = traitName.includes('Broń','Rogi','Atak Ogonem','Macki','Ugryzienie') ? traitVal - parseInt(characteristicValues[3]/10) : traitVal;\r\n      traitItem.name = (traitItem.name +  ` ${traitSpec ? \"(\"+ traitSpec + \")\" : \"\"}`).trim()\r\n  }\r\n  else \r\n      traitItem.system.specification.value = traitSpec\r\n\r\n  items.push(traitItem)\r\n\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n  let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n  if (trappingItem)\r\n  {\r\n      trappingItem = trappingItem.toObject()\r\n\r\n      equip(trappingItem)\r\n\r\n      items.push(trappingItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n  }\r\n}\r\n\r\nfor (let spell of spells) \r\n{\r\n  let spellItem = await game.wfrp4e.utility.findItem(spell)\r\n  if (spellItem)\r\n  {\r\n      spellItem = spellItem.toObject()\r\n\r\n      items.push(spellItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${spell}`, {permanent : true})\r\n  }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\n\r\nfunction equip(item)\r\n{\r\n  if (item.type == \"armour\")\r\n      item.worn = true\r\n  else if (item.type == \"weapon\")\r\n      item.equipped = true\r\n  else if (item.type == \"trapping\" && item.trappingType?.value == \"clothingAccessories\")\r\n      item.worn = true\r\n}",
    "Lpv2N9LK9loeumiW": "if (this.actor.uuid != this.effect.sourceActor.uuid)\r\n{\r\n    this.actor.setupSkill(game.i18n.localize(\"NAME.Athletics\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields : {difficulty: \"hard\"}, context : {failure : `<strong>${this.effect.name}</strong>: Nie można się poruszyć lub wykonać akcji`}}).then(test => {\r\n       test.roll();\r\n    })\r\n}",
    "LQEWSN5KnHHATPsf": "if (args.totalWoundLoss > 0)\r\n{\r\n    this.script.scriptMessage(`<b>${args.actor.name}</b> musi zdać <b>Prosty (+40) Test Odporności</b> lub otrzyma @UUID[Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb]{Ropiejącą Ranę}`, {whisper: ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "lU4s3UTtBkU38djI": "this.actor.addCondition(\"entangled\")\r\nlet msg = `<b>${this.actor.prototypeToken.name}</b>: Utracono 1 Punkt Żywotności oraz otrzymano 1 Stan @Condition[Pochwycenie].`\r\nthis.script.scriptMessage(msg)\r\nthis.actor.modifyWounds(-1)",
    "lvjcddwRiN9iGruy": "let test = await this.actor.setupCharacteristic(\"t\", { appendTitle: ` - ${this.effect.name}`, fields: { difficulty: \"challenging\" } })\r\nawait test.roll();\r\n\r\nif (test.failed) \r\n{\r\n    let ageAdded = Math.ceil(CONFIG.Dice.randomUniform() * 10) + Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let ws = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let bs = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let s = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let t = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let ag = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let dex = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n\r\n    let currentAge = parseInt(this.actor.system.details.age.value)\r\n\r\n    let inline = `<a class=\"inline-roll\" data-tooltip=\"@TT\"><i class=\"fas fa-dice-d20\"></i>@ROLL</a>`\r\n    let msg =\r\n        `<p><b>${this.actor.prototypeToken.name}</b>: starzeje się o ${inline.replace(\"@ROLL\", ageAdded).replace(\"@TT\", \"2d10\")} lat oraz traci</p>\r\n      <p>${inline.replace(\"@ROLL\", ws).replace(\"@TT\", \"1d10\")} <b>Walki Wręcz</b></p>\r\n      <p>${inline.replace(\"@ROLL\", bs).replace(\"@TT\", \"1d10\")} <b>Umiejętności Strzeleckich</b></p>\r\n      <p>${inline.replace(\"@ROLL\", s).replace(\"@TT\", \"1d10\")} <b>Siły</b></p>\r\n      <p>${inline.replace(\"@ROLL\", t).replace(\"@TT\", \"1d10\")} <b>Wytrzymałości</b></p>\r\n      <p>${inline.replace(\"@ROLL\", ag).replace(\"@TT\", \"1d10\")} <b>Zwinności</b></p>\r\n      <p>${inline.replace(\"@ROLL\", dex).replace(\"@TT\", \"1d10\")} <b>Zręczności</b></p>\r\n `\r\n    this.script.scriptMessage(msg);\r\n\r\n    let characteristics = duplicate(this.actor.system.characteristics)\r\n\r\n    characteristics.ws.initial -= ws\r\n    characteristics.bs.initial -= bs\r\n    characteristics.s.initial -= s\r\n    characteristics.t.initial -= t\r\n    characteristics.ag.initial -= ag\r\n    characteristics.dex.initial -= dex\r\n\r\n    this.actor.update({ \"system.characteristics\": characteristics, \"data.details.age.value\": ageAdded + currentAge })\r\n}",
    "LyAK0dVDS5L09yq2": "let caster = this.effect.sourceActor\r\n\r\nif (caster)\r\n{\r\n    let bonus = caster.system.characteristics.wp.bonus\r\n    this.actor.modifyWounds(bonus)\r\n\r\n    this.script.scriptMessage(`<strong>${this.actor.prototypeToken.name}</strong>: Uleczone Punkty Żywotności: ${bonus}`)\r\n}",
    "M0XhKnWjG14pk3iH": "return !args.skill?.name.includes(\"Splatanie Magii\") && args.type != \"channelling\" && args.skill?.name != game.i18n.localize(\"NAME.Charm\") && !args.skill?.name.includes(\"Język (Magiczny)\") && args.type != \"cast\"",
    "M5bh0heeafA2fQQ8": "if (args.test.spell?.getFlag(\"wfrp4e\", \"boonOfTzeentch\"))\r\n{\r\n    if (args.test.result.minormis || args.test.result.majormis || args.test.result.catastrophicmis)\r\n    {\r\n        this.script.scriptMessage(`<strong>${this.effect.name}</strong> opuszcza twój umysł z obrzydzeniem i wymazuje się z twojej księgi!`)\r\n        this.effect.sourceItem.delete();\r\n    }\r\n}",
    "M9VgeYGiUO97ZUW4": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.hCadFsTRvLN9faaY\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Szczęka\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nif (!test.succeeded)\r\n{\r\n\targs.actor.addCondition(\"unconscious\")\r\n}\r\n\r\n",
    "MfxWXZwaZUjGSBqw": "if (this.actor.hasCondition(\"ablaze\"))\r\n{\r\n    this.script.scriptNotification(\"Niewrażliwość na Podpalenie\")\r\n    await this.actor.hasCondition(\"ablaze\")?.delete()\r\n}",
    "MfxzwJz2o9ho2hOM": "return args.skill?.name == \"Rzemiosło (Aptekarstwo)\"",
    "Mhb67xufvA9uWO21": "let actorSize = game.wfrp4e.config.actorSizeNums[args.actor.details.size.value]\r\nlet attackerSize = game.wfrp4e.config.actorSizeNums[args.attacker.details.size.value]\r\n\r\nif (attackerSize > actorSize)\r\n{\r\n   args.actor.addCondition(\"prone\")\r\n   this.script.scriptMessage(`<strong>Atak Ogonem</strong>: ${args.actor.prototypeToken.name} otrzymuje Stan @Condition[Powalenie]`)\r\n}",
    "Mir4FMHQRdVqazAF": "let actorSize = game.wfrp4e.config.actorSizeNums[args.actor.details.size.value]\r\nlet attackerSize = game.wfrp4e.config.actorSizeNums[args.attacker.details.size.value]\r\n\r\nif (attackerSize > actorSize)\r\n{\r\n   let msg = `<b>Atak Językiem</b>: ${args.actor.prototypeToken.name} otrzymuje Stan @Condition[Pochwycenie]`;\r\n   await args.actor.addCondition(\"entangled\");\r\n   if (actorSize <= 2)\r\n   {\r\n       msg += `oraz Stan @Condition[Związany Walką]`\r\n   }\r\n   this.script.scriptMessage(msg, {speaker : {alias: args.attacker.prototypeToken.name}})\r\n}",
    "mPxmCsXYirAIT913": "let key = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.characteristics, this.effect.img), 1, \"Wybierz Cechę\");\r\n\r\nthis.effect.updateSource({changes : [{key : `system.characteristics.${key[0].id}.modifier`, mode : 2, value : 10}]})",
    "mr8qm5Bg6k1idZ6Q": "return args.item?.name == \"Muzyka (Lutnia)\"",
    "mRvLsSVxNyt8LVZb": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.GRRN3XAKIpEVCY7z\")\r\nlet data = item.toObject();\r\ndata.name += \" (Do ustalenia)\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "Msygc7oQQPB5fw0b": "let test = this.effect.sourceTest;\r\nif (test.failed && (test.result.roll % 11 == 0 || test.result.roll == 100))\r\n{\r\n\tlet points = await new Roll(\"1d10\").roll();\r\n\tgame.dice3d?.showForRoll(points)\r\n\tthis.actor.update({\"system.status.corruption.value\" : this.actor.system.status.corruption.value + points.total})\r\n\tthis.script.scriptMessage(`Otrzymane punkty Zepsucia: ${points.total} `)\r\n}\r\nelse \r\n{\r\n\tlet points = this.effect.sourceTest.result.overcast.usage.other.current;\r\n\tthis.actor.update({\"system.status.corruption.value\" : this.actor.system.status.corruption.value - points})\r\n\tthis.script.scriptMessage(`Utracone punkty Zepsucia: ${points} `)\r\n}",
    "mTnmPcjWmvScIBWY": "return args.skill?.name.includes(\"Splatanie Magii\") || args.type == \"channelling\"",
    "MwUzyAgd0yPnmZCH": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.klCJX0mNpXYH5AIx\")\r\nlet data = item.toObject();   \r\ndata.name = data.name.replace(\"x\", \"Nieznajomi\");\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id});",
    "N2MeOlf0GjPiRcSb": "let test = await this.actor.setupCharacteristic(\"dex\", {context : {failure : \"Upuszcza przedmiot\"}})\r\nawait test.roll();",
    "n5RJqJL9fdRIxkuN": "if (this.actor.system.status.advantage.value > 0)\r\n{\r\n    await this.actor.modifyAdvantage(-1);\r\n    this.script.scriptNotification(\"Zmniejszono Punkty Przewag\")\r\n}\r\nelse \r\n{\r\n    return this.script.scriptNotification(\"Niewystarczająca Liczba Punktów Przewag!\", \"error\")\r\n}\r\n\r\nlet test = await this.actor.setupTrait(this.item)\r\nawait test.roll();",
    "N8hA6ysHCTlLd8Kj": "let characteristics = {\r\n    \"ws\" : 0,\r\n    \"bs\" : 0,\r\n    \"s\" : 0,\r\n    \"t\" : 5,\r\n    \"i\" : 15,\r\n    \"ag\" : 0,\r\n    \"dex\" : 10,\r\n    \"int\" : 15,\r\n    \"wp\" : 15,\r\n    \"fel\" : 0\r\n}\r\nlet skills = [\"Splatanie Magii\", \"Opanowanie\", \"Unik\", \"Występy (Gawędziarstwo)\", \"Intuicja\", \"Język (Magiczny)\", \"Wiedza (Magia)\", \"Percepcja\"]\r\nlet skillAdvancements = [5, 15, 10, 10, 15, 10, 10, 20]\r\nlet talents = [\"Magia Tajemna (Dowolna Tradycja)\", \"Magia Prosta\", \"Percepcja Magiczna\"]\r\nlet trappings = [\"Broń ręczna\", \"Kostur\", \"Rytualna szata zawierająca wiele ornamentów i zdobień\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        items.push({name : trapping, type : \"trapping\", \"system.trappingType.value\" : \"clothingAccessories\"})\r\n        //ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "Na7Nanl9YmxZlTo7": "return args.type != \"cast\" && args.type != \"channelling\"",
    "naF5EWr1CBkYRZTK": "if (args.opposedTest?.attackerTest?.item?.system?.isRanged) \r\n{\r\n    let choice = await Dialog.wait({\r\n        title: this.effect.name,\r\n        content: `<p>Zniwelować Obrażenia dzięki: <strong>${this.effect.name}</strong>?`,\r\n        buttons: {\r\n            yes: {\r\n                label: \"Tak\",\r\n                callback: () => {\r\n                    return true;\r\n                }\r\n            },\r\n            no: {\r\n                label: \"Nie\",\r\n                callback: () => {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n    })\r\n\r\n    if (choice)\r\n    {\r\n        args.abort = `<strong>${this.effect.name}</strong>: Obrażenia Zniwelowane`\r\n    }\r\n}",
    "nD2QVg3DrPK3foMf": "args.actor.setupSkill(\"Unik\", { fields: { difficulty: \"average\" } }).then(async test => {\r\n      await test.roll();\r\n      if (test.failed) {\r\n        await args.actor.addCondition(\"bleeding\")\r\n        await args.actor.addCondition(\"entangled\")\r\n      }\r\n    })",
    "NdquQqyuOkGCj8Uo": "let darkvision = await fromUuid(\"Compendium.wfrp4e-core.items.Item.JQa5DLnTs2SEzRrc\")\r\nlet fear = await fromUuid(\"Compendium.wfrp4e-core.items.Item.pTorrE0l3VybAbtn\")\r\nlet acutesense = await fromUuid(\"Compendium.wfrp4e-core.items.Item.9h82z72XGo9tfgQS\")\r\nfear = fear.toObject();\r\nfear.system.specification.value = 1;\r\nacutesense = acutesense.toObject();\r\nacutesense.name += \" (Węch)\";\r\nthis.actor.createEmbeddedDocuments(\"Item\", [darkvision, fear, acutesense], {fromEffect : this.effect.id})",
    "NDvNGATDM2xPFJK0": "brokenbone = await fromUuid(\"Compendium.wfrp4e-core.items.hCadFsTRvLN9faaY\")\r\nteeth = await fromUuid(\"Compendium.wfrp4e-core.items.fBcZhOBn8IpoVqQ1\")\r\ntongue = await fromUuid(\"Compendium.wfrp4e-core.items.rkJA1DlK51QuRlJy\")\r\nbrokenbone = brokenbone.toObject();\r\nteeth = teeth.toObject();\r\ntongue = tongue.toObject();\r\n\r\n\r\nlet roll = await new Roll(\"1d10\").roll();\r\nroll.toMessage(this.script.getChatData({flavor : \"Utrata Zębów\"}))\r\n\r\nteeth.system.location.value = `${roll.total} ${teeth.system.location.value}`\r\nbrokenbone.system.location.value = \"Szczęka\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [brokenbone, teeth, tongue])\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields: {difficulty : \"vhard\"}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"unconscious\")\r\n}",
    "nGTxNWBUBgTr87wU": "if (args.opposedTest.result.differenceSL >= 0 && args.opposedTest.result.differenceSL <= 2 && args.opposedTest.result.winner == \"attacker\")\r\n{ \r\n    this.script.scriptMessage(`Staje się zatrzymany w zbroi lub ciele przeciwnika. See @UUID[${this.item.uuid}]{${this.item.name}}.`, {speaker : {alias : this.item.name}, blind: true, whisper : ChatMessage.getWhisperRecipients(\"GM\")});\r\n}",
    "njPP9wDAsdh4WHIj": "if (args.totalWoundLoss > 0 && [\"trait\", \"weapon\"].includes(args.opposedTest.attackerTest.item?.type))\r\n{\r\n     this.script.scriptMessage(`<b>Infekcja: ${args.actor.name}</b> musi zdać <b>Prosty (+40) Test Odporności</b> lub otrzyma @UUID[Compendium.wfrp4e-core.items.kKccDTGzWzSXCBOb]{Ropiejącą Ranę}`, {whisper: ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "nkbTnaeBpthyhw4J": "let fortunePoints = this.effect.sourceTest.result.overcast.usage.other.current\r\nlet current = this.actor.status.fortune.value\r\n\r\nthis.actor.update({\"system.status.fortune.value\" : fortunePoints + current})\r\n\r\nthis.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b>: Punkty Szczęścia zwiększone z ${current} do ${fortunePoints + current}`)",
    "NkqtQaLEGYst0PUO": "if (this.actor.has(\"Odporność na Magię\", \"talent\")) \r\n    return\r\n\r\nlet item = await fromUuid(\"Compendium.wfrp4e-core.items.eowbsW6oHGSNJmxV\")\r\nthis.actor.createEmbeddedDocuments(\"Item\", [item], {fromEffect : this.effect.id})",
    "NnA4zpuO6iUXKhH7": "if ((args.opposedTest.attackerTest.item && args.opposedTest.attackerTest.item.isMelee) || (args.opposedTest.attackerTest.item && !args.opposedTest.attackerTest.item.name.includes(\"Broń Zasięgowa\")))\r\n{\r\n    let AP = parseInt(this.effect.sourceTest.result.SL)\r\n    args.modifiers.ap.value += AP;\r\n    args.modifiers.ap.magical += AP;\r\n    args.modifiers.ap.details.push(`${this.effect.name} (${AP})`)\r\n}",
    "o88xuUConwt0vFLw": "let points = this.effect.sourceTest.result.overcast.usage.other.current;\r\n\r\nthis.actor.update({\"system.status.fortune.value\" : this.actor.system.status.fortune.value + points});\r\n\r\nthis.script.scriptMessage(`Otrzymane Punkty Szczęścia: ${points}`)",
    "O9fc0hLHdkTgSuLg": "let bite = await fromUuid(\"Compendium.wfrp4e-core.items.pLW9SVX0TVTYPiPv\")\r\nlet venom = await fromUuid(\"Compendium.wfrp4e-core.items.gFkRm9wS65qe18Xv\")\r\nlet biteData = bite.toObject();\r\nlet venomData = venom.toObject();\r\n\r\nbiteData.system.specification.value = 3 - this.actor.characteristics.s.bonus;\r\nvenomData.system.specification.value = \"Średni\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [biteData, venomData], {fromEffect : this.effect.id})",
    "obIXhQXKFyyQoNNV": "this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {appendTitle: ` - ${this.effect.name}`, fields: { difficulty: \"average\" } }).then(async test => {\r\n    await test.roll()\r\n    if (test.failed) {\r\n        this.actor.modifyWounds(-1);\r\n        this.script.scriptMessage(\"Otrzymano 1 Ranę\")\r\n    }\r\n})",
    "oDNfCNyt5KaUYmg2": "if(args.opposedTest.result.winner == \"defender\")\r\n{\r\n    let roll = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n    let msg = `Rzut: ${roll}.`\r\n    if (roll >= 7)\r\n    {\r\n          msg = `Atak uderza z PS w wysokości: ${roll - 6}.`\r\n    }\r\n    this.script.scriptMessage(msg, {blind: true,  whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "OeKeQAAcJhdI4Qky": "if (this.actor.hasCondition(\"stunned\") || this.actor.hasCondition(\"unconscious\"))\r\n{\r\n\tthis.script.scriptNotification(\"Wyłączony!\");\r\n\tawait this.effect.update({\"disabled\" : true})\r\n}",
    "OEy2lxvic37dRBEt": "let filters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"spell\"\r\n    },\r\n    {\r\n        property : \"system.lore.value\",\r\n        value : \"petty\"\r\n    }\r\n]\r\n\r\nlet petty = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 3, \"Wybierz 3 Zaklęcia Proste\")\r\n\r\n\r\nfilters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"spell\"\r\n    },\r\n    {\r\n        property : \"system.lore.value\",\r\n        value : \"\"\r\n    }\r\n]\r\n\r\nlet arcane = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 3, \"Wybierz 3 Zaklęcia Magii Tajemnej\")\r\n\r\nlet items = petty.concat(arcane).map(i => i.toObject())\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);",
    "OgSI0Z6SHjYuqKIz": "let blows = this.item.getFlag(\"wfrp4e\", \"blows\") || 0\r\nlet difficulties = Object.keys(game.wfrp4e.config.difficultyLabels)\r\n\r\nblows = Math.clamped(blows, 0, difficulties.length - 1)\r\nif (this.item.system.protects[args.opposedTest.result.hitloc.value])\r\n{\r\n    let difficulty = difficulties[blows];\r\n    this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {fields: {difficulty}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`}).then(async test => {\r\n        await test.roll();\r\n        if (test.failed)\r\n        {\r\n            this.script.scriptMessage(`${this.actor.name}: musi wydostać się z walki i uciekać, dopóki nie zda <strong>Wymagającego (+0) Testu Siły Woli</strong>`);\r\n            this.item.setFlag(\"wfrp4e\", \"failedCool\", true);\r\n        }\r\n    })\r\n}",
    "OGX4BneaYAnV25TO": "let chatData = { whisper: ChatMessage.getWhisperRecipients(\"GM\") }\r\nlet message = \"\"\r\n\r\nlet wounds = duplicate(this.actor.status.wounds)\r\nlet regenRoll = await new Roll(\"1d10\").roll();\r\nlet regen = regenRoll.total;\r\n\r\nif (wounds.value >= wounds.max)\r\n    return\r\n\r\nif (wounds.value > 0) \r\n{\r\n    wounds.value += regen\r\n    if (wounds.value > wounds.max)\r\n    {\r\n        wounds.value = wounds.max\r\n    }\r\n    message += `<b>${this.actor.name}</b>: Odzyskane punkty Żywotności: ${regen}.`\r\n\r\n    if (regen == 10)\r\n    {\r\n        message += `<br>Dodatkowo zregenerowano krytyczną ranę.`\r\n    }\r\n}\r\nelse if (regen >= 8) \r\n{\r\n    message += `<b>${this.actor.name}</b>: wylosowano ${regen} i odzyskano 1 punkt Żywotności.`\r\n    wounds.value += 1\r\n    if (regen == 10)\r\n    {\r\n        message += `<br>Dodatkowo zregenerowano krytyczną ranę.`\r\n    }\r\n}\r\nelse \r\n{\r\n    message += `<b>${this.actor.name}</b>: wylosowano ${regen} - brak efektu.`\r\n}\r\n\r\nawait this.actor.update({ \"system.status.wounds\": wounds })\r\nthis.script.scriptMessage(message, { whisper: ChatMessage.getWhisperRecipients(\"GM\") })",
    "OicQSEVZBbqLtrcf": "let choice = await ItemDialog.create(this.actor.itemTypes.critical, (this.effect.sourceTest.result.overcast.usage.other.current || 1), \"Wybierz krytyczne rany do zagojenia (nie można zregenerować utraconych części ciała)\")\r\n\r\nthis.script.scriptMessage(`Uleczono: <strong>${choice.map(i => i.name).join(`, `)}</strong>`);\r\nthis.actor.deleteEmbeddedDocuments(\"Item\", choice.map(i => i.id))",
    "okr3TtzpFoefUuJS": "let item = await fromUuid('Compendium.wfrp4e-core.items.EaqlLRQigwnsEAXX')\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Obojczyk\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "okW06V9UiPC4Vcrn": "let characteristics = {\r\n    \"ws\" : 5,\r\n    \"bs\" : 0,\r\n    \"s\" : 5,\r\n    \"t\" : 5,\r\n    \"i\" : 10,\r\n    \"ag\" : 0,\r\n    \"dex\" : 0,\r\n    \"int\" : 0,\r\n    \"wp\" : 5,\r\n    \"fel\" : 5\r\n}\r\nlet skills = [\"Opanowanie\", \"Unik\"]\r\nlet skillAdvancements = [10, 10]\r\nlet talents = [\"Bitewny Refleks\", \"Nieugięty\"]\r\nlet trappings = [\"Skórzana kurta\", \"Skórzane nogawice\", \"Skórzany hełm\", \"Broń ręczna\", \"Włócznia\", \"Tarcza\"]\r\nlet items = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "oPg4se8iQRD14kmB": "let filters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"weapon\"\r\n    },\r\n    {\r\n        property : \"system.weaponGroup.value\",\r\n        value : [\"twohanded\", \"polearm\"]\r\n    }\r\n]\r\n\r\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 1, \"Wybierz odpowiednią broń drzewcową lub dwuręczną\")\r\nitems = items.map(i => i.toObject())\r\n\r\nitems.forEach(i => equip(i))\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "oV81zgbZsuTFG6L2": "let caster = this.effect.sourceActor;\r\n\r\nthis.actor.modifyWounds(caster.system.characteristics.fel.bonus);\r\n\r\nthis.script.scriptMessage(`Uleczone Punkty Żywotności: ${caster.system.characteristics.fel.bonus}`);",
    "oWa7RkScnl6lR5vd": "if (args.test.characteristicKey == \"wp\") \r\n{\r\n    if (args.test.failed)\r\n    {\r\n        let item = await fromUuid(\"Compendium.wfrp4e-core.items.AGcJl5rHjkyIQBPP\")\r\n        let data = item.toObject();\r\n        this.actor.createEmbeddedDocuments(\"Item\", [data])\r\n        \r\n        this.script.scriptMessage(`Test Siły Woli nie powiódł się, <b>${this.actor.prototypeToken.name}</b>: otrzymano @UUID[Compendium.wfrp4e-core.items.AGcJl5rHjkyIQBPP] na [[1d10]] godzin`)\r\n    }\r\n}",
    "OxsBnnVI3Smpknpb": "if (this.actor.status.advantage.value && !this.actor.sameSideAs(this.effect.sourceActor))\r\n{\r\n    this.actor.modifyAdvantage(-1);\r\n    this.script.scriptNotification(`${this.actor.name}: utracono 1 Punkt Przewag`);\r\n}",
    "PeZYj8b0vedyJj00": "// This script needs to be separate because equipTransfer is off on the other effect, and thus won't execute when added to an actor\r\n\r\nlet mainEffect = this.item.effects.contents[0];\r\nif (mainEffect.name.includes(\"(Wiedza)\"))\r\n{\r\n    let choice = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.magicLores, this.item.img), 1, \"Wybierz dziedzinę wiedzy\");\r\n    if (choice.length)\r\n    {\r\n        mainEffect.update({name : mainEffect.name.replace(\"Wiedza\", choice[0].name)})\r\n        this.item.update({name : this.item.name += ` (${choice[0].name})`})\r\n    }\r\n}\r\n\r\nthis.effect.delete();",
    "Ph3TdQw1lGiFr049": "    if (!args.test.context.phantasmal && \r\n      (this.actor.isOpposing || args.test.context.defending) && \r\n      args.test.result.roll % 11 == 0 && \r\n      args.test.succeeded && \r\n      [\"Język (Magiczny)\", \"Unik\"].includes(args.test.item?.name))\r\n    {\r\n         args.test.context.phantasmal = true; // Flag so items aren't readded if test is edited\r\n         let text = `<strong>${this.effect.name}</strong>: Dodano cechy Niestabilny i Ochrona`\r\n         args.test.result.other.push(text)  \r\n        this.script.scriptNotification(text);\r\n     \r\n        let ward = await fromUuid(\"Compendium.wfrp4e-core.items.Bvd2aZ0gQUXHfCTh\")\r\n        let wardData = ward.toObject();\r\n        wardData.system.specification.value = 9;\r\n        \r\n        let unstable = await fromUuid(\"Compendium.wfrp4e-core.items.D0ImWEIMSDgElsnl\")\r\n        let unstableData = unstable.toObject();\r\n        this.actor.createEmbeddedDocuments(\"Item\", [wardData, unstableData], {fromEffect: this.effect.id})\r\n    }\r\n",
    "pLKv4moua6XhNdmA": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.1dUizIgLBgn4jICC\");\r\nlet data = item.toObject();\r\ndata.name += \" (Lasy)\";\r\nthis.actor.createEmbeddedDocuments(\"Item\", Array(this.effect.sourceTest.result.overcast.usage.other.current).fill(data), {fromEffect : this.effect.id})",
    "PmELrzD3RmF9qKkO": "if (this.item.system.specification.value == \"Rozmiar\")\r\n{\r\n    let choice = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.actorSizes, this.item.img), 1, \"Wybierz rozmiar\");\r\n    if (choice[0])\r\n    {\r\n        this.item.updateSource({\"system.specification.value\" : choice[0].name})\r\n        this.effect.updateSource({name : this.effect.name + ` (${choice[0].name})`})\r\n    }\r\n}",
    "pNPjXEoQGHLKzq0r": "let talent = this.actor.has(\"Magia Tajemna (Światła)\", \"talent\")\r\nlet demon = this.actor.has(game.i18n.localize(\"NAME.Daemonic\"))\r\n\r\nif (!talent)\r\n{\r\n   await this.actor.addCondition(\"blinded\")\r\n}\r\n\r\nif (demon)\r\n{\r\n    await this.actor.addCondition(\"stunned\")\r\n}",
    "pR4Q2OnPxXtwRVli": "let criticals = this.actor.itemTypes.critical;\r\n\r\nif (criticals.length)\r\n{\r\n    this.script.scriptNotification(\"Nie może doznać krytycznych ran\");\r\n    this.actor.deleteEmbeddedDocuments(\"Item\", criticals.map(i => i.id))\r\n}\r\n\r\nif (getProperty(args.data, \"system.status.wounds.value\") == 0)\r\n{\r\n    this.script.scriptNotification(`Uśpiony na ${Math.ceil(CONFIG.Dice.randomUniform() * 10)} Rund`)\r\n}",
    "PVjaKAHTKDA0rA9J": "let test = await this.actor.setupSkill(\"Unik\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`});\r\nawait test.roll();",
    "q0LvphC8RDSyR0oY": "let choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n    ws : game.wfrp4e.config.characteristics.ws,\r\n    t : game.wfrp4e.config.characteristics.t,\r\n    ag : game.wfrp4e.config.characteristics.ag,\r\n    wp : game.wfrp4e.config.characteristics.wp\r\n}, this.effect.img), 1, \"Wybierz Cechę\");\r\n\r\nthis.effect.updateSource({\"flags.wfrp4e.characteristic\" : choice[0].id})",
    "Q4EQgP4gZR8TTm7S": "let penalty = 0\r\nif (args.item?.system.attackType)\r\n{\r\n   penalty -= 30\r\n}\r\nif (args.actor.has(\"Percepcja Magiczna\", \"talent\"))\r\n    penalty += 10\r\n\r\nargs.prefillModifiers.modifier += penalty",
    "Q68WiUWY7GxiXBbT": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.9GNpAqgsKzxZKJpp\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = \"Kiedy sam\";\r\ndata.effects[0].disabled = true;\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "qAEZgtu5CrfUkxhx": "if (args.test.options.staunchBleeding) \r\n{\r\n if (args.test.succeeded) \r\n {\r\n   let staunch =  Number(args.test.result.SL) + 1\r\n   if (args.test.options.fieldDressing && args.test.result.reversed)\r\n   {\r\n     staunch =  Math.min(1, Number(args.test.result.SL)) + 1\r\n   }\r\n   args.test.result.other.push(`<b>${this.actor.name}</b>: usunięto pacjentowi liczbę stanów krwawienia równą: <b>${staunch}</b>.`)\r\n }\r\n   else if (this.actor.characteristics.int.bonus + Number(args.test.result.SL) < 0)\r\n   {\r\n      args.test.result.other.push(`Pacjent otrzymuje @UUID[Compendium.wfrp4e-core.items.Item.1hQuVFZt9QnnbWzg]{Pomniejszą Infekcję}.`)\r\n   }\r\n}",
    "Qgn92fZyc3Psn8QJ": "if (args.test.options.useOnesAttractive && (args.test.result.roll <= game.settings.get(\"wfrp4e\", \"automaticSuccess\") || args.test.result.roll <= args.test.target))\r\n{\r\n\r\nlet SL = Math.floor(args.test.target / 10) - Math.floor(args.test.result.roll / 10)\r\nlet ones = Number(args.test.result.roll.toString().split(\"\").pop())\r\n\r\nif (ones > SL)\r\n\targs.test.data.result.SL = \"+\" + (ones + args.test.successBonus + args.test.slBonus)\r\n   args.test.result.other.push(`<b>${this.effect.name}</b>: Użyto wartości kości jedności jako PS`)\r\n}",
    "qmOt7h17hGAKqQe0": "\r\nlet choice = await Dialog.wait({\r\n    title: this.effect.name,\r\n    content: `<p><strong>${this.effect.name}</strong>: Czy ten Magiczny lub Zasięgowy atak pochodził spoza Kopuły?</p>`,\r\n    buttons: {\r\n        yes: {\r\n            label: \"Tak\",\r\n            callback: () => {\r\n                return true;\r\n            }\r\n        },\r\n        no: {\r\n            label: \"Nie\",\r\n            callback: () => {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\nif (choice)\r\n{\r\n\targs.ward = 6;\r\n}",
    "QoEOxRruQXYrZrv3": "let filters = [\r\n    {\r\n        property : \"type\",\r\n        value : \"skill\"\r\n    },\r\n    {\r\n        property : \"name\",\r\n        value : /Melee/gm,\r\n        regex: true\r\n    }\r\n]\r\n\r\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 2, \"Wybierz dwie umiejętności aby dodać +20\")\r\nitems = items.map(i => i.toObject())\r\nitems.forEach(i => i.system.advances.value = 20)\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);",
    "QRSACifDrvojIXHB": "if (!this.actor.effects.find(e => e.isCondition))\r\n{\r\n\treturn this.script.scriptNotification(\"Aktor nie posiada żadnych Stanów\")\r\n}\r\n\r\nlet choice = await ItemDialog.create(this.actor.effects.filter(i => i.isCondition), 1, \"Wybierz Stan\")\r\n\r\nif (choice[0])\r\n{\r\n\tthis.actor.removeCondition(choice[0].conditionId)\r\n}\r\n",
    "qT0WBPxLMMO9gvCd": "if (!this.actor.has(\"Widzenie w Ciemności\") && !this.actor.has(\"Widzenie w Ciemności\", \"talent\") && !this.actor.hasCondition(\"blinded\"))\r\n{\r\n    this.actor.addCondition(\"blinded\", 1, {\"flags.wfrp4e.nightshroud\" : true})\r\n}",
    "qu194dVXm9Vx1TGk": "if (args.test.options.useOnesSupportive && (args.test.result.roll <= game.settings.get(\"wfrp4e\", \"automaticSuccess\") || args.test.result.roll <= args.test.target))\r\n{\r\n\r\nlet SL = Math.floor(args.test.target / 10) - Math.floor(args.test.result.roll / 10)\r\nlet ones = Number(args.test.result.roll.toString().split(\"\").pop())\r\n\r\nif (ones > SL)\r\n\targs.test.data.result.SL = \"+\" + (ones + args.test.successBonus + args.test.slBonus)\r\n   args.test.result.other.push(`<b>${this.effect.name}</b>: Użyto wartości kości jedności jako PS`)\r\n}",
    "quPcuKsq2fcild4a": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, fields: {difficulty: \"easy\"}, context: {failure : `<strong>${this.effect.name}</strong>: Rzyyyyg!`} })\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"prone\")\r\n}",
    "QwHoqu2oO8QO8Mad": "let content = `<b>${this.effect.name}</b>: Wszyscy będący w zwarciu z <b>${this.actor.prototypeToken.name}</b> otrzymują [[/r 1d10]] Obrażeń, zmniejszonych o wartość Bonusu Wt oraz Pancerza.`\r\n\r\nthis.script.scriptMessage(content)",
    "qxzhPtysAjPWspKf": "if (this.actor.has(game.i18n.localize(\"NAME.Undead\")) || this.actor.has(game.i18n.localize(\"NAME.Daemonic\")))\r\n{\r\n    this.script.scriptNotification(`Nie może wejśc ze względu na: ${this.effect.name}!`);\r\n}",
    "R32U01LBjBrK1pns": "        const templateMap = {\r\n            'P2e7Yx98bK3u110a' : \"\",\r\n            'iuMp3KLaMT2WCmie' : \"Xp4r2KUhqfjak8zq\", \r\n            'RBuYcT5tppwcmnC5' : \"wYN19h3WVF1yOVq2\", \r\n            'vcGpNwNbhvfzVveQ' : \"ac5ClOuaYtzOYyWp\", \r\n            'jmhKZy0w9TzkEK9c' : \"IS3LTdTuay6uRHUq\", \r\n            '9Byj6k7SmdTYis2V' : \"LjMlx99gBGeRJUQu\", \r\n            'laJwc2l9tzJPgaaJ' : \"x5wpMprsObuqMCYg\",\r\n        }\r\n        let template = (await game.wfrp4e.tables.rollTable(\"hireling-templates\", {hideDSN: true})).object;\r\n        let physicalQuirk = (await game.wfrp4e.tables.rollTable(\"physical-quirks\", {hideDSN: true})).text;\r\n        let workEthic = (await game.wfrp4e.tables.rollTable(\"work-ethic\", {hideDSN: true})).text;\r\n        let personalityQuirk = (await game.wfrp4e.tables.rollTable(\"personality-quirks\", {hideDSN: true})).text;\r\n\r\n\r\n        let templateItem = await game.wfrp4e.utility.findItemId(templateMap[template._id]);\r\n\r\n        let bio = \r\n        `\r\n        <p><strong>Szablon</strong>: ${template.text}</p>\r\n        <p><strong>Fizyczne dziwactwo</strong>: ${physicalQuirk}</p>\r\n        <p><strong>Etyka pracy</strong>: ${workEthic}</p>\r\n        <p><strong>Osobowościowe dziwactwa</strong>: ${personalityQuirk}</p>\r\n        `\r\n        \r\n        this.script.scriptMessage(bio, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n\r\n        await this.actor.update({\"system.details.gmnotes.value\" : bio})\r\n\r\n        if (templateItem)\r\n        {\r\n            this.actor.createEmbeddedDocuments(\"Item\", [templateItem.toObject()])\r\n        }",
    "ramav4ymrDDkPKK4": "if (this.actor.hasCondition(\"bleeding\"))\r\n{\r\n    this.actor.removeCondition(\"bleeding\");\r\n    this.script.scriptNotification(\"Usunięto 1 Stan Krwawienia\");\r\n}\r\nelse \r\n{\r\n    this.script.scriptNotification(\"Brak Stanów Krwawienia do usunięcia\");\r\n}",
    "rCh3ltUrUMovd2Kc": "if (this.actor.hasCondition(\"surprised\"))\r\n{\r\n    this.script.scriptNotification(\"Nie może zostać zaskoczony\");\r\n    this.actor.removeCondition(\"surprised\");\r\n}",
    "RDtJXji3hgcKnEBk": "let as = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.9h82z72XGo9tfgQS\")).toObject();\r\nlet hv = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.Nj3tC8A5fZ3zEdMR\")).toObject();\r\nlet ms = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.6w30u0VPsAicrqb5\")).toObject();\r\nlet ss = (await fromUuid(\"Compendium.wfrp4e-core.items.Item.OEjUvJKi0xmBwbS2\")).toObject();\r\n\r\nas.name += \" (Wzrok)\";\r\n\r\nlet roll = (await new Roll(\"1d10\").roll());\r\nroll.toMessage(this.script.getChatData())\r\nlet items = []\r\n\r\nif (roll.total <= 2)\r\n{\r\n    items = items.concat([as]);\r\n}\r\nelse if (roll.total <= 4)\r\n{\r\n    items = items.concat([hv]);\r\n}\r\nelse if (roll.total <= 6)\r\n{\r\n    items = items.concat([ms]);\r\n}\r\nelse if (roll.total <= 8)\r\n{\r\n    items = items.concat([ss]);\r\n}\r\nelse if (roll.total <= 10)\r\n{\r\n    items = items.concat([as, hv, ms, ss]);\r\n}\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", items, {fromEffect: this.effect.id})",
    "re1UFtxvRRjpPB7Z": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.nF5z1OEhpi4t6a6S\");\r\nlet data = item.toObject();\r\ndata.system.location.key = this.item.system.location.key\r\nif (data.system.location.key[0] == \"r\")\r\n{\r\n\tdata.system.location.value = \"Prawa kostka\"\r\n}\r\nelse if (data.system.location.key[0] == \"l\")\r\n{\r\n\tdata.system.location.value = \"Lewa kostka\"\r\n}\r\n\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {skipLocationValue : true, fromEffect: this.effect.id})\r\n",
    "red2bt4PGgIWAdTR": "if (this.item.system.quantity.value)\r\n{\r\n\tthis.item.system.reduceQuantity();\r\n\tlet actor = Array.from(game.user.targets)[0]?.actor || this.actor;\r\n     let effectData = this.item.effects.contents[0].convertToApplied();\r\n     let minutes = Math.ceil(CONFIG.Dice.randomUniform() * 10) * 10;\r\n     effectData.duration.seconds = 60 * minutes\r\n     this.script.scriptMessage(`<strong>Czas Trwania</strong>: ${minutes} minut`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n\tactor.applyEffect({effectData : [effectData]})\r\n}\r\nelse\r\n{\r\n\tthis.script.scriptNotification(\"None left!\", \"error\")\r\n}",
    "rF0Z3hTUUnSxL3Mq": "let armour = (await fromUuid(\"Compendium.wfrp4e-core.items.VUJUZVN3VYhOaPjj\")).toObject()\r\nlet bite = (await fromUuid(\"Compendium.wfrp4e-core.items.pLW9SVX0TVTYPiPv\")).toObject()\r\nlet fear = (await fromUuid(\"Compendium.wfrp4e-core.items.pTorrE0l3VybAbtn\")).toObject()\r\nlet nightVision = (await fromUuid(\"Compendium.wfrp4e-core.items.FmHDbCOy3pH8yKhm\")).toObject()\r\nlet tracker = (await fromUuid(\"Compendium.wfrp4e-core.items.ClOlztW6hH8rslbp\")).toObject()\r\nlet weapon = (await fromUuid(\"Compendium.wfrp4e-core.items.AtpAudHA4ybXVlWM\")).toObject()\r\n\r\narmour.name = \"Pancerz (Skóra)\"\r\narmour.system.specification.value = 2\r\nbite.system.specification.value = 3\r\nfear.system.specification.value = 2\r\nweapon.system.specification.value = 4\r\nlet items = [armour, bite, fear, nightVision, tracker, weapon]\r\n\r\n\r\nlet belligerent = (await fromUuid(\"Compendium.wfrp4e-core.items.GbDyBCu8ZjDp6dkj\")).toObject()//{Belligerent}\r\nlet bestial = (await fromUuid(\"Compendium.wfrp4e-core.items.AGcJl5rHjkyIQBPP\")).toObject()//{Bestial}\r\nlet big = (await fromUuid(\"Compendium.wfrp4e-core.items.a8MC97PLzl10WocT\")).toObject()//{Big}\r\nlet blessed = (await fromUuid(\"Compendium.wfrp4e-core.items.5muSFXd6oc760uVj\")).toObject()//{Blessed (Ulric)}\r\nlet champion = (await fromUuid(\"Compendium.wfrp4e-core.items.4mF5Sp3t09kZhBYc\")).toObject()//{Champion}\r\nlet die = (await fromUuid(\"Compendium.wfrp4e-core.items.UsJ2uIOOtHA7JqD5\")).toObject()//{Die Hard}\r\nlet fast = (await fromUuid(\"Compendium.wfrp4e-core.items.9MjH4xyVrd3Inzak\")).toObject()//{Fast}\r\nlet frenzy = (await fromUuid(\"Compendium.wfrp4e-core.items.yRhhOlt18COq4e1q\")).toObject()//{Frenzy}\r\nlet immunity = (await fromUuid(\"Compendium.wfrp4e-core.items.IAWyzDfC286a9MPz\")).toObject()//{Immunity to Psychology}\r\nlet regenerate = (await fromUuid(\"Compendium.wfrp4e-core.items.SfUUdOGjdYpr3KSR\")).toObject()//{Regenerate}\r\nlet size = (await fromUuid(\"Compendium.wfrp4e-core.items.8slW8CJ2oVTxeQ6q\")).toObject()//{Size (Large)}\r\n\r\nblessed.system.specification.value = \"Ulryk\"\r\nsize.system.specification.value = \"Duży\"\r\n\r\nlet optional = [belligerent, bestial, big, blessed, champion, die, fast, frenzy, immunity, regenerate, size];\r\n\r\nlet chosen = await ItemDialog.create(optional, \"unlimited\", \"Wybierz opcjonalne cechy\");\r\n\r\nitems = items.concat(chosen || [])\r\nthis.script.scriptNotification(`Dodano: ${items.map(i => i.name).join(\", \")}`);\r\nthis.actor.createEmbeddedDocuments(\"Item\", items, {fromEffect : this.effect.id})\r\n",
    "RHyBLYT5oHf7EPnG": "let skills = this.actor.itemTypes.skill.filter(i => i.name.includes(game.i18n.localize(\"NAME.Melee\")))\r\n\r\nlet skill = await ItemDialog.create(skills, 1, \"Wybierz umiejętność wybranej broni\")\r\nlet group = game.wfrp4e.utility.extractParenthesesText(skill[0]?.name)\r\nlet groupKey = game.wfrp4e.utility.findKey(group, game.wfrp4e.config.weaponGroups)\r\n\r\nlet weapon = {\r\n\tname : this.effect.name,\r\n\ttype : \"weapon\",\r\n\timg : this.effect.img,\r\n\tsystem : {\r\n\t\t\"damage.value\" : this.actor.system.characteristics.wp.bonus,\r\n\t\t\"weaponGroup.value\" : groupKey || \"basic\",\r\n\t\t\"twohanded.value\" : [\"polearm\", \"twohanded\"].includes(groupKey),\r\n\t\t\"reach.value\" : \"average\",\r\n\t\t\"qualities.value\" : [{name : \"magical\"}]\r\n\t},\r\n}\r\n\r\nItem.implementation.create(foundry.utils.expandObject(weapon), {parent : this.actor, fromEffect : this.effect.id})\r\nthis.script.scriptNotification(\"Utworzony Broń. Dalsze dostosowywanie należy wykonać ręcznie w Karcie przedmiotu\");",
    "RKIFGN583PQnqHGk": "if (args.opposedTest.result.hitloc.value == \"body\" && args.totalWoundLoss > 0)\r\n{\r\n    args.actor.addCondition(\"bleeding\", 2)\r\n    this.script.scriptMessage(\"Otrzymano 2 Stany Krwawienia\")\r\n}",
    "rpxQU26BU7nwjtqY": "let location = this.item.system.location.key\r\nlet test = await this.actor.setupCharacteristic(\"dex\", {context : {failure : `<strong>${this.effect.name}</strong>: Upuść przedmiot!`}, skipTargets: true, appendTitle :  \" - \" + this.effect.name, fields : {difficulty : \"average\"}})\r\nawait test.roll();\r\n\r\n\r\nif (location && test.failed)\r\n{\r\n    let dropped = this.item.system.weaponsAtLocation;\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono: ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}\r\n\r\nreturn test.succeeded",
    "RrchOMpEdIvceJxl": "return args.skill?.name == \"Skradanie (Wieś)\"",
    "RSsGiDFibuqg3sHr": "let diseaseIndex = game.packs\r\n.filter(i => i.metadata.type == \"Item\")\r\n.reduce((acc, pack) => acc.concat(pack.index.contents), [])\r\n.filter(i => i.type == \"disease\")\r\n.map(i => {\r\n\ti.id = i._id\r\n\treturn i\r\n})\r\n\r\nlet choice = await ItemDialog.create(diseaseIndex , 1, \"Wybierz Chorobę\")\r\n\r\nif (choice[0])\r\n{\r\n\tawait this.item.updateSource({\"system.specification.value\" : choice[0].name})\r\n}",
    "S1QihXuvdEVzeRtB": "let dice = await new Roll(\"1d10\").roll()\r\nlet roll = dice.total\r\nlet talent \r\nlet message\r\nlet modifier = 0\r\n\r\nif (roll <= 3)\r\n{\r\n    item = await fromUuid(\"Compendium.wfrp4e-core.items.mNoCuaVbFBflfO6X\")\r\n}\r\n\r\nelse if (roll <= 6)\r\n{\r\n    item = await fromUuid(\"Compendium.wfrp4e-core.items.OEjUvJKi0xmBwbS2\")\r\n    modifier = -3\r\n}\r\n\r\nelse if (roll <= 9)\r\n{\r\n    item = await fromUuid(\"Compendium.wfrp4e-core.items.mdPGZsn2396dEpOf\")\r\n    modifier = -3\r\n}\r\n\r\nelse if (roll = 10)\r\n{\r\n    item = await fromUuid(\"Compendium.wfrp4e-core.items.qdMbxW09FUoYBzmB\")\r\n    modifier = -5\r\n}\r\n\r\nmessage = `Wyrzucono ${roll}, Otrzymano ${item.name}, ${modifier} Siły`\r\ndice.toMessage(this.script.getChatData())\r\n\r\nlet changes = duplicate(this.effect.changes)\r\nchanges[0].value = modifier\r\n\r\nthis.effect.updateSource({changes})\r\n\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [item.toObject()], {fromEffect : this.effect.id})\r\n\r\nthis.script.scriptNotification(message)",
    "S3Dev4hleOYqDNe9": "if (args.test.options.healWounds) {\r\n if (args.test.succeeded) \r\n {\r\n   let wounds = this.actor.characteristics.int.bonus + Number(args.test.result.SL)\r\n   if (args.test.options.fieldDressing && args.test.result.reversed)\r\n   {\r\n      wounds = this.actor.characteristics.int.bonus + Math.min(1, Number(args.test.result.SL))\r\n   }\r\n\targs.test.result.woundsHealed = wounds\r\n\targs.test.result.other.push(`<b>${this.actor.name}</b>: uleczono pacjentowi liczbę ran równą: <b>${wounds}</b>.`)\r\n   }\r\n   else if (this.actor.characteristics.int.bonus + Number(args.test.result.SL) < 0)\r\n   {\r\n      args.test.result.other.push(`Pacjent otrzymuje @UUID[Compendium.wfrp4e-core.items.Item.1hQuVFZt9QnnbWzg]{Pomniejszą Infekcję}.`)\r\n   }\r\n}",
    "s7gJQdzuM3fz2zQK": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.QluSTTTq3viHJJUh\")\r\nlet data = item.toObject();\r\ndata.system.location.value = \"Biodro\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n   \r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"prone\")\r\n}",
    "s8idWt9YdMTRfnjV": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.BqPZn6q3VHn9HUrW\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = 4 - this.actor.characteristics.s.bonus\r\ndata.name = item.name.replace(\"()\", \"\");\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "sB4KB9bT3nQhAoqG": "// This script needs to be separate because equipTransfer is off on the other effect, and thus won't execute when added to an actor\r\n\r\nlet mainEffect = this.item.effects.contents[0];\r\nif (mainEffect.name.includes(\"<Tradycja>\"))\r\n{\r\n    let choice = await ItemDialog.create(ItemDialog.objectToArray(game.wfrp4e.config.magicLores, this.item.img), 1, \"Wybierz Tradycję\");\r\n    if (choice.length)\r\n    {\r\n        mainEffect.update({name : mainEffect.name.replace(\"<Tradycja>\", choice[0].name)})\r\n        this.item.update({name : this.item.name += ` (${choice[0].name})`})\r\n    }\r\n}\r\n\r\nthis.effect.delete();",
    "sbK1a7txpSoXFzyB": "if (args.test.options.useOnesArgumentative && (args.test.result.roll <= game.settings.get(\"wfrp4e\", \"automaticSuccess\") || args.test.result.roll <= args.test.target))\r\n{\r\n\r\nlet SL = Math.floor(args.test.target / 10) - Math.floor(args.test.result.roll / 10)\r\nlet ones = Number(args.test.result.roll.toString().split(\"\").pop())\r\n\r\nif (ones > SL)\r\n\targs.test.data.result.SL = \"+\" + (ones + args.test.successBonus + args.test.slBonus)\r\n   args.test.result.other.push(`<b>${this.effect.name}</b>: Użyto wartości kości jedności jako PS.`)\r\n}",
    "SGr50Hq1AHIEzIFN": "let choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n    int : game.wfrp4e.config.characteristics.int,\r\n    fel : game.wfrp4e.config.characteristics.fel\r\n}, this.effect.img), 1, \"Wybierz Cechę\");\r\n\r\nthis.effect.updateSource({\"flags.wfrp4e.characteristic\" : choice[0].id})",
    "sgS9rblPkQB36C8S": "if (this.item.name.includes(\"(\"))\r\n{\r\n\tlet trade = this.item.parenthesesText;\r\n\tif (trade?.toLowerCase() != \"dowolne\")\r\n\t    return this.item.updateSource({\"system.tests.value\" : this.item.system.tests.value.replace(\"Dowolne\", trade)})\r\n}\r\n\r\nlet index = game.packs\r\n.filter(i => i.metadata.type == \"Item\")\r\n.reduce((acc, pack) => acc.concat(pack.index.contents), [])\r\n.filter(i => i.type == \"skill\" && i.name.includes(game.i18n.localize(\"NAME.Trade\")))\r\n.map(i => {\r\n\ti.id = i._id\r\n\treturn i\r\n})\r\n\r\nlet choice = await ItemDialog.create(index, 1, \"Wybierz Umiejętność Rzemieślniczą\")\r\nlet text;\r\nif (!choice[0])\r\n{\r\n    let custom = await ValueDialog.create(\"wpisz własny rodzaj rzemiosła\", \"Własne Rzemiosło\");  \r\n    text = custom || \"\"\r\n}\r\nelse \r\n{\r\n    text = game.wfrp4e.utility.extractParenthesesText(choice[0].name)\r\n}\r\n\r\nawait this.item.updateSource({name : this.item.name.replace(\"(Dowolne)\", \"\").replace(\"(Dowolne Rzemiosło)\", \"\").trim() + ` (${text})`, \"system.tests.value\" : this.item.system.tests.value.replace(\"Dowolne\", text)});",
    "shkBUtUuMPDKvFm7": "let test = await this.actor.setupSkill(\"Unik\", {fields : {difficulty : \"average\"}})\r\nlet caster = this.effect.sourceActor\r\n\r\nlet fallen = this.effect.sourceTest.result.SL + caster.characteristics.wp.bonus\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"prone\")\r\n   this.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b>: upadek w odległości ${fallen} metrów`)\r\n}",
    "sKO8TcLIkCTnFvXu": "args.abort = true;\r\nthis.script.scriptNotification(`Nie można używać: ${this.item.system.location.value}!`, \"error\")",
    "sNSfDBIA2k17hPYI": "let ablaze = this.actor.hasCondition(\"ablaze\");\r\nif (ablaze)\r\n{\r\n\tablaze?.delete();\r\n\tthis.script.scriptNotification(\"Ingoruje Podpalenie\");\r\n}\r\n",
    "sWyO1DNaqb2EdHoW": "if (!this.actor.items.getName(\"Szał Bojowy\")) // Either frenzy trait or psychology\r\n{\r\n  // Add Frenzy psychology\r\n  let item = await fromUuid(\"Compendium.wfrp4e-core.items.DrNUTPeodEgpWTnT\")\r\n  let data = item.toObject();\r\n  data.effects[0].disabled = false;\r\n  this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n}\r\n\r\nthis.script.scriptMessage(`<p><strong>Po wypiciu tej mikstury, ${this.actor.prototypeToken.name}</strong> wpada w Szał Bojowy. Stan ten trwa [[1d10]] rund, i nie może zostać zakończony wcześniej.</p>`, \r\n  {whisper: ChatMessage.getWhisperRecipients(\"GM\"), blind: true })   ",
    "sx7Ikn8WW00gBFb4": "let location = (Math.ceil(CONFIG.Dice.randomUniform() * 2) == 2 ? \"r\" : \"l\") + \"Arm\"\r\n\r\nif (location == \"lArm\")\r\n{\r\n\tthis.script.scriptNotification(\"Wylosowano Lewą\")\r\n}\r\nelse if (location == \"rArm\")\r\n{\r\n\tthis.script.scriptNotification(\"Wylosowano Prawą\")\r\n}\r\n\r\nthis.effect.updateSource({\"flags.wfrp4e.location\" : location});\r\n\r\nif (location)\r\n{\r\n    let dropped = this.actor.itemTypes.weapon.filter(i => i.isEquipped & i.system.usesHands.includes(location));\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono: ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}\r\n\r\nlet roll = await new Roll(\"1d10\").roll()\r\n\r\nroll.toMessage(this.script.getChatData({flavor : `${this.effect.name} (Czas Trwania)`}));\r\n\r\nthis.effect.updateSource({\"duration.rounds\" : roll.total})",
    "syqqBkyP5tGqZ78t": "this.actor.has(\"Niewrażliwość na Psychologię\")?.delete();\r\n\r\nlet roll = await new Roll(\"1d10\").roll();\r\n\r\nroll.toMessage(this.script.getChatData());\r\n\r\nthis.script.scriptNotification(`Usunięto odporność na psychologię, otrzymano Stany Paniki: ${roll.total}`)\r\nthis.actor.addCondition(\"broken\", roll.total, {\"flags.wfrp4e.blasted-mind\" : true})",
    "sZwLitzwKBTaFca3": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.5hH73j2NgPdsLCZN\")\r\nlet data = item.toObject();\r\ndata.name = data.name.replace(\"x\", \"Zielonoskórzy, Nieumarli, Chaos\")\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "t56mnblo1kv3gM1M": "return args.skill?.name.includes(\"Broń Biała (Podstawowa)\") || (args.type == \"weapon\" && args.item?.system.weaponGroup.value == \"basic\");",
    "T5fiTzhXEQAv9Drf": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.rlDZZTj5PXjuRXa2\")\r\nlet data = item.toObject();\r\ndata.system.location.key = this.item.system.location.key;\r\nawait this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n\r\nlet location = this.item.system.location.key;\r\n\r\nif (location)\r\n{\r\n    let dropped = this.item.system.weaponsAtLocation;\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}",
    "tCIT1a12Gt6k2ohA": "let resistance\r\nif (this.item.name.includes(\"(\") && !this.item.name.toLowerCase().includes(\"dowolna\"))\r\n{\r\n\tresistance = this.item.parenthesesText\r\n}\r\nelse \r\n{\r\n    resistance = await ValueDialog.create(\"Wybierz Odporność\", \"Odporność\") \r\n    \r\n    if (resistance)\r\n    {\r\n        this.item.updateSource({name : `${this.item.name.split(\"(\")[0].trim()} (${resistance})`})\r\n        this.effect.updateSource({name : this.effect.name + ` (${resistance})`})\r\n    }\r\n}    \r\nthis.item.updateSource({\"system.tests.value\" : this.item.system.tests.value.replace(\"przypisane Zagrożenie\", resistance)})\r\n\r\nif (resistance && !this.effect.name.includes(\"(\"))\r\n{\r\n    this.effect.updateSource({name : this.effect.name += ` (${resistance})`})\r\n}",
    "tcZug8ehU6lyYBd9": "return args.skill?.name != \"Broń Zasięgowa (Prochowa)\"",
    "TGN070HeJLl3gSMY": "let test = await this.actor.setupCharacteristic(\"ag\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context: { failure: \"Upadek\" }})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"prone\");\r\n}",
    "tGVEV6TLl310mFLP": "let nonmagical = args.modifiers.ap.value - args.modifiers.ap.magical\r\nif (args.applyAP && nonmagical) \r\n{\r\n    let nonmagical = args.modifiers.ap.value - args.modifiers.ap.magical\r\n    args.modifiers.ap.ignored += nonmagical\r\n    args.modifiers.ap.details.push(\"<strong>\" + this.effect.name + \"</strong>: Zignorowano Niemagiczny Pancerz (\" + nonmagical + \")\");\r\n}",
    "tn6SwmjAuNzqE6dx": "let damage = 0\r\nlet test = await this.actor.setupSkill(\"Unik\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`});\r\nawait test.roll();\r\n\r\nif (test.succeeded)\r\n{\r\n    damage = 10;\r\n}\r\nelse if (test.failed)\r\n{\r\n   damage = 20;\r\n}\r\n\r\nthis.script.scriptMessage(await this.actor.applyBasicDamage(damage, {loc : \"roll\", hideDSN: true, suppressMsg : true}))",
    "tNTO1LVN7JqHf4YN": "if (args.test.characteristicKey == \"wp\") \r\n{\r\n    if (args.test.failed)\r\n    {\r\n        this.actor.createEmbeddedDocuments(\"ActiveEffect\", [game.wfrp4e.config.symptomEffects[\"malaise\"]])\r\n        this.script.scriptMessage(`Test Siły Woli nie udał się, <b>${this.actor.prototypeToken.name}</b>: Otrzymano @Symptom[Apatia]{Apatię} na [[1d10]] godzin`, {whisper: ChatMessage.getWhisperRecipients(\"GM\")})\r\n    }\r\n}",
    "toSrgcvWq9b5eN0K": "let location = await game.wfrp4e.tables.rollTable(\"hitloc\", {hideDSN: true})\r\n\r\nthis.item.updateSource({name : `${this.item.name} (${location.description})`})\r\nthis.script.scriptMessage(`<strong>Miejsce:</strong> ${location.description}`, { whisper: ChatMessage.getWhisperRecipients(\"GM\") })",
    "TrIYdcG3jDER4WgY": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.xsGbDFqK2qh7lsIj\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = \"Pomniejsza\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "tUwP7TjrOOOnaCYJ": "let fatigued = this.actor.hasCondition(\"fatigued\")\r\nif (fatigued)\r\n{\r\n   this.script.scriptNotification(`Usunięte Stany Zmęczenia: ${fatigued.conditionValue}`)\r\n   fatigued.delete();  \r\n}\r\nelse \r\n{\r\n\tthis.script.scriptNotification(`Brak Stanów Zmęczenia do usunięcia`)\r\n}",
    "TwgdEucxcHloc4cX": "let choice1 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Nogawice kolcze\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Kolczuga\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Czepiec kolczy\"\r\n    },\r\n]\r\nlet choice2 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Nogawice kolcze\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Kolczuga\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Czepiec kolczy\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzane nogawice\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzany hełm\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzana kurta\"\r\n    },\r\n]\r\nlet choice3 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowy Napierśnik\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowe Naramienniki\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Hełm płytowy\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowe Nagolenniki\"\r\n    },\r\n]\r\n\r\nlet choice = await new Promise((resolve, reject) => {\r\n    new Dialog({\r\n        title : \"Wybór zbroi\",\r\n        content : \r\n        `<p>\r\n        Wybierz\r\n        </p>\r\n        <ol>\r\n        <li>Kolczuga</li>\r\n        <li>Kolczuga i skóra</li>\r\n        <li>Płyta</li>\r\n        </ol> \r\n        `,\r\n        buttons : {\r\n            1 : {\r\n                label : \"Kolczuga\",\r\n                callback : () => {\r\n                    resolve(choice1)\r\n                }\r\n            },\r\n            2 : {\r\n                label : \"Kolczuga i skóra\",\r\n                callback : () => {\r\n                    resolve(choice2)\r\n                }\r\n            },\r\n            3 : {\r\n                label : \"Płyta\",\r\n                callback : () => {\r\n                    resolve(choice3)\r\n                }\r\n            }\r\n        }\r\n    }).render(true)\r\n}) \r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Could not find ${c.name}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "U1UpSRJOSjPpO4HS": "let mutations = await game.wfrp4e.utility.findAll(\"mutation\", \"Wczytywanie Mutacji...\")\r\nlet roll = Math.floor(CONFIG.Dice.randomUniform() * mutations.length);\r\nthis.actor.createEmbeddedDocuments(\"Item\", [mutations[roll]]);\r\nthis.script.scriptNotification(`Otrzymano: ${mutations[roll].name}`)",
    "U26XMie3Kjoddisj": "let stunned = this.actor.hasCondition(\"stunned\")\r\nif (stunned)\r\n{\r\n   this.script.scriptNotification(`Usunięto 1 Stan Oszołomienia`)\r\n   this.actor.removeCondition(\"stunned\");\r\n}\r\nelse \r\n{\r\n\tthis.script.scriptNotification(`Brak Stanów Oszołomienia do usunięcia`)\r\n}",
    "U4A8FDNmwBGTuQZO": "if (args.attacker.has(game.i18n.localize(\"NAME.Undead\")) && !args.attacker.has(game.i18n.localize(\"NAME.Ethereal\")))\r\n{\r\n    args.totalWoundLoss =  Math.floor(args.totalWoundLoss / 2)\r\n    args.modifiers.other.push({label : this.effect.name, details : \"Zmniejszone o połowę\", value : \"× 0.5\"})\r\n}",
    "U9xh2wriSqCosugW": "if (args.test.options.stag)\r\n{\r\n\tif (parseInt(args.test.result.SL) < 0 || args.test.failed)\r\n\t{\r\n\t\tif (parseInt(args.test.result.SL) < 0)\r\n\t\t{\r\n\t\t\targs.test.result.SL = \"+0\";\r\n\t\t\targs.test.result.description = game.i18n.localize(\"ROLL.MarginalSuccess\");\r\n\t\t}\r\n\t\targs.test.result.outcome = \"success\"\r\n        args.test.result.other.push(`<strong>${this.effect.name}</strong>: Minimum +0 PS`)\r\n\t}\r\n}",
    "uACa6u4JLNMRgFlr": "const talents = await Promise.all([\"Wściekły Atak\", \"Urodzony żeglarz\"].map(game.wfrp4e.utility.findTalent))\r\nthis.actor.createEmbeddedDocuments(\"Item\", talents, {fromEffect : this.effect.id})",
    "UaImulhbPURkLJg2": "return this.actor.attacker && (args.skill?.name.includes(\"Broń Biała (Podstawowa)\") || (args.type == \"weapon\" && args.item?.system.weaponGroup.value == \"basic\"))",
    "ucF4aiJ1gpDB333G": "if (args.test.options.catfall && (args.test.result.roll <= game.settings.get(\"wfrp4e\", \"automaticSuccess\") || args.test.result.roll <= args.test.target) && !args.test.result.catfall)\r\n{\r\n   args.test.result.other.push(`<b>${this.effect.name}</b>: Obrażenia od upadku zmniejszone o liczbę metrów: ${Number(args.test.result.SL) + 1}`)\r\n   args.test.result.catfall = true; // Prevent duplicate messages\r\n}",
    "ugL5IBB6R2yWyMWd": "if (args.totalWoundLoss > 0)\r\n{\r\n    let apply = await Dialog.confirm({title : this.effect.name, content : `<p>Zadać Obrażenia z ${this.effect.name}? Atakujący musiał użyć gołych rąk lub broni do walki w zwarciu wykonanej z metalu.`})\r\n    if (apply)\r\n    {\r\n            \r\n        let damage = 5 + this.actor.characteristics.wp.bonus;\r\n        \r\n        let loc = args.opposedTest.attackerTest.weapon?.system.usesHands[0] || \"rArm\";\r\n        \r\n        let APatLoc = args.opposedTest.attacker.system.status.armour[loc];\r\n        \r\n        let metalAP = APatLoc.layers.reduce((metal, layer) => metal += (layer.metal ? layer.value : 0), 0)\r\n        \r\n        let APused = Math.max(0, APatLoc.value - metalAP); // remove metal AP at location;\r\n        \r\n        damage -= (APused + args.opposedTest.attacker.system.characteristics.t.bonus)\r\n        \r\n        let msg = await args.opposedTest.attacker.applyBasicDamage(damage, {suppressMsg : true, damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL});\r\n        msg += ` (zignorowano liczbę punktów metalowego pancerza: ${metalAP} z lokacji: ${game.wfrp4e.config.locations[loc]})`\r\n        this.script.scriptMessage(msg)\r\n    }\r\n}",
    "UgQW0UMPOZ0jwfVJ": "let current = this.actor.status.fortune.value\r\n\r\nthis.actor.update({\"system.status.fortune.value\" : 1 + current})\r\n\r\nthis.script.scriptMessage(`<b>${this.actor.prototypeToken.name}</b>: Punkty Szczęścia zwiększone z ${current} do ${1 + current}`)",
    "uLBDnWC3S0lRitbj": "let test = await this.actor.setupCharacteristic(\"int\", {skipTargets: true, appendTitle :  ` - ${this.effect.name}`})\r\nawait test.roll();\r\n\r\nlet opposedResult = test.opposedMessages[0]?.getOppose()?.resultMessage?.getOpposedTest()?.result\r\n\r\nif (opposedResult?.winner == \"attacker\")\r\n{\r\n    if (test.failed && (test.result.roll % 11 == 0 || test.result.roll == 100))\r\n    {\r\n        this.actor.addCondition(\"unconscious\")\r\n        await this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + 1})\r\n        this.script.scriptMessage(\"Otrzymano Punkt Zepsucia\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    }\r\n    else \r\n    {\r\n        await this.actor.addCondition(\"stunned\", 1 + opposedResult.differenceSL);\r\n    }\r\n}\r\nelse \r\n{\r\n    return false;\r\n}",
    "ULmZMLezDamerN04": "let spells = await game.wfrp4e.utility.findAll(\"spell\", \"Wczytywanie Zaklęć...\")\r\n\r\nlet lore = (await game.wfrp4e.tables.rollTable(\"random-caster\", {hideDSN: true})).text\r\nthis.script.scriptNotification(lore)\r\nif (lore == \"Wybór Mistrza Gry\") {\r\n   return\r\n}\r\n\r\nelse if (lore == \"Magia Tajemna\") {\r\n    lore = \"Magia Tajemna\"\r\n}\r\n\r\nelse if (lore == \"Magia Prosta\") {\r\n    lore = \"petty\"\r\n}\r\n\r\nelse {\r\n    lore = lore.toLowerCase();\r\n}\r\n\r\nlet spellsWithLore = []\r\nif (lore == \"Magia Tajemna\") {\r\n    spellsWithLore = spells.filter(i => !i.system.lore.value)\r\n}\r\nelse {\r\n    spellsWithLore = spells.filter(i => i.system.lore.value == lore)\r\n}\r\n\r\nlet selectedSpell = spellsWithLore[Math.floor(CONFIG.Dice.randomUniform() * spellsWithLore.length)]\r\nItem.implementation.create(selectedSpell.toObject(), { parent: this.actor}).then(item => {\r\n    this.actor.setupCast(item).then(test => test.roll());\r\n})",
    "UnqnWi0dZYLf5fTT": "let choice1 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Nogawice kolcze\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Kolczuga\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Czepiec kolczy\"\r\n    },\r\n]\r\nlet choice2 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Nogawice kolcze\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Kolczuga\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Czepiec kolczy\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzane nogawice\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzany hełm\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Skórzana kurta\"\r\n    },\r\n]\r\nlet choice3 = [\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowy Napierśnik\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowe Naramienniki\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Hełm płytowy\"\r\n    },\r\n    {\r\n        type : \"armour\",\r\n        name : \"Płytowe Nagolenniki\"\r\n    },\r\n]\r\n\r\nlet choice = await Dialog.wait({\r\n    title : \"Wybór zbroi\",\r\n    content : \r\n    `<p>\r\n    Wybierz\r\n    </p>\r\n    <ol>\r\n    <li>Kolczuga</li>\r\n    <li>Kolczuga i skóra</li>\r\n    <li>Płyta</li>\r\n    </ol> \r\n    `,\r\n    buttons : {\r\n        1 : {\r\n            label : \"Kolczuga\",\r\n            callback : () => {\r\n                return choice1\r\n            }\r\n        },\r\n        2 : {\r\n            label : \"Kolczuga i skóra\",\r\n            callback : () => {\r\n                return choice2\r\n            }\r\n        },\r\n        3 : {\r\n            label : \"Płyta\",\r\n            callback : () => {\r\n                return choice3\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Could not find ${c.name}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "upfK6GM33qZCZjll": "return args.item?.name != \"Muzyka (Lutnia)\"",
    "UTlgF4azrGQZsoDv": "const talents = await Promise.all([\"Oburęczność\", \"Rozproszenie Uwagi\"].map(game.wfrp4e.utility.findTalent))\r\nthis.actor.createEmbeddedDocuments(\"Item\", talents, {fromEffect : this.effect.id})",
    "uwdQvZtzy2HVeEzx": "if (args.totalWoundLoss > 0)\r\n{\r\n    let roll = await new Roll(\"1d10\").roll();\r\n    roll.toMessage(this.script.getChatData());\r\n    args.modifiers.other.push({label : this.effect.name, value : roll.total})\r\n    \r\n    args.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"hard\"}, skipTargets: true, appendTitle :  \" - \" + this.effect.name}).then(async test => {\r\n        await test.roll();\r\n        if (test.failed)\r\n        {\r\n            this.script.scriptMessage(\"<strong>\" + args.actor.name + \"</strong> otrzymuje @Table[critbody]{Trafienie Krytyczne} w korpus\", {whisper: ChatMessage.getWhisperRecipients(\"GM\")}) \r\n        }\r\n    })\r\n}\r\n",
    "V1D2Uo3WDKYQePU3": "let damage = this.effect.sourceTest.result.damage;\r\n        \r\nlet loc = \"head\"\r\nlet APatLoc = this.actor.system.status.armour[loc];\r\n\r\nlet metalAP = APatLoc.layers.reduce((metal, layer) => metal += (layer.metal ? layer.value : 0), 0)\r\n\r\nlet APused = Math.max(0, APatLoc.value - metalAP); // remove metal AP at location;\r\n\r\ndamage -= (APused + this.actor.system.characteristics.t.bonus)\r\n\r\nlet msg = await this.actor.applyBasicDamage(damage, {suppressMsg : true, damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL});\r\nmsg += ` (Zignorowano PP metalowego pancerza: ${metalAP} z lokacji ${game.wfrp4e.config.locations[loc]})`\r\nthis.script.scriptMessage(msg)\r\n",
    "v4CCxVaVGf9i8U7X": "let cured = await Dialog.wait({\r\n    title : this.effect.name,\r\n    content : \"<p>Wpisz liczbę chorób/klątw, które zostały uleczone</p><input type='number'>\",\r\n    buttons : {\r\n        confirm : {\r\n            label : \"Potwierdź\",\r\n            callback : (dlg) => {\r\n                let input = dlg.find(\"input\");\r\n                value = parseInt(input[0].value);\r\n                return value;\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\n\r\nlet damage = 0;\r\n\r\nlet rolls = new Array(cured).fill(\"\").map(i => `max(0, 1d10 - ${this.actor.system.characteristics.fel.bonus})`)\r\n\r\nlet test = new Roll(`${rolls.join(\" + \")}`);\r\nawait test.roll();\r\ntest.toMessage({speaker : {alias : this.actor.name}, flavor : this.effect.name});\r\nthis.script.scriptMessage(await this.actor.applyBasicDamage(test.total, { damageType: game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL, suppressMsg : true }))",
    "v5xrDWcrTNFJkyQB": "let choice1 = [\r\n    {\r\n        type : \"skill\",\r\n        name : \"Broń Zasięgowa (Łuk)\",\r\n        diff : {\r\n            system : {\r\n                advances : {\r\n                    value : 10\r\n                }\r\n            }\r\n        }\r\n    },\r\n    {\r\n        type : \"weapon\",\r\n        name : \"Łuk długi\",\r\n    },\r\n    {\r\n        type : \"ammunition\",\r\n        name : \"Strzała\",\r\n    }\r\n]\r\nlet choice2 = [\r\n]\r\n\r\nlet choice = await Dialog.wait({\r\n    title : \"Opcjonalne\",\r\n    content : \r\n    `<p>\r\n    Dodać opcjonalne przedmioty?\r\n    </p>\r\n    <ol>\r\n    <li>Broń Zasięgowa (Łuk) +10 oraz długi łuk z 12 strzałami</li>\r\n    </ol> \r\n    `,\r\n    buttons : {\r\n        1 : {\r\n            label : \"Tak\",\r\n            callback : () => {\r\n                return choice1;\r\n            }\r\n        },\r\n        2 : {\r\n            label : \"Nie\",\r\n            callback : () => {\r\n                return choice2;\r\n            }\r\n        }\r\n    }\r\n})\r\n\r\nlet updateObj = this.actor.toObject();\r\nlet items = []\r\nfor (let c of choice)\r\n{\r\n    let existing \r\n    if (c.type == \"skill\")\r\n    {\r\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\r\n        if (existing && c.diff?.system?.advances?.value)\r\n        {\r\n            existing.system.advances.value += c.diff.system.advances.value\r\n        }\r\n    }\r\n\r\n    if (!existing)\r\n    {\r\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\r\n        if (item)\r\n        {\r\n            item = item.toObject()\r\n            equip(item);\r\n                items.push(mergeObject(item, (c.diff || {})))\r\n        }\r\n        else\r\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n\r\n}\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "V9wD9FWHWxZUOGSI": "let roll = await (new Roll(`max(0, 1d10 - ${this.actor.characteristics.wp.bonus})`).roll())\r\nlet fatigued = roll.total\r\nroll.toMessage(this.script.getChatData());\r\nif (fatigued > this.actor.characteristics.wp.bonus)\r\n{\r\n    this.actor.addCondition(\"unconscious\")\r\n    this.script.scriptNotification(`Utrata Przytomności`)\r\n}\r\nelse \r\n{\r\n    fatigued = Math.max(0, fatigued)\r\n    if (fatigued)\r\n        this.actor.addCondition(\"fatigued\", fatigued)\r\n    this.script.scriptNotification(`Otrzymano Stany Zmęczenia w liczbie: ${fatigued}`)\r\n}",
    "V9xm4X1x3lPYTQaI": "if (args.extendedTest?.getFlag(\"wfrp4e\", \"fear\"))\r\n{\r\n\tthis.script.scriptNotification(\"Niewrażliwy na Strach\");\r\n\targs.extendedTest.delete();\r\n\targs.abort = true;\r\n}",
    "V9zm2hKUVLVZtAcN": "let characteristics = {\r\n  \"ws\" : -10,\r\n  \"bs\" : -10,\r\n  \"s\" : 0,\r\n  \"t\" : 15,\r\n  \"i\" : 15,\r\n  \"ag\" : -20,\r\n  \"dex\" : 0,\r\n  \"int\" : 20,\r\n  \"wp\" : 10,\r\n  \"fel\" : 10\r\n}\r\nlet skills = [\"Charyzma\", \"Splatanie Magii\", \"Występy (Przepowiednie)\", \"Intuicja\"]\r\nlet skillAdvancements = [0, 0, 20, 10]\r\nlet talents = [\"Rozpoznanie Artefaktu\", \"Groźny\", \"Szósty Zmysł\"]\r\nlet traits = [\"Wróżba Losu\", \"Rzucanie Czarów (Tradycja Życia)\", \"Ochrona\"]\r\nlet trappings = []\r\nlet items = [];\r\nlet spells = [\"Pole cierniowe\"];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n  updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n  let skill = skills[index]\r\n  let skillItem;\r\n  skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n  if (skillItem)\r\n      skillItem.system.advances.value += skillAdvancements[index]\r\n  else \r\n  {\r\n      skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n      skillItem = skillItem.toObject();\r\n      skillItem.system.advances.value = skillAdvancements[index];\r\n      items.push(skillItem);\r\n  }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n  let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n  if (talentItem)\r\n  {\r\n      items.push(talentItem.toObject());\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n  }\r\n}\r\n\r\nconst traitRegex = /(?:,?(.+?)(\\+?\\d{1,2}\\+?)?\\s*?(?:\\((.+?)\\)\\s*(\\+?\\d{1,2})?|,|$))/gm\r\nfor (let trait of traits)\r\n{\r\n  let traitMatches = trait.matchAll(traitRegex).next().value\r\n  let traitName = traitMatches[1]\r\n  let traitVal = traitMatches[2] || traitMatches[4] // could be match 2 or 4 depending on if there's a specialization\r\n  let traitSpec = traitMatches[3]\r\n\r\n  let traitItem;\r\n  try {\r\n      traitItem = await WFRP_Utility.findItem(traitName, \"trait\")\r\n  }\r\n  catch { }\r\n  if (!traitItem) {\r\n      ui.notifications.warn(`Could not find ${trait}`, {permanent : true})\r\n  }\r\n  traitItem = traitItem.toObject()\r\n\r\n  if (Number.isNumeric(traitVal))\r\n  {\r\n      traitItem.system.specification.value = traitName.includes('Weapon','Horns','Tail','Tentacles','Bite') ? traitVal - parseInt(characteristicValues[3]/10) : traitVal;\r\n      traitItem.name = (traitItem.name +  ` ${traitSpec ? \"(\"+ traitSpec + \")\" : \"\"}`).trim()\r\n  }\r\n  else \r\n      traitItem.system.specification.value = traitSpec\r\n\r\n  items.push(traitItem)\r\n\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n  let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n  if (trappingItem)\r\n  {\r\n      trappingItem = trappingItem.toObject()\r\n\r\n      equip(trappingItem)\r\n\r\n      items.push(trappingItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n  }\r\n}\r\n\r\nfor (let spell of spells) \r\n{\r\n  let spellItem = await game.wfrp4e.utility.findItem(spell)\r\n  if (spellItem)\r\n  {\r\n      spellItem = spellItem.toObject()\r\n\r\n      items.push(spellItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${spell}`, {permanent : true})\r\n  }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\n\r\nfunction equip(item)\r\n{\r\n  if (item.type == \"armour\")\r\n      item.worn = true\r\n  else if (item.type == \"weapon\")\r\n      item.equipped = true\r\n  else if (item.type == \"trapping\" && item.trappingType?.value == \"clothingAccessories\")\r\n      item.worn = true\r\n}",
    "VbL0TgaBAmYjrezZ": "const talents = await Promise.all([game.i18n.localize(\"NAME.Hardy\")].map(game.wfrp4e.utility.findTalent))\r\nthis.actor.createEmbeddedDocuments(\"Item\", talents, {fromEffect : this.effect.id})",
    "vc4bELo0cWYoILfB": "let choice = await ItemDialog.create(this.actor.itemTypes.disease, 1, \"Wybierz chorobę, którą chcesz uleczyć (Musi być naturalnego pochodzenia)\")\r\n\r\nthis.script.scriptMessage(`uleczono <strong>${choice[0]?.name}</strong>`);\r\nchoice[0].delete()",
    "vcM0IgsYVmfWrlO3": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.rOV2s6PQBBrhpMOv\");\r\nthis.actor.createEmbeddedDocuments(\"Item\", [item], {fromEffect : this.effect.id});",
    "vFUVWZ1l8wpTjLcx": "if (!this.actor.has(game.i18n.localize(\"NAME.Daemonic\")))\r\n    return\r\n\r\nlet caster = this.effect.sourceActor;\r\nif (caster) \r\n{\r\n    let wp = caster.system.characteristics.wp\r\n    if (this.actor.system.characteristics.wp.value >= wp.value)\r\n    {\r\n        this.script.scriptNotification(\"Cel ma wyższą Siłę Woli, brak efektu\")\r\n        return\r\n    }\r\n    this.actor.applyBasicDamage(wp.bonus, { damageType: game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL })\r\n}",
    "VlFUDaKUYoBYKYn0": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context : {failure: \"Otrzymano 1 Punkt Zepsucia\"}})\r\nawait test.roll();\r\nif (test.failed && this.actor.type == \"character\")\r\n{\r\n    this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + 1})\r\n    this.script.scriptMessage(\"Otrzymano 1 Punkt Zepsucia\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "VNOKTzCrFbZ6PJUj": "return ![\"Oswajanie\", \"Odporność\", \"Sztuka Przetrwania\"].includes(args.skill?.name)",
    "VqTrKPtxv9hpn0Hr": "return args.skill?.name != \"Język (Magiczny)\"",
    "vSDMygIT9nNvEGWG": "// Each time the blade is used, the GM should secretly roll a d10.\r\n// On a 1, its poison has run dry, \r\n// and the next time it is employed it will shatter.\r\n\r\nif (Math.ceil(CONFIG.Dice.randomUniform() * 10) == 1) {\r\n  this.item.setFlag(\"wfrp4e\", \"brittle\", true)\r\n  ChatMessage.create({\r\n    content: `\r\n      <strong>${this.item.name}</strong>: trucizna skończyła się. Podczas następnego użycia zostanie roztrzaskany.`, \r\n    whisper: ChatMessage.getWhisperRecipients(\"GM\"),\r\n    blind: true\r\n  })\r\n}\r\n",
    "vuzRRj5d9XdNYx3o": "let broken = this.actor.hasCondition(\"broken\")\r\nif (broken)\r\n{\r\n    broken.delete();\r\n    this.script.scriptNotification(\"Usunięto Stan Panika\")\r\n}",
    "VzO0ZDcTWvaBn4vm": "if (args.test.preData.skillName?.includes(game.i18n.localize(\"NAME.Language\")) || args.test instanceof CastTest)\r\n{\r\n\tif (parseInt(args.test.result.SL) > 0 || args.test.succeeded)\r\n\t{\r\n\t\tif (parseInt(args.test.result.SL) > 0)\r\n\t\t{\r\n\t\t\targs.test.result.SL = \"-0\";\r\n\t\t\targs.test.result.description = game.i18n.localize(\"ROLL.MarginalFailure\");\r\n\t\t}\r\n\t\targs.test.result.outcome = \"failure\"\r\n        args.test.result.other.push(`<strong>${this.effect.name}</strong>: Maksymalnie -0 PS`)\r\n\t}\r\n}",
    "W9nyUNQStMr1pUHJ": "if (args.opposedTest.result.hitloc.value == this.item.system.location.key)\r\n{\r\n    args.actor.addCondition(\"bleeding\", 1);\r\n    this.script.scriptNotification(\"Otrzymano Stan Krwawienia\");\r\n}",
    "WB6sIpLEPC8YPX67": "if (args.options.dodge)\r\n{\r\n\targs.abort = true;\r\n\tthis.script.scriptNotification(\"Nie można unikać!\")\r\n}\r\nreturn [\"t\", \"int\", \"wp\", \"fel\"].includes(args.characteristic)",
    "wbM7tpw4TxvadcWm": "let items = this.effect.itemTargets;\r\nlet msg = \"\";\r\nfor(let item of items)\r\n{\r\n    if (item.system.properties.qualities.durable)\r\n    {\r\n        await item.update({\"system.qualities.value\" : []});\r\n        msg += `<p>${item.name}: utracono wszystkie Zalety</p>`\r\n    }\r\n    else \r\n    {\r\n        msg += `<p>${item.name}: rozsypano w pył!</p>` \r\n        await item.update({name : item.name + \" (Pył)\"})\r\n    }\r\n}\r\nif(msg)\r\n{\r\n    this.script.scriptMessage(msg);\r\n}",
    "whUSkaR1yem21bXp": "let characteristics = {\r\n  \"ws\" : 10,\r\n  \"bs\" : 5,\r\n  \"s\" : 0,\r\n  \"t\" : 5,\r\n  \"i\" : 10,\r\n  \"ag\" : 0,\r\n  \"dex\" : 6,\r\n  \"int\" : -5,\r\n  \"wp\" : 0,\r\n  \"fel\" : 10\r\n}\r\nlet skills = [\"Broń Biała (Podstawowa\", \"Tropienie\"]\r\nlet skillAdvancements = [8, 7]\r\nlet talents = [\"Berserkerska Szarża\", \"Cios Mierzony\", \"Morderczy Atak\"]\r\nlet traits = [\"Latanie (8)\", \"Furia\", \"Rój\", \"Tropiciel\"]\r\nlet trappings = []\r\nlet items = [];\r\nlet spells = [];\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n  updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n  let skill = skills[index]\r\n  let skillItem;\r\n  skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n  if (skillItem)\r\n      skillItem.system.advances.value += skillAdvancements[index]\r\n  else \r\n  {\r\n      skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n      skillItem = skillItem.toObject();\r\n      skillItem.system.advances.value = skillAdvancements[index];\r\n      items.push(skillItem);\r\n  }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n  let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n  if (talentItem)\r\n  {\r\n      items.push(talentItem.toObject());\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n  }\r\n}\r\n\r\nconst traitRegex = /(?:,?(.+?)(\\+?\\d{1,2}\\+?)?\\s*?(?:\\((.+?)\\)\\s*(\\+?\\d{1,2})?|,|$))/gm\r\nfor (let trait of traits)\r\n{\r\n  let traitMatches = trait.matchAll(traitRegex).next().value\r\n  let traitName = traitMatches[1]\r\n  let traitVal = traitMatches[2] || traitMatches[4] // could be match 2 or 4 depending on if there's a specialization\r\n  let traitSpec = traitMatches[3]\r\n\r\n  let traitItem;\r\n  try {\r\n      traitItem = await WFRP_Utility.findItem(traitName, \"trait\")\r\n  }\r\n  catch { }\r\n  if (!traitItem) {\r\n      ui.notifications.warn(`Could not find ${trait}`, {permanent : true})\r\n  }\r\n  traitItem = traitItem.toObject()\r\n\r\n  if (Number.isNumeric(traitVal))\r\n  {\r\n      traitItem.system.specification.value = traitName.includes('Weapon','Horns','Tail','Tentacles','Bite') ? traitVal - parseInt(characteristicValues[3]/10) : traitVal;\r\n      traitItem.name = (traitItem.name +  ` ${traitSpec ? \"(\"+ traitSpec + \")\" : \"\"}`).trim()\r\n  }\r\n  else \r\n      traitItem.system.specification.value = traitSpec\r\n\r\n  items.push(traitItem)\r\n\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n  let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n  if (trappingItem)\r\n  {\r\n      trappingItem = trappingItem.toObject()\r\n\r\n      equip(trappingItem)\r\n\r\n      items.push(trappingItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n  }\r\n}\r\n\r\nfor (let spell of spells) \r\n{\r\n  let spellItem = await game.wfrp4e.utility.findItem(spell)\r\n  if (spellItem)\r\n  {\r\n      spellItem = spellItem.toObject()\r\n\r\n      items.push(spellItem);\r\n  }\r\n  else \r\n  {\r\n      ui.notifications.warn(`Could not find ${spell}`, {permanent : true})\r\n  }\r\n}\r\n\r\nupdateObj.name = updateObj.name += \" \" + this.effect.name\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\n\r\nfunction equip(item)\r\n{\r\n  if (item.type == \"armour\")\r\n      item.worn = true\r\n  else if (item.type == \"weapon\")\r\n      item.equipped = true\r\n  else if (item.type == \"trapping\" && item.trappingType?.value == \"clothingAccessories\")\r\n      item.worn = true\r\n}",
    "WiYtNU2Y5BJfIpeM": "let location = this.item.system.location.key;\r\n\r\nif (location)\r\n{\r\n    let dropped = this.item.system.weaponsAtLocation;\r\n\r\n    if (dropped.length)\r\n    {\r\n        this.script.scriptNotification(`Upuszczono ${dropped.map(i => i.name).join(\", \")}!`)\r\n        for(let weapon of dropped)\r\n        {\r\n            await weapon.system.toggleEquip();\r\n        }\r\n    }\r\n}",
    "WO5n7Vbx8AgoVrwC": "   let characteristics = {\r\n            \"ws\" : 0,\r\n            \"bs\" : 0,\r\n            \"s\" : 0,\r\n            \"t\" : 0,\r\n            \"i\" : 10,\r\n            \"ag\" : 0,\r\n            \"dex\" : 0,\r\n            \"int\" : 10,\r\n            \"wp\" : 5,\r\n            \"fel\" : 5\r\n        }\r\nlet skills = [\"Intuicja\", \"Wiedza (Lokalna)\", \"Percepcja\"]\r\nlet skillAdvancements = [10, 10, 10]\r\nlet talents = []\r\nlet trappings = [\"Kolczuga\", \"Nogawice kolcze\", \"Czepiec kolczy\", \"Broń ręczna\"]\r\nlet items = []\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "wsqNM4NHnwaAAQym": "    args.applyAP = false;\r\n\r\n    this.script.scriptNotification(\"Ten test dotyczy tylko przestępców, w przeciwnym razie zamknij okno dialogowe.\");\r\n    this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty : \"average\"}, skipTargets: true, appendTitle :  ` - ${this.effect.name}`}).then(async test => \r\n    {\r\n      await test.roll();\r\n      if (test.failed)\r\n      {\r\n        args.actor.addCondition(\"unconscious\");\r\n      }\r\n    });",
    "wyTCozh9qGTx6yK0": "if (args.options.terror || args.extendedTest?.getFlag(\"wfrp4e\", \"fear\"))\r\n{\r\n\targs.abort = true;\r\n\tthis.script.scriptNotification(\"Nie musi robić testów strachu lub grozy\");\r\n}",
    "wzkxiKjxVEeNS1di": "let roll = await new Roll(\"1d10\").roll();\r\nthis.script.scriptMessage(await this.actor.applyBasicDamage(roll.total, {damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL, suppressMsg: true}))\r\n\r\nawait this.actor.addCondition(\"deafened\", 3)\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields : {difficulty: \"average\" }, skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context : {failure: \"Otrzymano Stan Paniki\", success : \"Uniknięto Stanu Paniki\"}})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"broken\")\r\n}",
    "x2RLUUNB7BiIDYCP": "let difficulty = \"\"\r\nif (this.effect.name.includes(\"Umiarkowany\"))\r\n    difficulty = \"easy\"\r\nelse if (this.effect.name.includes(\"Poważny\"))\r\n    difficulty = \"average\"\r\nelse\r\n    difficulty = \"veasy\"\r\n\r\nlet test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {context : {failure : this.actor.name + \" umiera z powodu uwiądu\"}, fields: {difficulty}, skipTargets: true, appendTitle :  \" - Uwiąd\"})\r\nawait test.roll();\r\nif (test.failed)\r\n{\r\n    this.actor.addCondition(\"dead\");\r\n}",
    "x9iKFYYc4Ocy8PTS": "let item = this.effect.getCreatedItems()?.[0];\r\nChatMessage.create({content : \"<em>Gracja ponad stylem</em>\", speaker : ChatMessage.getSpeaker({token: this.actor.getActiveTokens()[0]?.document, actor: this.actor})}, {chatBubble : true})\r\n\r\nlet choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n    \"nobles\" : \"Szlachta\",\r\n    \"guilders\" : \"Gildie\",\r\n    \"servants\" : \"Słudzy\"\r\n}), 1, \"Wybierz grupę społeczną\")\r\n\r\nlet n = choice[0]?.name\r\n\r\nif (!n)\r\n{\r\n    return;\r\n}\r\n\r\nif (item)\r\n{\r\n    item.update({\r\n        name : item.name.split(\"(\")[0] + ` (${n})`, \r\n        \"system.tests.value\" : item.system.tests.value.split(\"(\")[0] + ` (${n}`\r\n    })\r\n}\r\nelse \r\n{\r\n    item = await fromUuid(\"Compendium.wfrp4e-core.items.Item.sYbgpSnRqSZWgwFP\");\r\n    let data = item.toObject();\r\n    data.name += ` (${n})`\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect: this.effect.id})\r\n}",
    "xBpLQa7yBPczDMY8": "    let scythe = (await fromUuid(\"Compendium.wfrp4e-core.items.CXg7XOFJwu4LZ9LM\")).toObject();\r\n    scythe.name = \"Kosa Shyish\";\r\n    scythe.system.damage.value = \"WPB + 3\"\r\n    scythe.system.equipped = true;\r\n    scythe.img = this.effect.icon;\r\n    scythe.system.qualities.value.push({name : \"magical\"})\r\n    this.actor.createEmbeddedDocuments(\"Item\", [scythe], {fromEffect : this.effect.id})",
    "XcvDYNZgJ2rpAdDV": "let fatigued = this.actor.hasCondition(\"fatigued\")\r\nif (!fatigued)\r\n{\r\n    this.actor.addCondition(\"fatigued\")\r\n    ui.notifications.notify(\"Zmęczenie dodane do \" + this.actor.name + \", które nie może zostać usunięte, dopóki objaw Apatia nie zostanie uleczony.\")\r\n}",
    "xIRU2SaqLeWmqGDI": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.vMYEkrWj0ip6ZOdv\")\r\nlet data = item.toObject();\r\ndata.name += \" (Choroba)\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "XO9m2AvFRAAeEuty": "if (args.test.options.fieldDressing && args.test.result.reversed)\r\n{\r\n\targs.test.data.result.SL = \"+\" + Math.min(1, Number(args.test.data.result.SL))\r\n\targs.test.result.other.push(`<b>${this.effect.name}</b>: PS ograniczone do 1`)\r\n}",
    "xobGBJbgFjQCrwvq": "let roll;\r\nif (this.actor.has(game.i18n.localize(\"NAME.Daemonic\")) || this.actor.has(game.i18n.localize(\"NAME.Undead\")) || [\"Goblin\", \"Ork\", \"Nieumarły\"].includes(this.actor.system.details.species.value))\r\n{\r\n    roll = await new Roll(`1d10 + ${this.effect.sourceTest.result.overcast.usage.other.current}`).roll()\r\n}\r\nelse \r\n{\r\n    roll = await new Roll(`1d10`).roll()\r\n}\r\n\r\nroll.toMessage(this.script.getChatData())\r\nawait this.actor.applyBasicDamage(roll.total, {damageType : game.wfrp4e.config.DAMAGE_TYPE.IGNORE_ALL, suppressMsg : true})\r\n\r\nif (this.actor.has(game.i18n.localize(\"NAME.Undead\")) || args.actor.has(game.i18n.localize(\"NAME.Daemonic\")))\r\n{\r\n  this.actor.addCondition(\"ablaze\")\r\n}",
    "xRd6oA1QWLVpfoBm": "if (!this.actor.has(\"Widzenie w Ciemności\"))\r\n{\r\n    let item = await fromUuid(\"Compendium.wfrp4e-core.items.FmHDbCOy3pH8yKhm\");\r\n    let data = item.toObject();\r\n    this.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})\r\n}",
    "xS2su09zcza9du09": "if ([\"Pomniejsze\", \"Umiarkowane\", \"Poważne\"].includes(this.item.system.specification.value))\r\n{\r\n\treturn\r\n}\r\n\r\nlet choice = await ItemDialog.create(ItemDialog.objectToArray({minor : \"Pomniejsze\", moderate : \"Umiarkowane\", major : \"Poważne\"}, this.item.img), 1, \"Wybierz poziom Zepsucia\");\r\n\r\nthis.item.updateSource({\"system.specification.value\" : choice[0]?.name || \"\"})",
    "Y8J66v8VTKUASGuK": "if (!this.actor.effects.find(e => e.isCondition))\r\n{\r\n\treturn this.script.scriptNotification(\"Aktor nie posiada Stanów\")\r\n}\r\n\r\nlet choice = await ItemDialog.create(this.actor.effects.filter(i => i.isCondition), 1, \"Wybierz Stan\")\r\n\r\nif (choice[0])\r\n{\r\n\tawait this.actor.removeCondition(choice[0].conditionId)\r\n}\r\n\r\nif (this.actor.effects.find(e => e.isCondition))\r\n{\r\n    return false; // Delete the effect if there are still conditions, otherwise, effect remains and provides the bonus\r\n}",
    "YaKnYEbmmZZtByJc": "if (args.opposedTest.attackerTest.options.ballockKnife)\r\n{\r\n    args.weaponProperties.impale = true;\r\n    args.extraMessages.push(`<strong>${this.item.name}</strong>: Dodano Zaletę Nadziewająca`)\r\n}",
    "yAL0YwZWVm8o1nxa": "if (this.actor.hasCondition(\"dead\") && !this.actor.gardenOfCorpses)\r\n{\r\n    this.script.scriptMessage(\"[[3d10]] @UUID[Compendium.wfrp4e-core.actors.T79RqnDOAQLn3I1s]{Zombie} powstają z martwych.\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    this.actor.gardenOfCorpses = true;\r\n    // local storage is sufficient to prevent multiple messages\r\n}",
    "yCgH3N9AurIiAv0i": "if (!this.item.name.includes(\"(\") || this.item.system.tests.value.includes(\"(Zmysł)\") || this.item.system.tests.value.toLowerCase().includes(\"dowolny\"))\r\n{\r\n    let tests = this.item.system.tests.value\r\n    let name = this.item.name\r\n\r\n    // If name already specifies, make sure tests value reflects that\r\n    if (name.includes(\"(\") && !name.toLowerCase().includes(\"dowolny\"))\r\n    {\r\n        let sense = name.split(\"(\")[1].split(\")\")[0]\r\n        tests = `${tests.split(\"(\")[0].trim()} (${sense})`;\r\n    }\r\n    else // If no sense specified, provide dialog choice\r\n    {\r\n        let choice = await ItemDialog.create(ItemDialog.objectToArray({\r\n            taste : \"Smak\",\r\n            sight : \"Wzrok\",\r\n            smell : \"Węch\",\r\n            hearing : \"Słuch\",\r\n            touch : \"Dotyk\"\r\n        }, this.item.img), 1, \"Wybierz Zmysł\");\r\n        if (choice[0])\r\n        {\r\n            name = `${name.split(\"(\")[0].trim()} (${choice[0].name})`\r\n            tests = `${tests.split(\"(\")[0].trim()} (${choice[0].name})`\r\n        }\r\n    }\r\n\r\n        this.item.updateSource({name, \"system.tests.value\" : tests})\r\n}",
    "YDqpKJVy8ijEKdLX": "return !(this.actor.attacker && (args.skill?.name.includes(\"Broń Biała (Podstawowa)\") || (args.type == \"weapon\" && args.item?.system.weaponGroup.value == \"basic\")))",
    "yFMvxecXAZ6T2O0S": "if (args.totalWoundLoss >= 1)\r\n{\r\n    let roll = await new Roll(\"1d10\").roll();\r\n    await roll.toMessage(this.script.getChatData());\r\n    if (roll.total == 9)\r\n    {\r\n        this.script.scriptMessage(`Dwa @UUID[Compendium.wfrp4e-eis.actors.cLOGeMqUty61nYB9]{Niebieskie Horrory Tzeentcha} wydostają się z ciała ${this.actor.name}, jednocześnie doprowadzając do śmierci.`, {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n    }\r\n}",
    "ynoHNXXCGRS6fTqF": "let msg = \"\"\r\n\r\nlet i_gain = (await new Roll(\"1d10\").roll()).total\r\n\r\nif (args.actor.characteristics.i.value <= 0)\r\n{\r\n   i_gain += (await new Roll(\"2d10\").roll()).total\r\n}\r\n\r\nmsg = `<b>${this.actor.prototypeToken.name}</b>: otrzymano punkty Inicjatywy w liczbie ${i_gain}`\r\n\r\nlet newValue = i_gain + args.actor.characteristics.i.modifier\r\n\r\nthis.actor.update({\"system.characteristics.i.modifier\" : newValue})\r\n\r\n\r\nlet hitloc = await game.wfrp4e.tables.rollTable(\"hitloc\")\r\n\r\nlet value = hitloc.result\r\nlet desc = hitloc.description\r\n\r\nthis.effect.updateSource({\"flags.wfrp4e.location\" : value})\r\n\r\nmsg += ` gdy nowe oczy pojawiają się w lokacji: ${desc}`\r\n\r\nthis.script.scriptMessage(msg)",
    "YQ2LnLxp0xgy3meI": "if (args.test.preData.options?.corruption && args.test.failed) {\r\n  args.test?.result?.other.push(\"Otrzymano dodatkowy Punkt Zepsucia pochodzący z \" + this.effect.name)\r\n}",
    "YRUTliBzAQvncGNX": "this.actor.addCondition(\"fatigued\");\r\nthis.script.scriptNotification(\"Otrzymano Stan Zmęczenia\")",
    "yTmRoUstxHMso91c": "if (args.item.name == \"Odporność na Magię\" && args.item.type == \"trait\")\r\n{\r\n    args.item.system.specification.value = Number(args.item.system.specification.value) + 1\r\n}",
    "YwLEw4BiKq4EMy57": "let i_gain = (await new Roll(\"2d10\").roll()).total\r\nlet fel_gain = 0\r\nif (args.actor.characteristics.fel.value <= 0)\r\n{\r\n   fel_gain += (await new Roll(\"2d10\").roll()).total\r\n}\r\n\r\nlet msg = `<b>${this.actor.prototypeToken.name}</b>: otrzymano punkty Inteligencji w liczbie: ${i_gain}`\r\n\r\nif (fel_gain)\r\n   msg += ` oraz Ogłady w liczbie: ${fel_gain}`\r\n\r\n\r\nlet newInt = i_gain + args.actor.characteristics.int.modifier\r\nlet newFel = fel_gain + args.actor.characteristics.fel.modifier\r\n\r\nargs.actor.update({\"system.characteristics.int.modifier\" : newInt, \"system.characteristics.fel.modifier\" : newFel})\r\n\r\nthis.script.scriptMessage(msg)",
    "yXUPiWuQ5o0JBY4i": "return args.skill?.name == game.i18n.localize(\"NAME.Endurance\") || args.characteristic == \"int\"",
    "Z30zYayPryXOjT5N": "args.item.system.damage.value = \"SB + 6\";",
    "Z52yZDm6lP6fOP3O": "let ablaze = this.actor.hasCondition(\"ablaze\")\r\nif (ablaze)\r\n{\r\n    this.script.scriptNotification(\"Niewrażliwość na Podpalenie\");\r\n    ablaze.delete()\r\n}",
    "z5HfNUrHy5MS3K7a": "let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Cool\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`, context : {failure: \"Dodatkowy Punkt Zepsucia\"}})\r\nawait test.roll();\r\nif (test.failed && this.actor.type == \"character\")\r\n{\r\n    this.actor.update({\"system.status.corruption.value\" : parseInt(this.actor.status.corruption.value) + 1})\r\n    this.script.scriptMessage(\"Otrzymano Punkt Zepsucia\", {whisper : ChatMessage.getWhisperRecipients(\"GM\")})\r\n}",
    "Z6jNlyZMECkW4Hon": "let spells = await game.wfrp4e.utility.findAll(\"spell\", \"Wczytuję Zaklęcia...\", true);\r\n\r\nlet choice = await ItemDialog.create(spells, 1);\r\n\r\nif (choice[0])\r\n{\r\n    this.script.scriptMessage(`Wybrano @UUID[${choice[0].uuid}]{${choice[0].name}}`)\r\n    let spell = (await fromUuid(choice[0].uuid)).toObject(); // Might be an index so retrieve item object for sure\r\n    setProperty(spell, \"flags.wfrp4e.boonOfTzeentch\", true);\r\n    spell.system.wind.value = \"Splatanie Magii (Dhar)\";\r\n    spell.system.memorized.value = true;\r\n    this.actor.createEmbeddedDocuments(\"Item\", [spell], {fromEffect: this.effect.id})\r\n}",
    "Z6OmmC0irJzxSnMH": "let chatData = { whisper: ChatMessage.getWhisperRecipients(\"GM\") }\r\nlet message = \"\"\r\n\r\nlet wounds = duplicate(this.actor.status.wounds)\r\nlet regenRoll = await new Roll(\"1d10\").roll();\r\nlet regen = regenRoll.total;\r\n\r\nif (wounds.value >= wounds.max)\r\n    return\r\n\r\nif (wounds.value > 0) \r\n{\r\n    wounds.value += regen\r\n    if (wounds.value > wounds.max)\r\n    {\r\n        wounds.value = wounds.max\r\n    }\r\n    message += `<b>${this.actor.name}</b>: Odzyskane punkty Żywotności: ${regen}.`\r\n\r\n    if (regen == 10)\r\n    {\r\n        message += `<br>Dodatkowo zregenerowano krytyczną ranę.`\r\n    }\r\n}\r\nelse if (regen >= 8) \r\n{\r\n    message += `<b>${this.actor.name}</b>: wylosowano ${regen} i odzyskano 1 punkt Żywotności.`\r\n    wounds.value += 1\r\n    if (regen == 10)\r\n    {\r\n        message += `<br>Dodatkowo zregenerowano krytyczną ranę.`\r\n    }\r\n}\r\nelse \r\n{\r\n    message += `<b>${this.actor.name}</b>: wylosowano ${regen} - brak efektu.`\r\n}\r\n\r\nawait this.actor.update({ \"system.status.wounds\": wounds })\r\nthis.script.scriptMessage(message, { whisper: ChatMessage.getWhisperRecipients(\"GM\") })\r\n\r\nif (this.actor.Species != \"Ogr\")\r\n{\r\n   this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {skipTargets: true, appendTitle :  \" - \" + this.effect.name, fields : {difficulty : \"average\"}}).then(test => {\r\n       test.roll()\r\n   })\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "zA6TDttpwMSMl7D8": "// An imbiber must take a Consume Alcohol Test.\r\nthis.actor.setupSkill(game.i18n.localize(\"NAME.ConsumeAlcohol\"), {skipTargets: true, appendTitle :  ` - ${this.effect.name}`}).then(async test => {\r\n  await test.roll()\r\n  // If they succeed, \r\n  // as a result of whatever potential futures they glimpse, \r\n  // they can spend a Fortune Point within the next hour to reverse the dice of any failed Test.\r\n  if (test.succeeded) {\r\n    this.script.scriptMessage(`W wyniku wszelkich potencjalnych wydarzeń, <strong>${this.actor.prototypeToken.name}</strong> może wydać punkt Szczęścia w ciągu następnej godziny, aby odwrócić kości dowolnego nieudanego testu.`, \r\n    {\r\n      whisper: ChatMessage.getWhisperRecipients(\"GM\"), \r\n      blind: true \r\n    })    \r\n  }\r\n})",
    "zadppy7FEbXvgUON": " let characteristics = {\r\n                    \"ws\" : 5,\r\n                    \"bs\" : 0,\r\n                    \"s\" : 0,\r\n                    \"t\" : 0,\r\n                    \"i\" : 0,\r\n                    \"ag\" : 10,\r\n                    \"dex\" : 10,\r\n                    \"int\" : 0,\r\n                    \"wp\" : 0,\r\n                    \"fel\" : 5\r\n                }\r\nlet skills = [\"Percepcja\", \"Zwinne Palce\", \"Skradanie (Miasto)\"]\r\nlet skillAdvancements = [10, 10, 10]\r\nlet talents = [\"Przestępca\", \"Etykieta (Przestępcy)\"]\r\nlet trappings = [\"Lina, 10 metrów\", \"Wytrychy\", \"Maska\"]\r\nlet items = []\r\n\r\nlet updateObj = this.actor.toObject();\r\n\r\nfor (let ch in characteristics)\r\n{\r\n    updateObj.system.characteristics[ch].modifier += characteristics[ch];\r\n}\r\n\r\nfor (let index = 0; index < skills.length; index++)\r\n{\r\n    let skill = skills[index]\r\n    let skillItem;\r\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\r\n    if (skillItem)\r\n        skillItem.system.advances.value += skillAdvancements[index]\r\n    else \r\n    {\r\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\r\n        skillItem = skillItem.toObject();\r\n        skillItem.system.advances.value = skillAdvancements[index];\r\n        items.push(skillItem);\r\n    }\r\n}\r\n\r\nfor (let talent of talents)\r\n{\r\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\r\n    if (talentItem)\r\n    {\r\n        items.push(talentItem.toObject());\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\r\n    }\r\n}\r\n\r\nfor (let trapping of trappings) \r\n{\r\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\r\n    if (trappingItem)\r\n    {\r\n        trappingItem = trappingItem.toObject()\r\n\r\n        equip(trappingItem)\r\n\r\n        items.push(trappingItem);\r\n    }\r\n    else \r\n    {\r\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\r\n    }\r\n}\r\n\r\n\r\nawait this.actor.update(updateObj)\r\nthis.actor.createEmbeddedDocuments(\"Item\", items);\r\n\r\nfunction equip(item)\r\n{\r\n    if (item.type == \"armour\")\r\n        item.system.worn.value = true\r\n    else if (item.type == \"weapon\")\r\n        item.system.equipped = true\r\n    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\r\n        item.system.worn = true\r\n}",
    "ZCuOjLAeENKN1Q4L": "let halve;\r\nif (args.opposedTest.attackerTest.item?.type != \"spell\")\r\n{\r\n    halve = await Dialog.confirm({title : this.effect.name, content : \"Zmniejszyć obrażenia o połowę? (Zmniejsza obrażenia zadane od ognia o połowę)\"})\r\n}\r\nelse\r\n{\r\n    halve = args.opposedTest.attackerTest.item?.system.lore?.value == \"fire\";\r\n}\r\n\r\nif (halve)\r\n{\r\n    args.totalWoundLoss /= 2;\r\n    args.modifiers.other.push({label : this.effect.name, details : \"Zmniejszono o połowę\", value : \"× 0.5\"})\r\n}",
    "Ze9E2zR1GFGWGMVH": "return [\"Otwieranie Zamków\", \"Zwinne Palce\", \"Splatanie Magii (Ulgu)\"].includes(args.skill?.name)",
    "ZI2YnAAGoLpmVDIL": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.aE3pyW20Orvdjzj0\")\r\nlet data = item.toObject();\r\ndata.system.specification.value = \"Religia\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "zK38Rl5t9zbFi4Se": "if (args.opposedTest.result.hitloc.value == this.item.system.location.key && args.totalWoundLoss > 0)\r\n{\r\n    args.actor.addCondition(\"bleeding\", 1);\r\n    this.script.scriptNotification(\"Otrzymano Stan Krwawienia\")\r\n}",
    "ZNu4B0OdjkM9lmtu": "let item = await fromUuid(\"Compendium.wfrp4e-core.items.9h82z72XGo9tfgQS\")\r\nlet data = item.toObject();\r\ndata.name = data.name += \" (Wzrok)\"\r\nthis.actor.createEmbeddedDocuments(\"Item\", [data], {fromEffect : this.effect.id})",
    "ZNW3ubbKIYXAyE48": "let wounds = this.actor.itemTypes.disease.filter(i => i.name == \"Ropiejąca Rana\" && i.system.duration.active);\r\nlet selected;\r\nif (wounds.length == 0)\r\n{\r\n    return this.script.scriptNotification(\"Brak Ropiejących Ran!\");\r\n}\r\nelse if (wounds.length == 1)\r\n{\r\n    selected = wounds[0];\r\n}\r\nelse if (wounds.length >= 2)\r\n{\r\n    selected = (await ItemDialog.create(wounds, 1))[0];\r\n}\r\n\r\nif (selected)\r\n{\r\n    let test = await this.actor.setupSkill(game.i18n.localize(\"NAME.Endurance\"), {fields: {difficulty : \"average\"}})\r\n    await test.roll();\r\n    if (test.succeeded)\r\n    {\r\n        let SL = parseInt(test.result.SL);\r\n        if (SL >= 0)\r\n        {\r\n            selected.update({\"system.duration.value\" : selected.system.duration.value - SL})\r\n            this.script.scriptMessage(`<strong>${selected.name}</strong> czas trwania choroby zmniejszony o ${SL}!`)\r\n        }\r\n    }\r\n}",
    "zzk2uRSFjFHB5kjw": "\r\n   let roll = Math.ceil(CONFIG.Dice.randomUniform() * 10)\r\n   if (args.test.isFumble && roll == 1 && !args.test.result.misfire)\r\n  {\r\n          args.test.result.misfire = game.i18n.localize(\"Misfire\") + \" (Wyrzucono 1)\"\r\n          args.test.result.misfireDamage = eval(parseInt(args.test.result.roll.toString().split('').pop()) + args.test.item.Damage)\r\n  }\r\n  else if (args.test.isFumble && roll != 1)\r\n      args.test.result.other.push(\"Rzut na Niewybuch: \" + roll)"
});
});